// File Line: 170
// RVA: 0x1468400
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mHotswappedFiles__()
{
  UFG::qChunkFileSystem::mHotswappedFiles.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mHotswappedFiles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mHotswappedFiles.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mHotswappedFiles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mHotswappedFiles__);
}

// File Line: 172
// RVA: 0x1468590
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mResourceChannel__()
{
  UFG::qChunkFileSystem::mResourceChannel.mLogFilename.mPrev = &UFG::qChunkFileSystem::mResourceChannel.mLogFilename;
  UFG::qChunkFileSystem::mResourceChannel.mLogFilename.mNext = &UFG::qChunkFileSystem::mResourceChannel.mLogFilename;
  *(_QWORD *)&UFG::qChunkFileSystem::mResourceChannel.mLogFilename.mMagic = 16909060i64;
  UFG::qChunkFileSystem::mResourceChannel.mLogFilename.mData = (char *)UFG::qString::sEmptyString;
  *(_QWORD *)&UFG::qChunkFileSystem::mResourceChannel.mLogFilename.mStringHash32 = -1i64;
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mResourceChannel__);
}

// File Line: 176
// RVA: 0x14683B0
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mFileHandles__()
{
  UFG::qChunkFileSystem::mFileHandles.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mFileHandles__);
}

// File Line: 177
// RVA: 0x1468520
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadedChunks__()
{
  UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mLoadedChunks.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadedChunks__);
}

// File Line: 178
// RVA: 0x14684D0
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadedChunkFiles__()
{
  UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadedChunkFiles__);
}

// File Line: 179
// RVA: 0x1468570
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadedIndexFiles__()
{
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadedIndexFiles__);
}

// File Line: 183
// RVA: 0x14685F0
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mSingleFileLoadTables__()
{
  UFG::qChunkFileSystem::mSingleFileLoadTables.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mSingleFileLoadTables.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mSingleFileLoadTables.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mSingleFileLoadTables.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mSingleFileLoadTables__);
}

// File Line: 184
// RVA: 0x1468360
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mCreatedLoadTables__()
{
  UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mRoot.mParent = (UFG::qBaseNodeRB *)((unsigned __int64)&UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL & 0xFFFFFFFFFFFFFFFEui64);
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mCreatedLoadTables__);
}

// File Line: 205
// RVA: 0x1468450
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadTablesBundleSort__()
{
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadTablesBundleSort__);
}

// File Line: 206
// RVA: 0x14684B0
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadTablesLoading__()
{
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadTablesLoading__);
}

// File Line: 207
// RVA: 0x1468470
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadTablesCallback__()
{
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadTablesCallback__);
}

// File Line: 208
// RVA: 0x1468490
__int64 UFG::qChunkFileSystem::_dynamic_initializer_for__mLoadTablesLoaded__()
{
  return atexit((int (__fastcall *)())UFG::qChunkFileSystem::_dynamic_atexit_destructor_for__mLoadTablesLoaded__);
}

// File Line: 605
// RVA: 0x1721F0
UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *__fastcall UFG::qChunkFileSystem::GetResourceFileHandle(
        const char *filename)
{
  UFG::qBaseNodeRB *v2; // rdi
  unsigned int v3; // ebx
  const char *v4; // r8
  char i; // dl
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *result; // rax
  unsigned int mUID; // ecx
  UFG::ResourceFileHandle *j; // rcx
  UFG::qMemoryPool *v9; // rcx
  UFG::allocator::free_link *v10; // rax
  UFG::qBaseNodeRB *v11; // rax

  v2 = 0i64;
  v3 = -1;
  if ( filename )
  {
    v4 = filename;
    for ( i = *filename; *v4; i = *v4 )
    {
      if ( i <= 122 && i >= 97 )
        i -= 32;
      ++v4;
      v3 = (v3 << 8) ^ sCrcTable32[(unsigned __int8)(i ^ HIBYTE(v3))];
    }
    if ( !v3 )
      goto LABEL_21;
  }
  result = &UFG::qChunkFileSystem::mFileHandles;
  while ( 1 )
  {
    mUID = result->mTree.mRoot.mUID;
    if ( result != &UFG::qChunkFileSystem::mFileHandles && mUID == v3 )
      break;
    if ( v3 > mUID )
      result = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)result->mTree.mRoot.mChild[1];
    else
      result = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)result->mTree.mRoot.mChild[0];
    if ( result == (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL )
    {
      result = 0i64;
      goto LABEL_20;
    }
  }
  for ( j = (UFG::ResourceFileHandle *)result->mTree.mRoot.mChild[0]; j; j = (UFG::ResourceFileHandle *)j->mNode.mChild[0] )
  {
    if ( j->mNode.mUID != v3 )
      break;
    result = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)j;
  }
LABEL_20:
  if ( !result )
  {
LABEL_21:
    v9 = UFG::gMainMemoryPool;
    if ( !UFG::gMainMemoryPool )
    {
      UFG::InternalSetupMainMemoryPool((UFG *)UFG::gMainMemoryPool);
      v9 = UFG::gMainMemoryPool;
    }
    v10 = UFG::qMemoryPool::Allocate(v9, 0x50ui64, "ResourceFileHandle", 0i64, 1u);
    if ( v10 )
    {
      UFG::ResourceFileHandle::ResourceFileHandle((UFG::ResourceFileHandle *)v10, filename, v3);
      v2 = v11;
    }
    UFG::qBaseTreeRB::Add(&UFG::qChunkFileSystem::mFileHandles.mTree, v2);
    return (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v2;
  }
  return result;
}

// File Line: 621
// RVA: 0x16F520
bool __fastcall UFG::qChunkFileSystem::GetChunkFileIndexEntry(
        UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> **out_index_file,
        UFG::qChunkFileIndexEntry **out_chunk_file_index,
        unsigned int filename_uid)
{
  UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *mNext; // rbx
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *mPrev; // rax
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *v7; // rcx
  __int64 v8; // r11
  int v9; // r8d
  int v10; // r9d
  int v11; // r8d
  __int64 v12; // rax
  unsigned int v13; // ecx
  bool result; // al
  UFG::qChunkFileIndexEntry *v15; // rcx

  mNext = (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)UFG::qChunkFileSystem::mLoadedIndexFiles.mNode.mNext;
  if ( (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)UFG::qChunkFileSystem::mLoadedIndexFiles.mNode.mNext == &UFG::qChunkFileSystem::mLoadedIndexFiles )
  {
LABEL_17:
    *out_index_file = 0i64;
    result = 0;
    *out_chunk_file_index = 0i64;
  }
  else
  {
    while ( 1 )
    {
      mPrev = mNext[8].mNode.mPrev;
      if ( mPrev )
      {
        v7 = mPrev[5].mNext;
        v8 = v7 ? (__int64)&mPrev[5].mNext + (_QWORD)v7 : 0i64;
        v9 = (int)mPrev[6].mPrev;
        if ( v8 )
        {
          if ( v9 )
          {
            v10 = 0;
            v11 = v9 - 1;
            if ( v11 >= 0 )
            {
              do
              {
                v12 = (unsigned int)(v11 + v10) >> 1;
                v13 = *(_DWORD *)(v8 + 20 * v12);
                if ( v13 >= filename_uid )
                {
                  if ( v13 <= filename_uid )
                    goto LABEL_15;
                  v11 = v12 - 1;
                }
                else
                {
                  v10 = v12 + 1;
                }
              }
              while ( v10 <= v11 );
            }
            LODWORD(v12) = -1 - v10;
LABEL_15:
            if ( (int)v12 >= 0 )
              break;
          }
        }
      }
      mNext = (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)mNext->mNode.mNext;
      if ( mNext == &UFG::qChunkFileSystem::mLoadedIndexFiles )
        goto LABEL_17;
    }
    *out_index_file = mNext;
    v15 = (UFG::qChunkFileIndexEntry *)(v8 + 20i64 * (int)v12);
    result = 1;
    *out_chunk_file_index = v15;
  }
  return result;
}

// File Line: 655
// RVA: 0x16FAA0
UFG::ResourceLoadTable *__fastcall UFG::qChunkFileSystem::GetCreatedLoadTable(unsigned int load_table_uid)
{
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v2; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *i; // rcx

  if ( !load_table_uid )
    return 0i64;
  v2 = &UFG::qChunkFileSystem::mCreatedLoadTables;
  while ( 1 )
  {
    mUID = v2->mTree.mRoot.mUID;
    if ( v2 != &UFG::qChunkFileSystem::mCreatedLoadTables && mUID == load_table_uid )
      break;
    if ( load_table_uid > mUID )
      v2 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v2->mTree.mRoot.mChild[1];
    else
      v2 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v2->mTree.mRoot.mChild[0];
    if ( v2 == (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)&UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL )
      return 0i64;
  }
  for ( i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v2->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != load_table_uid )
      break;
    v2 = i;
  }
  if ( v2 )
    return (UFG::ResourceLoadTable *)&v2[-1].mTree.mNULL.mUID;
  else
    return 0i64;
}

// File Line: 995
// RVA: 0x176AD0
void __fastcall UFG::qChunkFileSystem::Load(
        const char *filename,
        unsigned __int64 allocation_params,
        UFG::allocator::free_link *callback,
        UFG::allocator::free_link *callback_param,
        UFG::ResourceFileContentType content_type)
{
  UFG::qChunkFileSystem::Load(filename, UFG::gMainMemoryPool, allocation_params, callback, callback_param, content_type);
}

// File Line: 1000
// RVA: 0x1768F0
void __fastcall UFG::qChunkFileSystem::Load(
        const char *filename,
        UFG::qMemoryPool *memory_pool,
        unsigned __int64 allocation_params,
        UFG::allocator::free_link *callback,
        UFG::allocator::free_link *callback_param,
        UFG::ResourceFileContentType content_type)
{
  unsigned int v10; // edi
  const char *v11; // r8
  char i; // al
  UFG::qMemoryPool *v13; // rcx
  UFG::allocator::free_link *v14; // rbx
  int v15; // ecx

  v10 = -1;
  if ( filename )
  {
    v11 = filename;
    for ( i = *filename; *v11; i = *v11 )
    {
      if ( i <= 122 && i >= 97 )
        i -= 32;
      ++v11;
      v10 = (v10 << 8) ^ sCrcTable32[(unsigned __int8)(i ^ HIBYTE(v10))];
    }
  }
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_WARNING,
    "[Resource - SingleLoad] uid=0x%08x MemoryPool(%p) params(%u64) %s\n");
  v13 = UFG::gMainMemoryPool;
  if ( !UFG::gMainMemoryPool )
  {
    UFG::InternalSetupMainMemoryPool((UFG *)UFG::gMainMemoryPool);
    v13 = UFG::gMainMemoryPool;
  }
  v14 = UFG::qMemoryPool::Allocate(v13, 0x70ui64, "OneOffLoadTable", 0i64, 1u);
  if ( v14 )
  {
    v15 = (int)UFG::qChunkFileSystem::mNextLoadTableUID;
    LODWORD(UFG::qChunkFileSystem::mNextLoadTableUID) = (_DWORD)UFG::qChunkFileSystem::mNextLoadTableUID + 1;
    v14->mNext = v14;
    v14[1].mNext = v14;
    v14[2].mNext = 0i64;
    v14[3].mNext = 0i64;
    v14[4].mNext = 0i64;
    LODWORD(v14[5].mNext) = v10;
    LODWORD(v14[6].mNext) = 0;
    v14[9].mNext = v14 + 9;
    v14[10].mNext = v14 + 9;
    LODWORD(v14[11].mNext) = 0;
    HIDWORD(v14[11].mNext) = v15;
    LODWORD(v14[12].mNext) = v10;
    v14[13].mNext = 0i64;
    v14[7].mNext = callback;
    v14[8].mNext = callback_param;
  }
  else
  {
    v14 = 0i64;
  }
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - Created_Table] tab=%p uid=0x%08x  state=%d\n");
  UFG::qBaseTreeRB::Add(&UFG::qChunkFileSystem::mSingleFileLoadTables.mTree, (UFG::qBaseNodeRB *)&v14[2]);
  UFG::ResourceLoadTable::Add(
    (UFG::ResourceLoadTable *)v14,
    filename,
    memory_pool,
    allocation_params,
    0i64,
    0,
    content_type);
  UFG::qChunkFileSystem::Internal_Load((UFG::ResourceLoadTable *)v14);
}

// File Line: 1123
// RVA: 0x17F0C0
void __fastcall UFG::qChunkFileSystem::Unload(char *filename)
{
  unsigned int v1; // r8d
  char v2; // al
  const char *i; // r10

  v1 = -1;
  if ( filename )
  {
    v2 = *filename;
    for ( i = filename; *i; v2 = *i )
    {
      if ( v2 <= 122 && v2 >= 97 )
        v2 -= 32;
      ++i;
      v1 = (v1 << 8) ^ sCrcTable32[(unsigned __int8)(v2 ^ HIBYTE(v1))];
    }
  }
  UFG::qChunkFileSystem::Unload(v1, filename);
}

// File Line: 1130
// RVA: 0x17ED90
void __fastcall UFG::qChunkFileSystem::Unload(unsigned int filename_uid, const char *filename)
{
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v3; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v5; // rax
  unsigned int v6; // ecx
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *i; // rcx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *j; // rcx
  UFG::LoadedChunkFile *mParent; // rcx

  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_WARNING,
    "[Resource - SingleUnload] uid=0x%08x %s\n");
  if ( filename_uid )
  {
    v3 = &UFG::qChunkFileSystem::mSingleFileLoadTables;
    while ( 1 )
    {
      mUID = v3->mTree.mRoot.mUID;
      if ( v3 != &UFG::qChunkFileSystem::mSingleFileLoadTables && mUID == filename_uid )
        break;
      if ( filename_uid > mUID )
        v3 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v3->mTree.mRoot.mChild[1];
      else
        v3 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v3->mTree.mRoot.mChild[0];
      if ( v3 == (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)&UFG::qChunkFileSystem::mSingleFileLoadTables.mTree.mNULL )
        goto LABEL_9;
    }
    for ( i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v3->mTree.mRoot.mChild[0];
          i;
          i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)i->mTree.mRoot.mChild[0] )
    {
      if ( i->mTree.mRoot.mUID != filename_uid )
        break;
      v3 = i;
    }
    if ( v3 && v3 != (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)16 )
    {
      UFG::qChunkFileSystem::Internal_Unload((UFG::ResourceLoadTable *)&v3[-1].mTree.mNULL.mUID, 0);
      return;
    }
LABEL_9:
    v5 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
    while ( 1 )
    {
      v6 = v5->mTree.mRoot.mUID;
      if ( v5 != &UFG::qChunkFileSystem::mLoadedChunkFiles && v6 == filename_uid )
        break;
      if ( filename_uid > v6 )
        v5 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v5->mTree.mRoot.mChild[1];
      else
        v5 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v5->mTree.mRoot.mChild[0];
      if ( v5 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
        return;
    }
    for ( j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v5->mTree.mRoot.mChild[0];
          j;
          j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)j->mTree.mRoot.mChild[0] )
    {
      if ( j->mTree.mRoot.mUID != filename_uid )
        break;
      v5 = j;
    }
    if ( v5 )
    {
      mParent = (UFG::LoadedChunkFile *)v5->mTree.mNULL.mParent;
      if ( mParent )
        UFG::qChunkFileSystem::Unload(mParent);
    }
  }
}

// File Line: 1307
// RVA: 0x17EEB0
void __fastcall UFG::qChunkFileSystem::Unload(UFG::LoadedChunk *loaded_chunk)
{
  UFG::ResourceFile::State mState; // eax

  if ( loaded_chunk )
  {
    if ( loaded_chunk->mRefs-- == 1 )
    {
      UFG::qUserCallback_WaitForGPU((UFG *)loaded_chunk);
      mState = loaded_chunk->mState;
      switch ( mState )
      {
        case STATE_PHONE_CONTACTS:
          UFG::ResourceFile::WarehouseUnload(loaded_chunk);
          UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
            (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunks,
            (UFG::qBaseNodeVariableRB<unsigned __int64> *)&loaded_chunk->mNode);
          --UFG::LoadedChunk::sLoadedChunkCount;
          loaded_chunk->mTransactionNum = -loaded_chunk->mTransactionNum;
LABEL_9:
          UFG::ResourceFile::~ResourceFile(loaded_chunk);
          UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)loaded_chunk);
          return;
        case STATE_ROOT_MENU:
          loaded_chunk->mState = STATE_TEXT_INBOX;
          UFG::qFileSystem::KillAsyncOps(
            &UFG::gQuarkFileSystem,
            1,
            1,
            (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)UFG::qChunkFileSystem::ResourceSystem_LoadedChunkCallback,
            (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)loaded_chunk->UFG::ResourceFile::UFG::qResourceData::UFG::qNodeRB<UFG::qResourceData>::mNode.mUID,
            0i64);
          return;
        case STATE_IDLE:
          UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
            (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunks,
            (UFG::qBaseNodeVariableRB<unsigned __int64> *)&loaded_chunk->mNode);
          --UFG::LoadedChunk::sLoadedChunkCount;
          loaded_chunk->mTransactionNum = -loaded_chunk->mTransactionNum;
          goto LABEL_9;
      }
    }
  }
}

// File Line: 1379
// RVA: 0x17EFB0
void __fastcall UFG::qChunkFileSystem::Unload(UFG::LoadedChunkFile *chunk_file)
{
  UFG *v2; // rcx
  UFG::ResourceFile::State mState; // eax
  UFG::qNode<UFG::qFileOp,UFG::qFileOp> *callback_param; // [rsp+20h] [rbp-18h]

  if ( chunk_file )
  {
    UFG::qPrintChannel::Print(
      &UFG::qChunkFileSystem::mResourceChannel,
      OUTPUT_LEVEL_DEBUG,
      "[Resource - Unload] loaded_chunk_file_uid=0x%08x refs=%4d %s\n");
    if ( chunk_file->mRefs-- == 1 )
    {
      UFG::qUserCallback_WaitForGPU(v2);
      mState = chunk_file->mState;
      switch ( mState )
      {
        case STATE_PHONE_CONTACTS:
          UFG::ResourceFile::WarehouseUnload(chunk_file);
LABEL_8:
          UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
            (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunkFiles,
            (UFG::qBaseNodeVariableRB<unsigned __int64> *)&chunk_file->mNode);
          UFG::LoadedChunkFile::~LoadedChunkFile(chunk_file);
          UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)chunk_file);
          return;
        case STATE_ROOT_MENU:
          callback_param = (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)chunk_file->UFG::ResourceFile::UFG::qResourceData::UFG::qNodeRB<UFG::qResourceData>::mNode.mUID;
          chunk_file->mState = STATE_TEXT_INBOX;
          UFG::qFileSystem::KillAsyncOps(
            &UFG::gQuarkFileSystem,
            1,
            1,
            (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileGetSize,
            callback_param,
            0i64);
          UFG::qFileSystem::KillAsyncOps(
            &UFG::gQuarkFileSystem,
            1,
            1,
            (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileCallback,
            (UFG::qNode<UFG::qFileOp,UFG::qFileOp> *)chunk_file->UFG::ResourceFile::UFG::qResourceData::UFG::qNodeRB<UFG::qResourceData>::mNode.mUID,
            0i64);
          return;
        case STATE_IDLE:
          goto LABEL_8;
      }
    }
  }
}

// File Line: 1447
// RVA: 0x17B1B0
void __fastcall UFG::qChunkFileSystem::ResourceSystem_LoadedChunkCallback(UFG::qFileOp *file_op, void *callback_param)
{
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *v3; // rax
  unsigned int mUID; // r8d
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *i; // rcx
  UFG::qBaseNodeRB *mParent; // rbx
  __int64 v7; // rax
  __int64 v9; // rax
  UFG::qFileOp::OpType mType; // eax
  unsigned __int64 mResult1; // rax
  const char *v12; // rcx
  void *mBuffer; // [rsp+28h] [rbp-20h]

  if ( !(_DWORD)callback_param )
    goto LABEL_15;
  v3 = &UFG::qChunkFileSystem::mLoadedChunks;
  while ( 1 )
  {
    mUID = v3->mTree.mRoot.mUID;
    if ( v3 != &UFG::qChunkFileSystem::mLoadedChunks && mUID == (_DWORD)callback_param )
      break;
    if ( (unsigned int)callback_param > mUID )
      v3 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v3->mTree.mRoot.mChild[1];
    else
      v3 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v3->mTree.mRoot.mChild[0];
    if ( v3 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL )
      goto LABEL_15;
  }
  for ( i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v3->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != (_DWORD)callback_param )
      break;
    v3 = i;
  }
  if ( v3 )
    mParent = v3->mTree.mNULL.mParent;
  else
LABEL_15:
    mParent = 0i64;
  mBuffer = file_op->mBuffer;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - LoadedChunkCallback]   %s file op uid=0x%08x to buffer %p\n");
  if ( mParent )
  {
    v7 = *(_QWORD *)&mParent[4].mUID;
    if ( !v7 || *(_DWORD *)(v7 + 20) == 1 && *(_QWORD *)&mParent[3].mUID )
      UFG::qVRAMemoryPools::Unlock((UFG::qVRAMemoryHandle *)mParent[3].mChild);
    if ( HIDWORD(mParent[5].mChild[0])-- == 1 )
      UFG::ResourceFile::NotifyWaitingTables((UFG::ResourceFile *)mParent);
    v9 = SLODWORD(mParent[5].mChild[1]);
    if ( (_DWORD)v9 == 3 )
    {
      if ( !HIDWORD(mParent[5].mChild[0]) )
      {
        UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
          (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunks,
          (UFG::qBaseNodeVariableRB<unsigned __int64> *)&mParent[6].mUID);
        --UFG::LoadedChunk::sLoadedChunkCount;
        LODWORD(mParent[6].mChild[1]) = -LODWORD(mParent[6].mChild[1]);
        UFG::ResourceFile::~ResourceFile((UFG::ResourceFile *)mParent);
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)mParent);
        UFG::qChunkFileSystem::mCheckTablesForCallbacks = 1;
        return;
      }
      goto LABEL_35;
    }
    if ( (_DWORD)v9 == 1 )
    {
      if ( *(_DWORD *)file_op->mStatus == 4 )
      {
LABEL_35:
        UFG::qChunkFileSystem::mCheckTablesForCallbacks = 1;
        return;
      }
      if ( *(_DWORD *)file_op->mStatus == 3 )
      {
        mType = file_op->mType;
        if ( mType == OP_READ_AND_DECOMPRESS )
        {
          mResult1 = file_op->mResult1;
        }
        else
        {
          if ( mType != OP_READ )
          {
LABEL_34:
            UFG::ResourceFile::WarehouseLoad((UFG::ResourceFile *)mParent);
            goto LABEL_35;
          }
          mResult1 = file_op->mResult0;
        }
        mParent[5].mParent = (UFG::qBaseNodeRB *)mResult1;
        goto LABEL_34;
      }
    }
    if ( (unsigned int)v9 > 3 )
      v12 = "<uknown>";
    else
      v12 = off_14203C5B0[v9];
    LODWORD(mBuffer) = *(_DWORD *)file_op->mStatus;
    UFG::qPrintf(
      0i64,
      "[qChunkFileSystem] ERROR: Unhandled async loading state! uid=0x%08x  num=%4d  chk=%s  op=%d \n",
      mParent->mUID,
      LODWORD(mParent[6].mChild[1]),
      v12,
      mBuffer,
      -2i64);
  }
}

// File Line: 1537
// RVA: 0x17B580
void __fastcall UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileGetSize(
        UFG::qFileOp *file_op,
        void *callback_param)
{
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v4; // rax
  unsigned int mUID; // edx
  UFG::qBaseNodeRB *mParent; // rbx
  signed __int64 mResultNumBytesRead; // rbp
  const char *v8; // r8
  char *Buffer; // rax
  __int64 v10; // rcx
  char *v11; // r14
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *i; // rcx
  char *callback_parama; // [rsp+28h] [rbp-30h]

  if ( !(_DWORD)callback_param )
    goto LABEL_9;
  v4 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
  while ( 1 )
  {
    mUID = v4->mTree.mRoot.mUID;
    if ( v4 != &UFG::qChunkFileSystem::mLoadedChunkFiles && mUID == (_DWORD)callback_param )
      break;
    if ( (unsigned int)callback_param > mUID )
      v4 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v4->mTree.mRoot.mChild[1];
    else
      v4 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v4->mTree.mRoot.mChild[0];
    if ( v4 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
      goto LABEL_9;
  }
  for ( i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v4->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != (_DWORD)callback_param )
      break;
    v4 = i;
  }
  if ( v4 )
    mParent = v4->mTree.mNULL.mParent;
  else
LABEL_9:
    mParent = 0i64;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - ResourceSystem_LoadedChunkFileGetSize]   %s file op uid=0x%08x size %u64\n");
  if ( mParent )
  {
    --HIDWORD(mParent[5].mChild[0]);
    if ( *(_DWORD *)file_op->mStatus == 3 )
    {
      mResultNumBytesRead = file_op->mResultNumBytesRead;
      if ( HIDWORD(mParent[5].mChild[0]) )
        return;
      if ( mResultNumBytesRead > 0 )
      {
        callback_parama = UFG::LoadedChunkFile::GetChunkFilename((UFG::LoadedChunkFile *)mParent);
        UFG::qPrintChannel::Print(
          &UFG::qChunkFileSystem::mResourceChannel,
          OUTPUT_LEVEL_WARNING,
          "[Resource - FileSizeCallback]     Starting read of 0x%08x64 bytes for uid:0x%08x from file %s\n");
        v8 = (const char *)mParent[7].mChild[0];
        if ( !v8 )
          v8 = (char *)&mParent[1].mChild[1] + 4;
        Buffer = UFG::ResourceMemoryHandle::AllocateBuffer(
                   (UFG::ResourceMemoryHandle *)mParent[3].mChild,
                   mResultNumBytesRead,
                   v8,
                   (unsigned __int64)mParent->mUID << 32,
                   0xE8C45525);
        v10 = *(_QWORD *)&mParent[4].mUID;
        v11 = Buffer;
        if ( !v10 || *(_DWORD *)(v10 + 20) == 1 && *(_QWORD *)&mParent[3].mUID )
          UFG::qVRAMemoryPools::Lock((UFG::qVRAMemoryHandle *)mParent[3].mChild);
        UFG::qReadAsync(
          callback_parama,
          v11,
          mResultNumBytesRead,
          0i64,
          UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileCallback,
          callback_param,
          QPRIORITY_NORMAL);
        ++HIDWORD(mParent[5].mChild[0]);
        return;
      }
      UFG::qPrintChannel::Print(
        &UFG::qChunkFileSystem::mResourceChannel,
        OUTPUT_LEVEL_ERROR,
        "[Resource - LoadChunkFile] skipping uid=0x%08x, file %s does not exist or size is 0\n");
    }
    else
    {
      UFG::qPrintChannel::Print(
        &UFG::qChunkFileSystem::mResourceChannel,
        OUTPUT_LEVEL_ERROR,
        "[Resource - LoadChunkFile] Error Getting file size for %s\n");
      if ( HIDWORD(mParent[5].mChild[0]) )
        return;
    }
    UFG::ResourceFile::NotifyWaitingTables((UFG::ResourceFile *)mParent);
    --LODWORD(mParent[5].mChild[0]);
    LODWORD(mParent[5].mChild[1]) = 3;
    UFG::qChunkFileSystem::mCheckTablesForCallbacks = 1;
    UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
      (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunkFiles,
      (UFG::qBaseNodeVariableRB<unsigned __int64> *)&mParent[7].mUID);
    UFG::LoadedChunkFile::~LoadedChunkFile((UFG::LoadedChunkFile *)mParent);
    UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)mParent);
  }
}

// File Line: 1601
// RVA: 0x17B3A0
void __fastcall UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileCallback(
        UFG::qFileOp *file_op,
        void *callback_param)
{
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v3; // rax
  unsigned int mUID; // r8d
  UFG::qBaseNodeRB *mParent; // rbx
  __int64 v6; // rax
  int v8; // eax
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *i; // rcx

  if ( !(_DWORD)callback_param )
    goto LABEL_9;
  v3 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
  while ( 1 )
  {
    mUID = v3->mTree.mRoot.mUID;
    if ( v3 != &UFG::qChunkFileSystem::mLoadedChunkFiles && mUID == (_DWORD)callback_param )
      break;
    if ( (unsigned int)callback_param > mUID )
      v3 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v3->mTree.mRoot.mChild[1];
    else
      v3 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v3->mTree.mRoot.mChild[0];
    if ( v3 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
      goto LABEL_9;
  }
  for ( i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v3->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != (_DWORD)callback_param )
      break;
    v3 = i;
  }
  if ( v3 )
    mParent = v3->mTree.mNULL.mParent;
  else
LABEL_9:
    mParent = 0i64;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - LoadedChunkFileCallback]   %s file op uid=0x%08x to buffer %p\n");
  if ( mParent )
  {
    v6 = *(_QWORD *)&mParent[4].mUID;
    if ( !v6 || *(_DWORD *)(v6 + 20) == 1 && *(_QWORD *)&mParent[3].mUID )
      UFG::qVRAMemoryPools::Unlock((UFG::qVRAMemoryHandle *)mParent[3].mChild);
    if ( HIDWORD(mParent[5].mChild[0])-- == 1 )
      UFG::ResourceFile::NotifyWaitingTables((UFG::ResourceFile *)mParent);
    v8 = (int)mParent[5].mChild[1];
    if ( v8 == 3 )
    {
      if ( !HIDWORD(mParent[5].mChild[0]) )
      {
        UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
          (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mLoadedChunkFiles,
          (UFG::qBaseNodeVariableRB<unsigned __int64> *)&mParent[7].mUID);
        UFG::LoadedChunkFile::~LoadedChunkFile((UFG::LoadedChunkFile *)mParent);
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)mParent);
        UFG::qChunkFileSystem::mCheckTablesForCallbacks = 1;
        return;
      }
      goto LABEL_29;
    }
    if ( v8 == 1 )
    {
      if ( *(_DWORD *)file_op->mStatus == 4 )
      {
LABEL_29:
        UFG::qChunkFileSystem::mCheckTablesForCallbacks = 1;
        return;
      }
      if ( *(_DWORD *)file_op->mStatus == 3 )
      {
        mParent[5].mParent = (UFG::qBaseNodeRB *)file_op->mResult0;
        UFG::ResourceFile::WarehouseLoad((UFG::ResourceFile *)mParent);
        goto LABEL_29;
      }
    }
    UFG::qPrintChannel::Print(
      &UFG::qChunkFileSystem::mResourceChannel,
      OUTPUT_LEVEL_ERROR,
      "[qChunkFileSystem] ERROR: Unhandled async loading state! uid=0x%08x  chk=%s  op=%d \n");
  }
}

// File Line: 1712
// RVA: 0x17AF90
_BOOL8 __fastcall UFG::qChunkFileSystem::ResourceSystem_CheckForUnusedFileHandles(char header_printed)
{
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v2; // rdx
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v3; // r8
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *i; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v5; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *j; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v7; // rbx
  UFG::qBaseNodeRB *mParent; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v9; // rcx
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *m; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v11; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v12; // rcx
  char v13; // al
  UFG::qFile *v14; // rcx
  UFG::qBaseNodeRB *p_mNULL; // rdi
  char *v16; // rdx
  UFG::qBaseNodeRB *v17; // rcx
  UFG::qBaseNodeRB *v18; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v19; // rcx
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *k; // rax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v21; // rax

  v2 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0];
  v3 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0];
  for ( i = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0]->mChild[0];
        i != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL;
        i = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)i->mTree.mRoot.mChild[0] )
  {
    v3 = i;
  }
  v5 = 0i64;
  if ( v3 != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL )
    v5 = v3;
  if ( v5 )
  {
LABEL_6:
    for ( j = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v2->mTree.mRoot.mChild[0];
          j != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL;
          j = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)j->mTree.mRoot.mChild[0] )
    {
      v2 = j;
    }
    v7 = 0i64;
    if ( v2 != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL )
      v7 = v2;
    while ( v7 )
    {
      mParent = v7[1].mTree.mRoot.mParent;
      if ( !mParent || !LODWORD(mParent[4].mChild[1]) )
      {
        v13 = header_printed;
        if ( !header_printed )
          v13 = 1;
        header_printed = v13;
        UFG::qPrintChannel::Print(
          &UFG::qChunkFileSystem::mResourceChannel,
          OUTPUT_LEVEL_WARNING,
          "[Resource - Service]       Closing unused file handle uid:0x%08x %s\n");
        UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
          (UFG::qBaseTreeVariableRB<unsigned __int64> *)&UFG::qChunkFileSystem::mFileHandles,
          (UFG::qBaseNodeVariableRB<unsigned __int64> *)v7);
        v14 = (UFG::qFile *)v7[1].mTree.mRoot.mParent;
        if ( v14 )
        {
          UFG::qCloseAsync(v14, 0i64, 0i64, QPRIORITY_NORMAL);
          v7[1].mTree.mRoot.mParent = 0i64;
        }
        p_mNULL = &v7->mTree.mNULL;
        v16 = *(char **)&v7->mTree.mNULL.mUID;
        if ( v16 != UFG::qString::sEmptyString && v16 )
          UFG::qMemoryPool::Free(UFG::gMainMemoryPool, v16);
        LODWORD(v7->mTree.mNULL.mChild[1]) = 0;
        v17 = p_mNULL->mParent;
        v18 = v7->mTree.mNULL.mChild[0];
        v17->mChild[0] = v18;
        v18->mParent = v17;
        p_mNULL->mParent = p_mNULL;
        v7->mTree.mNULL.mChild[0] = &v7->mTree.mNULL;
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)v7);
        if ( UFG::qChunkFileSystem::mFileHandles.mTree.mCount )
        {
          v2 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0];
          v19 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0];
          for ( k = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)UFG::qChunkFileSystem::mFileHandles.mTree.mRoot.mChild[0]->mChild[0];
                k != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL;
                k = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)k->mTree.mRoot.mChild[0] )
          {
            v19 = k;
          }
          v21 = 0i64;
          if ( v19 != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL )
            v21 = v19;
          if ( v21 )
            goto LABEL_6;
        }
        return (unsigned __int8)header_printed;
      }
      v9 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v7->mTree.mRoot.mChild[1];
      if ( &UFG::qChunkFileSystem::mFileHandles.mTree.mNULL == (UFG::qBaseNodeRB *)v9 )
      {
        v11 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)((unsigned __int64)v7->mTree.mRoot.mParent & 0xFFFFFFFFFFFFFFFEui64);
        if ( v7 == (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v11->mTree.mRoot.mChild[1] )
        {
          do
          {
            v12 = v11;
            v11 = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)((unsigned __int64)v11->mTree.mRoot.mParent & 0xFFFFFFFFFFFFFFFEui64);
          }
          while ( v12 == (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v11->mTree.mRoot.mChild[1] );
        }
        v7 = v11;
        if ( v11 == &UFG::qChunkFileSystem::mFileHandles )
          v7 = 0i64;
      }
      else
      {
        for ( m = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)v9->mTree.mRoot.mChild[0];
              m != (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)&UFG::qChunkFileSystem::mFileHandles.mTree.mNULL;
              m = (UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *)m->mTree.mRoot.mChild[0] )
        {
          v9 = m;
        }
        v7 = v9;
      }
    }
  }
  return (unsigned __int8)header_printed;
}

// File Line: 1747
// RVA: 0x17AE60
_BOOL8 __fastcall UFG::qChunkFileSystem::ResourceSystem_CheckForFinishedLoadTables(char header_printed)
{
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mNext; // rbx
  UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *v3; // rdi
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mPrev; // rcx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v5; // rax
  char v6; // al
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v7; // rax

  if ( UFG::qChunkFileSystem::mCheckTablesForCallbacks )
  {
    mNext = UFG::qChunkFileSystem::mLoadTablesLoading.mNode.mNext;
    if ( (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesLoading.mNode.mNext != &UFG::qChunkFileSystem::mLoadTablesLoading )
    {
      do
      {
        v3 = (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)mNext->mNext;
        if ( !LODWORD(mNext[5].mNext) )
        {
          mPrev = mNext->mPrev;
          v5 = mNext->mNext;
          mPrev->mNext = v5;
          v5->mPrev = mPrev;
          v6 = header_printed;
          mNext->mPrev = mNext;
          mNext->mNext = mNext;
          if ( !header_printed )
            v6 = 1;
          header_printed = v6;
          if ( LODWORD(mNext[3].mPrev) == 3 )
          {
            UFG::qPrintChannel::Print(
              &UFG::qChunkFileSystem::mResourceChannel,
              OUTPUT_LEVEL_WARNING,
              "[Resource - Service]       Scheduling cancel callback on load table uid:0x%08x at %p\n");
            LODWORD(mNext[3].mPrev) = 5;
          }
          else
          {
            UFG::qPrintChannel::Print(
              &UFG::qChunkFileSystem::mResourceChannel,
              OUTPUT_LEVEL_WARNING,
              "[Resource - Service]       Scheduling complete callback on load table uid:0x%08x at %p\n");
            LODWORD(mNext[3].mPrev) = 4;
          }
          v7 = UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev;
          UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev->mNext = mNext;
          mNext->mPrev = v7;
          mNext->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesCallback;
          UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev = mNext;
        }
        mNext = &v3->mNode;
      }
      while ( v3 != &UFG::qChunkFileSystem::mLoadTablesLoading );
    }
    UFG::qChunkFileSystem::mCheckTablesForCallbacks = 0;
  }
  return (unsigned __int8)header_printed;
}

// File Line: 1799
// RVA: 0x17B7F0
__int64 __fastcall UFG::qChunkFileSystem::ResourceSystem_MakeLoadTableCallbacks(bool header_printed)
{
  bool v1; // dl
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mNext; // rbx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mPrev; // rcx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v4; // rax
  char v5; // al
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v6; // rsi
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v7; // r15
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v8; // r14
  bool v9; // bp
  unsigned int mNext_high; // edi
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v11; // r12
  unsigned int v12; // r13d
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v13; // rax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v14; // rdx
  const char *v15; // rdx
  const char *v16; // rcx
  int v18; // ecx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v19; // rax
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v20; // rcx
  UFG::qMemoryPool *v21; // rdi
  UFG::qMemoryPool *v22; // rcx
  UFG::qNode<UFG::qString,UFG::qString> *v23; // rcx
  UFG::qNode<UFG::qString,UFG::qString> *v24; // rax
  UFG::qString v26; // [rsp+38h] [rbp-60h] BYREF
  unsigned __int8 v27; // [rsp+A0h] [rbp+8h]
  unsigned int v28; // [rsp+A8h] [rbp+10h]

  v1 = header_printed;
  mNext = UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mNext;
  if ( (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mNext == &UFG::qChunkFileSystem::mLoadTablesCallback )
    return header_printed;
  while ( 1 )
  {
    mPrev = mNext->mPrev;
    v4 = mNext->mNext;
    mPrev->mNext = v4;
    v4->mPrev = mPrev;
    mNext->mPrev = mNext;
    mNext->mNext = mNext;
    v5 = v1;
    if ( !v1 )
      v5 = 1;
    v27 = v5;
    UFG::qPrintChannel::Print(
      &UFG::qChunkFileSystem::mResourceChannel,
      OUTPUT_LEVEL_WARNING,
      "[Resource - Service]       Invoking Callback on table uid:0x%08x at %p\n");
    v6 = 0i64;
    v7 = 0i64;
    v8 = 0i64;
    v9 = LODWORD(mNext[3].mPrev) == 4;
    mNext_high = HIDWORD(mNext[5].mNext);
    v28 = mNext_high;
    v11 = mNext[4].mPrev;
    v26.mPrev = &v26;
    v26.mNext = &v26;
    *(_QWORD *)&v26.mMagic = 16909060i64;
    v26.mData = (char *)UFG::qString::sEmptyString;
    *(_QWORD *)&v26.mStringHash32 = -1i64;
    v12 = 0;
    if ( LODWORD(mNext[6].mPrev) == -1 )
    {
      v8 = mNext[3].mNext;
    }
    else
    {
      v13 = mNext[5].mPrev;
      v14 = v13[2].mNext;
      if ( v14 && HIDWORD(v14[1].mPrev) )
      {
        v15 = (const char *)v14[1].mNext;
        if ( !v15 || v15 == UFG::qString::sEmptyString )
        {
          v18 = 0;
        }
        else
        {
          v16 = v15;
          while ( *v16++ )
            ;
          v18 = (_DWORD)v16 - (_DWORD)v15 - 1;
        }
        UFG::qString::Set(&v26, v15, v18, 0i64, 0);
        v6 = mNext[3].mNext;
      }
      else
      {
        v12 = (unsigned int)v13[3].mPrev;
        v7 = mNext[3].mNext;
      }
    }
    if ( v9 )
    {
      LODWORD(mNext[3].mPrev) = 7;
      v19 = UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev;
      UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev->mNext = mNext;
      mNext->mPrev = v19;
      mNext->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesLoaded;
      UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev = mNext;
    }
    else
    {
      LODWORD(mNext[3].mPrev) = 0;
      UFG::qPrintChannel::Print(
        &UFG::qChunkFileSystem::mResourceChannel,
        OUTPUT_LEVEL_DEBUG,
        "[Resource - Internal_Destroy] tab=%p uid=0x%08x  state=%d\n");
      v20 = &UFG::qChunkFileSystem::mSingleFileLoadTables;
      if ( LODWORD(mNext[6].mPrev) == -1 )
        v20 = &UFG::qChunkFileSystem::mCreatedLoadTables;
      UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
        (UFG::qBaseTreeVariableRB<unsigned __int64> *)v20,
        (UFG::qBaseNodeVariableRB<unsigned __int64> *)&mNext[1]);
      v21 = (UFG::qMemoryPool *)mNext[6].mNext;
      UFG::ResourceLoadTable::~ResourceLoadTable((UFG::ResourceLoadTable *)mNext);
      v22 = UFG::gMainMemoryPool;
      if ( v21 )
        v22 = v21;
      UFG::qMemoryPool::Free(v22, (char *)mNext);
      mNext_high = v28;
    }
    if ( v6 )
    {
      ((void (__fastcall *)(char *, bool, UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *))v6)(
        v26.mData,
        v9,
        v11);
    }
    else if ( v7 )
    {
      ((void (__fastcall *)(_QWORD, bool, UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *))v7)(v12, v9, v11);
    }
    else if ( v8 )
    {
      ((void (__fastcall *)(_QWORD, bool, UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *))v8)(
        mNext_high,
        v9,
        v11);
    }
    if ( v26.mData != UFG::qString::sEmptyString )
    {
      if ( v26.mData )
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, v26.mData);
    }
    v26.mMagic = 0;
    v23 = v26.mPrev;
    v24 = v26.mNext;
    v26.mPrev->mNext = v26.mNext;
    v24->mPrev = v23;
    v26.mPrev = &v26;
    v26.mNext = &v26;
    mNext = UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mNext;
    if ( (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mNext == &UFG::qChunkFileSystem::mLoadTablesCallback )
      break;
    v1 = v27;
  }
  return v27;
}

// File Line: 1892
// RVA: 0x1745A0
void __fastcall UFG::qChunkFileSystem::Internal_Load(UFG::ResourceLoadTable *load_table)
{
  UFG::ResourceLoadTable *v1; // r12
  __int64 mNext; // r13
  UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *p_mTableEntries; // rdx
  unsigned int v4; // ebx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *v5; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *i; // rcx
  UFG::qBaseNodeRB *mParent; // rbp
  UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *v9; // r15
  UFG::qChunkFileIndexEntry *v10; // rdi
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *mPrev; // rax
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *v12; // rcx
  __int64 v13; // r10
  int v14; // r8d
  int v15; // r9d
  int v16; // r8d
  __int64 v17; // rax
  unsigned int v18; // ecx
  unsigned int mUncompressedSize; // ecx
  unsigned int mByteSize; // eax
  unsigned int v21; // edx
  bool v22; // dl
  unsigned int v23; // esi
  UFG::qMemoryPool *v24; // rcx
  UFG::allocator::free_link *v25; // rax
  UFG::qBaseNodeRB *v26; // rax
  __int64 v27; // rdx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v28; // rax
  unsigned int v29; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *j; // rcx
  UFG::qBaseNodeRB *v31; // rdi
  unsigned int ResourceFileUID; // edi
  UFG::ResourceFileContentType v33; // ecx
  UFG::qMemoryPool *v34; // rcx
  UFG::allocator::free_link *v35; // rax
  UFG::qBaseNodeRB *v36; // rax
  int v37; // eax
  char *ChunkFilename; // rax
  int v39; // eax
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v40; // r14
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *ResourceFileHandle; // rax
  bool v42; // cl
  __int64 v43; // r15
  unsigned int v44; // ecx
  __int64 v45; // r12
  __int64 read_bytes; // rsi
  int v47; // eax
  unsigned int v48; // edx
  bool v49; // bl
  UFG::ResourceMemoryHandle *mChild; // r13
  __int64 v51; // rax
  UFG::ResourceMemoryHandle *v52; // rcx
  bool v53; // zf
  void *callback_param; // rbx
  __int64 scratch_size; // rbp
  void *scratch_buffer; // r14
  __int64 BufferSize; // r15
  char *Buffer; // rax
  __int64 v59; // rbp
  char *v60; // rax
  void *v61; // rbx
  char *v62; // rax
  UFG::ResourceMemoryHandle *v63; // rcx
  __int64 v64; // rbx
  void *v65; // rdi
  __int64 v66; // rsi
  char *v67; // rax
  __int64 v68; // rax
  __int64 v69; // rdi
  __int64 v70; // r15
  char *v71; // rsi
  __int64 v72; // rbx
  char *v73; // rax
  __int64 v74; // rax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v75; // rax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v76; // rax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v77; // rax
  UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *v78; // [rsp+70h] [rbp-78h]
  char *v79; // [rsp+78h] [rbp-70h]
  UFG::qTreeRB<UFG::ResourceFileHandle,UFG::ResourceFileHandle,1> *v80; // [rsp+80h] [rbp-68h]
  __int64 seek_offset; // [rsp+88h] [rbp-60h]
  UFG::LoadedIndexFile *out_index_file; // [rsp+F8h] [rbp+10h] BYREF
  UFG::qChunkFileIndexEntry *out_chunk_file_index; // [rsp+100h] [rbp+18h] BYREF
  __int64 v85; // [rsp+108h] [rbp+20h]

  v1 = load_table;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - Internal_Load] tab=%p uid=0x%08x  state=%d\n");
  v1->mState = STATE_ROOT_MENU;
  mNext = (__int64)v1->mTableEntries.mNode.mNext;
  v85 = mNext;
  p_mTableEntries = &v1->mTableEntries;
  v78 = &v1->mTableEntries;
  if ( (UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *)mNext != &v1->mTableEntries )
  {
    while ( 1 )
    {
      v4 = *(_DWORD *)(mNext + 48);
      if ( v4 != -1 )
      {
        if ( !v4 )
          goto LABEL_17;
        v5 = &UFG::qChunkFileSystem::mLoadedChunks;
        while ( 1 )
        {
          mUID = v5->mTree.mRoot.mUID;
          if ( v5 != &UFG::qChunkFileSystem::mLoadedChunks && mUID == v4 )
            break;
          if ( v4 > mUID )
            v5 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v5->mTree.mRoot.mChild[1];
          else
            v5 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v5->mTree.mRoot.mChild[0];
          if ( v5 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL )
            goto LABEL_17;
        }
        for ( i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v5->mTree.mRoot.mChild[0];
              i;
              i = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)i->mTree.mRoot.mChild[0] )
        {
          if ( i->mTree.mRoot.mUID != v4 )
            break;
          v5 = i;
        }
        if ( v5 )
          mParent = v5->mTree.mNULL.mParent;
        else
LABEL_17:
          mParent = 0i64;
        v9 = 0i64;
        out_index_file = 0i64;
        v10 = 0i64;
        out_chunk_file_index = 0i64;
        if ( !mParent )
        {
          v9 = (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)UFG::qChunkFileSystem::mLoadedIndexFiles.mNode.mNext;
          if ( (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)UFG::qChunkFileSystem::mLoadedIndexFiles.mNode.mNext == &UFG::qChunkFileSystem::mLoadedIndexFiles )
          {
LABEL_60:
            v27 = *(_QWORD *)(mNext + 40);
            if ( !v27 || !*(_DWORD *)(v27 + 20) )
              goto LABEL_94;
            if ( !v4 )
              goto LABEL_157;
            v28 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
            while ( 1 )
            {
              v29 = v28->mTree.mRoot.mUID;
              if ( v28 != &UFG::qChunkFileSystem::mLoadedChunkFiles && v29 == v4 )
                break;
              if ( v4 > v29 )
                v28 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v28->mTree.mRoot.mChild[1];
              else
                v28 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v28->mTree.mRoot.mChild[0];
              if ( v28 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
                goto LABEL_76;
            }
            for ( j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v28->mTree.mRoot.mChild[0];
                  j;
                  j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)j->mTree.mRoot.mChild[0] )
            {
              if ( j->mTree.mRoot.mUID != v4 )
                break;
              v28 = j;
            }
            if ( v28 )
            {
              v31 = v28->mTree.mNULL.mParent;
            }
            else
            {
LABEL_157:
            {
LABEL_76:
              ResourceFileUID = v4;
              v33 = *(_DWORD *)(mNext + 52);
              if ( v33 )
                ResourceFileUID = UFG::GenerateResourceFileUID(v33, *(const char **)(v27 + 24));
            }
              v34 = UFG::gMainMemoryPool;
              if ( !UFG::gMainMemoryPool )
              {
                UFG::InternalSetupMainMemoryPool((UFG *)UFG::gMainMemoryPool);
                v34 = UFG::gMainMemoryPool;
              }
              v35 = UFG::qMemoryPool::Allocate(v34, 0x128ui64, "ResourceFileSystem.LoadedChunkFile", 0i64, 1u);
              out_index_file = (UFG::LoadedIndexFile *)v35;
              if ( v35 )
              {
                UFG::LoadedChunkFile::LoadedChunkFile(
                  (UFG::LoadedChunkFile *)v35,
                  v4,
                  ResourceFileUID,
                  *(const char **)(*(_QWORD *)(mNext + 40) + 24i64),
                  *(UFG::AllocationProfile **)(mNext + 16));
                v31 = v36;
              }
              else
              {
                v31 = 0i64;
              }
              UFG::qBaseTreeRB::Add(
                &UFG::qChunkFileSystem::mLoadedChunkFiles.mTree,
                (UFG::qBaseNodeRB *)((char *)v31 + 248));
            }
            if ( v31 )
            {
              ++LODWORD(v31[5].mChild[0]);
              v37 = (int)v31[5].mChild[1];
              if ( v37 != 2 )
              {
                if ( v37 == 1 )
                {
                  UFG::ResourceFile::AddWaitingTable((UFG::ResourceFile *)v31, v1);
                }
                else if ( !v37 || v37 == 3 )
                {
                  UFG::qPrintChannel::Print(
                    &UFG::qChunkFileSystem::mResourceChannel,
                    OUTPUT_LEVEL_DEBUG,
                    "[Resource - Internal_Load]     state change %s -> LOADING\n");
                  LODWORD(v31[5].mChild[1]) = 1;
                  ChunkFilename = UFG::LoadedChunkFile::GetChunkFilename((UFG::LoadedChunkFile *)v31);
                  if ( v1->mCallbacks.mFilename )
                  {
                    UFG::qGetFileSizeAsync(
                      ChunkFilename,
                      UFG::qChunkFileSystem::ResourceSystem_LoadedChunkFileGetSize,
                      (void *)LODWORD(v31[8].mChild[1]),
                      QPRIORITY_NORMAL);
                    ++HIDWORD(v31[5].mChild[0]);
                    UFG::ResourceFile::AddWaitingTable((UFG::ResourceFile *)v31, v1);
                  }
                  else if ( !UFG::LoadedChunkFile::LoadSync((UFG::LoadedChunkFile *)v31) )
                  {
                    UFG::qPrintChannel::Print(
                      &UFG::qChunkFileSystem::mResourceChannel,
                      OUTPUT_LEVEL_ERROR,
                      "[Resource - Internal_Load]     failed to load file %s\n");
                  }
                }
              }
            }
            else
            {
LABEL_94:
              UFG::qPrintChannel::Print(
                &UFG::qChunkFileSystem::mResourceChannel,
                OUTPUT_LEVEL_WARNING,
                "[Resource - Internal_Load]   Couldnt find index or filename for 0x%08x %s\n");
            }
LABEL_148:
            p_mTableEntries = &v1->mTableEntries;
            goto LABEL_149;
          }
          while ( 1 )
          {
            mPrev = v9[8].mNode.mPrev;
            if ( mPrev )
            {
              v12 = mPrev[5].mNext;
              v13 = v12 ? (__int64)&mPrev[5].mNext + (_QWORD)v12 : 0i64;
              v14 = (int)mPrev[6].mPrev;
              if ( v13 )
              {
                if ( v14 )
                {
                  v15 = 0;
                  v16 = v14 - 1;
                  if ( v16 >= 0 )
                  {
                    do
                    {
                      v17 = (unsigned int)(v16 + v15) >> 1;
                      v18 = *(_DWORD *)(v13 + 20 * v17);
                      if ( v18 >= v4 )
                      {
                        if ( v18 <= v4 )
                          goto LABEL_33;
                        v16 = v17 - 1;
                      }
                      else
                      {
                        v15 = v17 + 1;
                      }
                    }
                    while ( v15 <= v16 );
                  }
                  LODWORD(v17) = -1 - v15;
LABEL_33:
                  if ( (int)v17 >= 0 )
                    break;
                }
              }
            }
            v9 = (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)v9->mNode.mNext;
            if ( v9 == &UFG::qChunkFileSystem::mLoadedIndexFiles )
              goto LABEL_60;
          }
          out_index_file = (UFG::LoadedIndexFile *)v9;
          v10 = (UFG::qChunkFileIndexEntry *)(v13 + 20i64 * (int)v17);
          out_chunk_file_index = v10;
          mUncompressedSize = v10->mUncompressedSize;
          if ( mUncompressedSize )
            mByteSize = v10->mUncompressedSize;
          else
            mByteSize = v10->mByteSize;
          v22 = 0;
          if ( *(_QWORD *)(mNext + 24) )
          {
            v21 = mUncompressedSize
                ? mUncompressedSize
                + ((unsigned __int8)v10->mDecompressionPaddingHi << 8)
                + (unsigned __int8)v10->mDecompressionPaddingLow
                : v10->mByteSize;
            if ( *(_DWORD *)(mNext + 32) > v21 )
              v22 = 1;
          }
          if ( mUncompressedSize )
            v23 = mUncompressedSize
                + ((unsigned __int8)v10->mDecompressionPaddingHi << 8)
                + (unsigned __int8)v10->mDecompressionPaddingLow;
          else
            v23 = v10->mByteSize;
          if ( mByteSize != v10->mByteSize && v22 )
          {
            v23 = v10->mUncompressedSize;
            if ( !mUncompressedSize )
              v23 = v10->mByteSize;
          }
          v24 = UFG::gMainMemoryPool;
          if ( !UFG::gMainMemoryPool )
          {
            UFG::InternalSetupMainMemoryPool((UFG *)UFG::gMainMemoryPool);
            v24 = UFG::gMainMemoryPool;
          }
          v25 = UFG::qMemoryPool::Allocate(v24, 0x100ui64, "ResourceFileSystem.LoadedChunk", 0i64, 1u);
          if ( v25 )
          {
            UFG::LoadedChunk::LoadedChunk((UFG::LoadedChunk *)v25, v4, *(UFG::AllocationProfile **)(mNext + 16), v23);
            mParent = v26;
          }
          else
          {
            mParent = 0i64;
          }
          UFG::qBaseTreeRB::Add(
            &UFG::qChunkFileSystem::mLoadedChunks.mTree,
            (UFG::qBaseNodeRB *)((char *)mParent + 216));
          if ( !mParent )
            goto LABEL_94;
          p_mTableEntries = &v1->mTableEntries;
        }
        ++LODWORD(mParent[5].mChild[0]);
        v39 = (int)mParent[5].mChild[1];
        if ( v39 != 2 )
          break;
      }
LABEL_149:
      mNext = *(_QWORD *)(mNext + 8);
      v85 = mNext;
      if ( (UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *)mNext == p_mTableEntries )
        goto LABEL_150;
    }
    if ( v39 == 1 )
    {
      UFG::ResourceFile::AddWaitingTable((UFG::ResourceFile *)mParent, v1);
      goto LABEL_148;
    }
    if ( v39 && v39 != 3 )
      goto LABEL_149;
    if ( !v10 )
    {
      UFG::qChunkFileSystem::GetChunkFileIndexEntry(
        (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> **)&out_index_file,
        &out_chunk_file_index,
        v4);
      v9 = (UFG::qList<UFG::LoadedIndexFile,UFG::LoadedIndexFile,1,0> *)out_index_file;
      v10 = out_chunk_file_index;
    }
    v40 = 0i64;
    v80 = 0i64;
    v42 = 0;
    if ( v9 )
    {
      v79 = UFG::LoadedIndexFile::GetChunkFilename((UFG::LoadedIndexFile *)v9);
      ResourceFileHandle = UFG::qChunkFileSystem::GetResourceFileHandle(v79);
      v40 = ResourceFileHandle;
      v80 = ResourceFileHandle;
      if ( ResourceFileHandle )
      {
        if ( ResourceFileHandle[1].mTree.mRoot.mParent )
          v42 = 1;
      }
    }
    if ( !v10 || !v42 )
    {
      _((AMD_HD3D *)&UFG::qChunkFileSystem::mResourceChannel);
      goto LABEL_148;
    }
    UFG::qPrintChannel::Print(
      &UFG::qChunkFileSystem::mResourceChannel,
      OUTPUT_LEVEL_DEBUG,
      "[Resource - Internal_Load]     state change %s -> LOADING\n");
    LODWORD(mParent[5].mChild[1]) = 1;
    v43 = v10->mLowerPosition | ((unsigned __int64)(unsigned __int8)v10->mUpperPosition << 32);
    seek_offset = v43;
    v44 = v10->mUncompressedSize;
    if ( v44 )
      v45 = v44
          + (unsigned __int8)v10->mDecompressionPaddingLow
          + ((unsigned __int8)v10->mDecompressionPaddingHi << 8)
          - v10->mByteSize;
    else
      v45 = 0i64;
    read_bytes = v10->mByteSize;
    LODWORD(out_chunk_file_index) = v10->mByteSize;
    v47 = v44;
    if ( !v44 )
      v47 = read_bytes;
    LOBYTE(out_index_file) = v47 != (_DWORD)read_bytes;
    v49 = 0;
    if ( *(_QWORD *)(mNext + 24) )
    {
      v48 = v44
          ? v44 + ((unsigned __int8)v10->mDecompressionPaddingHi << 8) + (unsigned __int8)v10->mDecompressionPaddingLow
          : read_bytes;
      if ( *(_DWORD *)(mNext + 32) > v48 )
        v49 = 1;
    }
    mChild = (UFG::ResourceMemoryHandle *)mParent[3].mChild;
    v51 = *(_QWORD *)&mParent[4].mUID;
    if ( !v51 || *(_DWORD *)(v51 + 20) == 1 && *(_QWORD *)&mParent[3].mUID )
      UFG::qVRAMemoryPools::Lock((UFG::qVRAMemoryHandle *)mParent[3].mChild);
    UFG::ResourceMemoryHandle::GetBuffer((UFG::ResourceMemoryHandle *)mParent[3].mChild);
    UFG::qPrintChannel::Print(
      &UFG::qChunkFileSystem::mResourceChannel,
      OUTPUT_LEVEL_WARNING,
      "[Resource - Internal_Load]     Starting read of 0x%08x bytes to buffer %p for uid:0x%08x from file %s\n");
    if ( load_table->mCallbacks.mFilename )
    {
      UFG::ResourceFile::AddWaitingTable((UFG::ResourceFile *)mParent, load_table);
      ++HIDWORD(mParent[5].mChild[0]);
      v52 = (UFG::ResourceMemoryHandle *)mParent[3].mChild;
      if ( (_BYTE)out_index_file == 1 )
      {
        v53 = v49;
        callback_param = (void *)LODWORD(mParent[7].mChild[1]);
        if ( v53 )
        {
          scratch_size = *(unsigned int *)(v85 + 32);
          scratch_buffer = *(void **)(v85 + 24);
          BufferSize = UFG::ResourceMemoryHandle::GetBufferSize(v52);
          Buffer = UFG::ResourceMemoryHandle::GetBuffer(mChild);
          UFG::qReadAndDecompressAsync(
            (UFG::qFile *)v80[1].mTree.mRoot.mParent,
            Buffer,
            BufferSize,
            seek_offset,
            QSEEK_SET,
            (unsigned int)v45,
            read_bytes,
            0i64,
            scratch_buffer,
            scratch_size,
            1,
            UFG::qChunkFileSystem::ResourceSystem_LoadedChunkCallback,
            callback_param,
            QPRIORITY_NORMAL);
        }
        else
        {
          v59 = UFG::ResourceMemoryHandle::GetBufferSize(v52);
          v60 = UFG::ResourceMemoryHandle::GetBuffer(mChild);
          UFG::qReadAndDecompressAsync(
            (UFG::qFile *)v40[1].mTree.mRoot.mParent,
            v60,
            v59,
            v43,
            QSEEK_SET,
            (unsigned int)v45,
            read_bytes,
            0i64,
            0i64,
            0i64,
            1,
            UFG::qChunkFileSystem::ResourceSystem_LoadedChunkCallback,
            callback_param,
            QPRIORITY_NORMAL);
        }
      }
      else
      {
        v61 = (void *)LODWORD(mParent[7].mChild[1]);
        v62 = UFG::ResourceMemoryHandle::GetBuffer(v52);
        UFG::qReadAsync(
          (UFG::qFile *)v40[1].mTree.mRoot.mParent,
          v62,
          read_bytes,
          v43,
          QSEEK_SET,
          UFG::qChunkFileSystem::ResourceSystem_LoadedChunkCallback,
          v61,
          QPRIORITY_NORMAL);
      }
LABEL_146:
      v1 = load_table;
      mNext = v85;
      p_mTableEntries = v78;
      goto LABEL_149;
    }
    v63 = (UFG::ResourceMemoryHandle *)mParent[3].mChild;
    if ( (_BYTE)out_index_file != 1 )
    {
      v73 = UFG::ResourceMemoryHandle::GetBuffer(v63);
      mParent[5].mParent = (UFG::qBaseNodeRB *)UFG::qRead(
                                                 (UFG::qFile *)v40[1].mTree.mRoot.mParent,
                                                 v73,
                                                 read_bytes,
                                                 v43,
                                                 QSEEK_SET);
LABEL_141:
      v74 = *(_QWORD *)&mParent[4].mUID;
      if ( !v74 || *(_DWORD *)(v74 + 20) == 1 && *(_QWORD *)&mParent[3].mUID )
        UFG::qVRAMemoryPools::Unlock((UFG::qVRAMemoryHandle *)mParent[3].mChild);
      UFG::ResourceFile::WarehouseLoad((UFG::ResourceFile *)mParent);
      goto LABEL_146;
    }
    if ( v49 )
    {
      v64 = *(unsigned int *)(v85 + 32);
      v65 = *(void **)(v85 + 24);
      v66 = UFG::ResourceMemoryHandle::GetBufferSize(v63);
      v67 = UFG::ResourceMemoryHandle::GetBuffer((UFG::ResourceMemoryHandle *)mParent[3].mChild);
      v68 = UFG::qReadAndDecompress(
              (UFG::qFile *)v40[1].mTree.mRoot.mParent,
              v67,
              v66,
              v43,
              QSEEK_SET,
              (unsigned int)v45,
              (unsigned int)out_chunk_file_index,
              0i64,
              v65,
              v64,
              1);
    }
    else
    {
      v69 = read_bytes;
      v70 = UFG::ResourceMemoryHandle::GetBufferSize(v63);
      v71 = UFG::ResourceMemoryHandle::GetBuffer((UFG::ResourceMemoryHandle *)mParent[3].mChild);
      v72 = -1i64;
      if ( !v71
        || v70 < v45 + v69
        || UFG::qRead((UFG::qFile *)v40[1].mTree.mRoot.mParent, &v71[v45], v69, seek_offset, QSEEK_SET) != v69 )
      {
        goto LABEL_139;
      }
      v68 = UFG::qDecompressLZ((UFG::qCompressHeader *)&v71[v45], v69, v71, v70);
    }
    v72 = v68;
LABEL_139:
    mParent[5].mParent = (UFG::qBaseNodeRB *)v72;
    goto LABEL_141;
  }
LABEL_150:
  if ( v1->mCallbacks.mFilename )
  {
    if ( v1->mNumPendingLoads )
    {
      v76 = UFG::qChunkFileSystem::mLoadTablesLoading.mNode.mPrev;
      UFG::qChunkFileSystem::mLoadTablesLoading.mNode.mPrev->mNext = v1;
      v1->mPrev = v76;
      v1->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesLoading;
      UFG::qChunkFileSystem::mLoadTablesLoading.mNode.mPrev = v1;
    }
    else
    {
      v1->mState = STATE_INCOMING_CALL;
      v75 = UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev;
      UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev->mNext = v1;
      v1->mPrev = v75;
      v1->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesCallback;
      UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev = v1;
    }
  }
  else
  {
    v1->mState = STATE_DISPLAY_TEXT;
    v77 = UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev;
    UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev->mNext = v1;
    v1->mPrev = v77;
    v1->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesLoaded;
    UFG::qChunkFileSystem::mLoadTablesLoaded.mNode.mPrev = v1;
  }
}

// File Line: 2244
// RVA: 0x17DA00
void __fastcall UFG::qChunkFileSystem::SortedLoadTableCallback(
        unsigned int load_table_uid,
        bool completed,
        void *callback_param)
{
  UFG::qChunkFileSystem::UnloadLoadTable(load_table_uid, 1);
}

// File Line: 2279
// RVA: 0x17D490
void __fastcall UFG::qChunkFileSystem::SortLoadTable(UFG::ResourceLoadTable *load_table)
{
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *mNext; // r12
  UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *p_mTableEntries; // r15
  UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *v4; // r13
  unsigned int mPrev; // ebx
  unsigned __int64 Ticks; // rsi
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *i; // r14
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *v8; // rcx
  UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *v9; // rdx
  __int64 v10; // r10
  int v11; // r8d
  int v12; // r9d
  int v13; // r8d
  __int64 v14; // rdx
  unsigned int v15; // eax
  __int64 v16; // rdi
  char v17; // bl
  unsigned __int64 v18; // rax
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *v19; // rcx
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *v20; // rax
  unsigned __int64 v21; // rsi
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v22; // rbx
  UFG *v23; // rcx
  UFG::allocator::free_link *v24; // rax
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v25; // rax
  UFG *v26; // rcx
  UFG::qBaseNodeRB *v27; // rdx
  unsigned int v28; // eax
  unsigned __int64 v29; // rax
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *j; // rsi
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v31; // rcx
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v32; // rax
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> **p_mNext; // rdi
  UFG::qBaseNodeVariableRB<unsigned __int64> *v34; // rcx
  UFG::qBaseNodeVariableRB<unsigned __int64> *k; // rax
  UFG::qBaseNodeVariableRB<unsigned __int64> *v36; // rbx
  UFG::qBaseNodeVariableRB<unsigned __int64> *mParent; // rcx
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *v38; // rax
  Render::SkinningCacheNode *Head; // rdi
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v40; // rcx
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v41; // rax
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v42; // rcx
  UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *v43; // rax
  UFG::qList<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode,1,0> v44; // [rsp+38h] [rbp-18h] BYREF

  UFG::qGetTicks();
  v44.mNode.mPrev = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)&v44;
  v44.mNode.mNext = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)&v44;
  mNext = load_table->mTableEntries.mNode.mNext;
  p_mTableEntries = &load_table->mTableEntries;
  if ( mNext != (UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *)&load_table->mTableEntries )
  {
    do
    {
      v4 = (UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *)mNext->mNext;
      mPrev = (unsigned int)mNext[3].mPrev;
      Ticks = UFG::qGetTicks();
      for ( i = UFG::qChunkFileSystem::mLoadedIndexFiles.mNode.mNext;
            i != (UFG::qNode<UFG::LoadedIndexFile,UFG::LoadedIndexFile> *)&UFG::qChunkFileSystem::mLoadedIndexFiles;
            i = i->mNext )
      {
        v8 = i[8].mPrev;
        if ( v8 )
        {
          v9 = v8[5].mNext;
          v10 = v9 ? (__int64)&v9[5].mNext + (_QWORD)v8 : 0i64;
          v11 = (int)v8[6].mPrev;
          if ( v10 )
          {
            if ( v11 )
            {
              v12 = 0;
              v13 = v11 - 1;
              if ( v13 >= 0 )
              {
                do
                {
                  v14 = (unsigned int)(v13 + v12) >> 1;
                  v15 = *(_DWORD *)(v10 + 20 * v14);
                  if ( v15 >= mPrev )
                  {
                    if ( v15 <= mPrev )
                      goto LABEL_17;
                    v13 = v14 - 1;
                  }
                  else
                  {
                    v12 = v14 + 1;
                  }
                }
                while ( v12 <= v13 );
              }
              LODWORD(v14) = -1 - v12;
LABEL_17:
              if ( (int)v14 >= 0 )
              {
                v16 = v10 + 20i64 * (int)v14;
                v17 = 1;
                goto LABEL_21;
              }
            }
          }
        }
      }
      i = 0i64;
      v16 = 0i64;
      v17 = 0;
LABEL_21:
      v18 = UFG::qGetTicks();
      UFG::qGetTickTime(Ticks, v18);
      if ( v17 == 1 )
      {
        v19 = mNext->mPrev;
        v20 = mNext->mNext;
        v19->mNext = v20;
        v20->mPrev = v19;
        mNext->mPrev = mNext;
        mNext->mNext = mNext;
        v21 = UFG::qGetTicks();
        v22 = v44.mNode.mNext;
        if ( (UFG::qList<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode,1,0> *)v44.mNode.mNext == &v44 )
        {
LABEL_25:
          if ( !UFG::gMainMemoryPool )
          {
            if ( (unsigned int)UFG::qAtomicIncrement(&sInitMallocSemaphore) == 1 )
            {
              UFG::gMainMemoryPool = &gMainMemoryPoolBuffer;
              UFG::qMemoryPool::qMemoryPool(&gMainMemoryPoolBuffer);
              UFG::qUserCallback_InitMainPool(v23);
              UFG::qAtomicDecrement(&sInitMallocSemaphore);
            }
            else
            {
              UFG::qAtomicDecrement(&sInitMallocSemaphore);
              while ( sInitMallocSemaphore > 0 )
                UFG::qSleep(1u);
            }
          }
          v24 = UFG::qMemoryPool::Allocate(UFG::gMainMemoryPool, 0x60ui64, "fileSortingNode", 0i64, 1u);
          v22 = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)v24;
          if ( v24 )
          {
            v24->mNext = v24;
            v24[1].mNext = v24;
            v24[2].mNext = (UFG::allocator::free_link *)i;
            v24[3].mNext = 0i64;
            v24[4].mNext = 0i64;
            v24[5].mNext = 0i64;
            v24[7].mNext = 0i64;
            v24[8].mNext = 0i64;
            v24[9].mNext = 0i64;
            v24[7].mNext = (UFG::allocator::free_link *)((unsigned __int64)&v24[7] | (__int64)v24[7].mNext & 1);
            v24[8].mNext = v24 + 7;
            v24[9].mNext = v24 + 7;
            v24[7].mNext = (UFG::allocator::free_link *)((unsigned __int64)v24[7].mNext & ~1ui64);
            LODWORD(v24[10].mNext) = 0;
            v24[3].mNext = (UFG::allocator::free_link *)((unsigned __int64)&v24[7] | (__int64)v24[3].mNext & 1);
            v24[4].mNext = v24 + 7;
            v24[5].mNext = v24 + 7;
            v24[3].mNext = (UFG::allocator::free_link *)((unsigned __int64)v24[3].mNext & ~1ui64);
            LODWORD(v24[6].mNext) = -1;
            LODWORD(v24[11].mNext) = 0;
          }
          else
          {
            v22 = 0i64;
          }
          v25 = v44.mNode.mPrev;
          v44.mNode.mPrev->mNext = v22;
          v22->mPrev = v25;
          v22->mNext = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)&v44;
          v44.mNode.mPrev = v22;
        }
        else
        {
          while ( HIDWORD(v22[1].mPrev[6].mPrev) != HIDWORD(i[6].mPrev) )
          {
            v22 = v22->mNext;
            if ( v22 == (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)&v44 )
              goto LABEL_25;
          }
        }
        if ( !UFG::gMainMemoryPool )
        {
          if ( (unsigned int)UFG::qAtomicIncrement(&sInitMallocSemaphore) == 1 )
          {
            UFG::gMainMemoryPool = &gMainMemoryPoolBuffer;
            UFG::qMemoryPool::qMemoryPool(&gMainMemoryPoolBuffer);
            UFG::qUserCallback_InitMainPool(v26);
            UFG::qAtomicDecrement(&sInitMallocSemaphore);
          }
          else
          {
            UFG::qAtomicDecrement(&sInitMallocSemaphore);
            while ( sInitMallocSemaphore > 0 )
              UFG::qSleep(1u);
          }
        }
        v27 = (UFG::qBaseNodeRB *)UFG::qMemoryPool::Allocate(
                                    UFG::gMainMemoryPool,
                                    0x28ui64,
                                    "entrySortingNode",
                                    0i64,
                                    1u);
        if ( v27 )
        {
          v28 = *(_DWORD *)(v16 + 12);
          v27->mParent = 0i64;
          v27->mChild[0] = 0i64;
          v27->mChild[1] = 0i64;
          v27->mUID = v28;
          v27[1].mParent = (UFG::qBaseNodeRB *)mNext;
        }
        else
        {
          v27 = 0i64;
        }
        UFG::qBaseTreeRB::Add((UFG::qBaseTreeRB *)&v22[1].mNext, v27);
        v29 = UFG::qGetTicks();
        UFG::qGetTickTime(v21, v29);
      }
      mNext = &v4->mNode;
    }
    while ( v4 != p_mTableEntries );
  }
  UFG::qGetTicks();
  for ( j = v44.mNode.mNext;
        (UFG::qList<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode,1,0> *)v44.mNode.mNext != &v44;
        j = v44.mNode.mNext )
  {
    v31 = j->mPrev;
    v32 = j->mNext;
    v31->mNext = v32;
    v32->mPrev = v31;
    j->mPrev = j;
    j->mNext = j;
    if ( LODWORD(j[5].mNext) )
    {
      p_mNext = &j[3].mNext;
      do
      {
        v34 = (UFG::qBaseNodeVariableRB<unsigned __int64> *)j[2].mPrev;
        for ( k = v34->mChild[0]; k != (UFG::qBaseNodeVariableRB<unsigned __int64> *)p_mNext; k = k->mChild[0] )
          v34 = k;
        v36 = 0i64;
        if ( v34 != (UFG::qBaseNodeVariableRB<unsigned __int64> *)p_mNext )
          v36 = v34;
        UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
          (UFG::qBaseTreeVariableRB<unsigned __int64> *)&j[1].mNext,
          v36);
        mParent = v36[1].mParent;
        v38 = p_mTableEntries->mNode.mPrev;
        v38->mNext = (UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *)mParent;
        mParent->mParent = (UFG::qBaseNodeVariableRB<unsigned __int64> *)v38;
        mParent->mChild[0] = (UFG::qBaseNodeVariableRB<unsigned __int64> *)p_mTableEntries;
        p_mTableEntries->mNode.mPrev = (UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *)mParent;
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)v36);
      }
      while ( LODWORD(j[5].mNext) );
    }
    while ( LODWORD(j[5].mNext) )
    {
      Head = UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&j[1].mNext);
      UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
        (UFG::qBaseTreeVariableRB<unsigned __int64> *)&j[1].mNext,
        &Head->mNode);
      if ( Head )
        UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)Head);
    }
    j[1].mNext = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)((unsigned __int64)&j[3].mNext | (__int64)j[1].mNext & 1);
    j[2].mPrev = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)((char *)j + 56);
    j[2].mNext = (UFG::qNode<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode> *)((char *)j + 56);
    LODWORD(j[5].mNext) = 0;
    v40 = j->mPrev;
    v41 = j->mNext;
    v40->mNext = v41;
    v41->mPrev = v40;
    j->mPrev = j;
    j->mNext = j;
    UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)j);
  }
  UFG::qList<UFG::qChunkFileSystem::fileSortingNode,UFG::qChunkFileSystem::fileSortingNode,1,0>::DeleteNodes(&v44);
  v42 = v44.mNode.mPrev;
  v43 = v44.mNode.mNext;
  v44.mNode.mPrev->mNext = v44.mNode.mNext;
  v43->mPrev = v42;
}v;
  v43 = v44.mNode.mNext;
  v44.mNode.mPrev->mNext = v44.mNode.mNext;
  v43->mPrev = v42;
}

// File Line: 2360
// RVA: 0x17BB00
void __fastcall UFG::qChunkFileSystem::ResourceSystem_ServiceDelayedBundleTables(UFG::qChunkFileSystem *this)
{
  unsigned int LoadTable; // esi
  UFG::ResourceLoadTable *CreatedLoadTable; // rax
  UFG::ResourceLoadTable *mNext; // rbx
  UFG::ResourceLoadTable *i; // rdi
  UFG::ResourceLoadTable *v5; // rax
  UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *v6; // rcx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v7; // rcx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mPrev; // rdx

  if ( (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext != &UFG::qChunkFileSystem::mLoadTablesBundleSort )
  {
    LoadTable = UFG::qChunkFileSystem::CreateLoadTable(0i64);
    CreatedLoadTable = UFG::qChunkFileSystem::GetCreatedLoadTable(LoadTable);
    mNext = (UFG::ResourceLoadTable *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext;
    for ( i = CreatedLoadTable;
          mNext != (UFG::ResourceLoadTable *)&UFG::qChunkFileSystem::mLoadTablesBundleSort;
          mNext = (UFG::ResourceLoadTable *)mNext->mNext )
    {
      UFG::ResourceLoadTable::CopyTableEntries(i, mNext);
    }
    UFG::qChunkFileSystem::SortLoadTable(i);
    UFG::qChunkFileSystem::LoadLoadTable(
      LoadTable,
      (void (__fastcall *)(const char *, bool, void *))UFG::qChunkFileSystem::SortedLoadTableCallback,
      0i64,
      0);
    v5 = (UFG::ResourceLoadTable *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext;
    v6 = (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext;
    if ( (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext != &UFG::qChunkFileSystem::mLoadTablesBundleSort )
    {
      do
        v6 = (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)v6->mNode.mNext;
      while ( v6 != &UFG::qChunkFileSystem::mLoadTablesBundleSort );
      for ( ;
            (UFG::qList<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1,0> *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext != &UFG::qChunkFileSystem::mLoadTablesBundleSort;
            v5 = (UFG::ResourceLoadTable *)UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mNext )
      {
        v7 = v5->mNext;
        mPrev = v5->mPrev;
        mPrev->mNext = v7;
        v7->mPrev = mPrev;
        v5->mPrev = v5;
        v5->mNext = v5;
        UFG::qChunkFileSystem::Internal_Load(v5);
      }
    }
  }
}

// File Line: 2408
// RVA: 0x1750A0
void __fastcall UFG::qChunkFileSystem::Internal_Unload(UFG::ResourceLoadTable *load_table, bool reverse_order)
{
  UFG::ResourceLoadTable::State mState; // eax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mNext; // rax
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mPrev; // rcx
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *v7; // rax
  UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *p_mTableEntries; // rdi
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *i; // rbx
  unsigned int v10; // edx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *v11; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v13; // rax
  unsigned int v14; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *j; // rcx
  UFG::LoadedChunk *mParent; // rcx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *k; // rcx
  UFG::LoadedChunkFile *v18; // rcx
  UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *m; // rbx
  unsigned int v20; // edx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *v21; // rax
  unsigned int v22; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *v23; // rax
  unsigned int v24; // ecx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *n; // rcx
  UFG::LoadedChunk *v26; // rcx
  UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *ii; // rcx
  UFG::LoadedChunkFile *v28; // rcx

  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - Internal_Unload] tab=%p uid=0x%08x  state=%d\n");
  mState = load_table->mState;
  switch ( mState )
  {
    case STATE_IDLE:
    case STATE_DISPLAY_TEXT:
      load_table->mState = STATE_IDLE;
      break;
    case STATE_PHONE_CONTACTS:
      mNext = load_table->mNext;
      mPrev = load_table->mPrev;
      load_table->mState = STATE_INCOMING_TEXT;
      mPrev->mNext = mNext;
      mNext->mPrev = mPrev;
      load_table->mPrev = load_table;
      load_table->mNext = load_table;
      v7 = UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev;
      UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev->mNext = load_table;
      load_table->mPrev = v7;
      load_table->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesCallback;
      UFG::qChunkFileSystem::mLoadTablesCallback.mNode.mPrev = load_table;
      break;
    case STATE_ROOT_MENU:
      load_table->mState = STATE_TEXT_INBOX;
      break;
    case STATE_INCOMING_CALL:
      load_table->mState = STATE_OUTGOING_CALL;
      break;
  }
  if ( load_table->mState != STATE_INCOMING_TEXT )
  {
    p_mTableEntries = &load_table->mTableEntries;
    if ( reverse_order )
    {
      for ( i = p_mTableEntries->mNode.mPrev;
            i != (UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *)p_mTableEntries;
            i = i->mPrev )
      {
        v10 = (unsigned int)i[3].mPrev;
        if ( v10 != -1 && v10 )
        {
          v11 = &UFG::qChunkFileSystem::mLoadedChunks;
          while ( 1 )
          {
            mUID = v11->mTree.mRoot.mUID;
            if ( v11 != &UFG::qChunkFileSystem::mLoadedChunks && mUID == v10 )
              break;
            if ( v10 > mUID )
              v11 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v11->mTree.mRoot.mChild[1];
            else
              v11 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v11->mTree.mRoot.mChild[0];
            if ( v11 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL )
              goto LABEL_22;
          }
          for ( j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v11->mTree.mRoot.mChild[0];
                j;
                j = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)j->mTree.mRoot.mChild[0] )
          {
            if ( j->mTree.mRoot.mUID != v10 )
              break;
            v11 = j;
          }
          if ( v11 )
          {
            mParent = (UFG::LoadedChunk *)v11->mTree.mNULL.mParent;
            if ( mParent )
            {
              UFG::qChunkFileSystem::Unload(mParent);
              continue;
            }
          }
LABEL_22:
          v13 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
          while ( 1 )
          {
            v14 = v13->mTree.mRoot.mUID;
            if ( v13 != &UFG::qChunkFileSystem::mLoadedChunkFiles && v14 == v10 )
              break;
            if ( v10 > v14 )
              v13 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v13->mTree.mRoot.mChild[1];
            else
              v13 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v13->mTree.mRoot.mChild[0];
            if ( v13 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
              goto LABEL_42;
          }
          for ( k = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v13->mTree.mRoot.mChild[0];
                k;
                k = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)k->mTree.mRoot.mChild[0] )
          {
            if ( k->mTree.mRoot.mUID != v10 )
              break;
            v13 = k;
          }
          if ( v13 )
          {
            v18 = (UFG::LoadedChunkFile *)v13->mTree.mNULL.mParent;
            if ( v18 )
              UFG::qChunkFileSystem::Unload(v18);
          }
        }
LABEL_42:
        ;
      }
    }
    else
    {
      for ( m = load_table->mTableEntries.mNode.mNext;
            m != (UFG::qNode<UFG::LoadTableEntry,UFG::LoadTableEntry> *)p_mTableEntries;
            m = m->mNext )
      {
        v20 = (unsigned int)m[3].mPrev;
        if ( v20 != -1 && v20 )
        {
          v21 = &UFG::qChunkFileSystem::mLoadedChunks;
          while ( 1 )
          {
            v22 = v21->mTree.mRoot.mUID;
            if ( v21 != &UFG::qChunkFileSystem::mLoadedChunks && v22 == v20 )
              break;
            if ( v20 > v22 )
              v21 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v21->mTree.mRoot.mChild[1];
            else
              v21 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v21->mTree.mRoot.mChild[0];
            if ( v21 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)&UFG::qChunkFileSystem::mLoadedChunks.mTree.mNULL )
              goto LABEL_54;
          }
          for ( n = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)v21->mTree.mRoot.mChild[0];
                n;
                n = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunk *>,UFG::qValueNodeRB<UFG::LoadedChunk *>,1> *)n->mTree.mRoot.mChild[0] )
          {
            if ( n->mTree.mRoot.mUID != v20 )
              break;
            v21 = n;
          }
          if ( v21 )
          {
            v26 = (UFG::LoadedChunk *)v21->mTree.mNULL.mParent;
            if ( v26 )
            {
              UFG::qChunkFileSystem::Unload(v26);
              continue;
            }
          }
LABEL_54:
          v23 = &UFG::qChunkFileSystem::mLoadedChunkFiles;
          while ( 1 )
          {
            v24 = v23->mTree.mRoot.mUID;
            if ( v23 != &UFG::qChunkFileSystem::mLoadedChunkFiles && v24 == v20 )
              break;
            if ( v20 > v24 )
              v23 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v23->mTree.mRoot.mChild[1];
            else
              v23 = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v23->mTree.mRoot.mChild[0];
            if ( v23 == (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)&UFG::qChunkFileSystem::mLoadedChunkFiles.mTree.mNULL )
              goto LABEL_74;
          }
          for ( ii = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)v23->mTree.mRoot.mChild[0];
                ii;
                ii = (UFG::qTreeRB<UFG::qValueNodeRB<UFG::LoadedChunkFile *>,UFG::qValueNodeRB<UFG::LoadedChunkFile *>,1> *)ii->mTree.mRoot.mChild[0] )
          {
            if ( ii->mTree.mRoot.mUID != v20 )
              break;
            v23 = ii;
          }
          if ( v23 )
          {
            v28 = (UFG::LoadedChunkFile *)v23->mTree.mNULL.mParent;
            if ( v28 )
              UFG::qChunkFileSystem::Unload(v28);
          }
        }
LABEL_74:
        ;
      }
    }
  }
  if ( load_table->mState == STATE_IDLE )
    UFG::qChunkFileSystem::Internal_Destroy(load_table);
}

// File Line: 2530
// RVA: 0x174520
void __fastcall UFG::qChunkFileSystem::Internal_Destroy(UFG::ResourceLoadTable *load_table)
{
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v2; // rcx
  UFG::qMemoryPool *mMemoryPool; // rdi
  UFG::qMemoryPool *v4; // rcx

  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_DEBUG,
    "[Resource - Internal_Destroy] tab=%p uid=0x%08x  state=%d\n");
  v2 = &UFG::qChunkFileSystem::mSingleFileLoadTables;
  if ( load_table->mSingleFileUID == -1 )
    v2 = &UFG::qChunkFileSystem::mCreatedLoadTables;
  UFG::qBaseTreeVariableRB<unsigned __int64>::Remove(
    (UFG::qBaseTreeVariableRB<unsigned __int64> *)v2,
    (UFG::qBaseNodeVariableRB<unsigned __int64> *)&load_table->UFG::qNodeRB<UFG::ResourceLoadTable>);
  mMemoryPool = load_table->mMemoryPool;
  UFG::ResourceLoadTable::~ResourceLoadTable(load_table);
  v4 = UFG::gMainMemoryPool;
  if ( mMemoryPool )
    v4 = mMemoryPool;
  UFG::qMemoryPool::Free(v4, (char *)load_table);
}

// File Line: 2578
// RVA: 0x16B050
__int64 __fastcall UFG::qChunkFileSystem::CreateLoadTable(UFG::qMemoryPool *memory_pool)
{
  UFG::qMemoryPool *v2; // rcx
  UFG::allocator::free_link *v3; // rbx
  int v4; // ecx
  unsigned int mNext_high; // edi
  int v6; // ecx

  if ( memory_pool )
  {
    v3 = UFG::qMemoryPool::Allocate(memory_pool, 0x70ui64, "CreatedLoadTable", 0i64, 1u);
    if ( v3 )
    {
      v6 = (int)UFG::qChunkFileSystem::mNextLoadTableUID;
      LODWORD(UFG::qChunkFileSystem::mNextLoadTableUID) = (_DWORD)UFG::qChunkFileSystem::mNextLoadTableUID + 1;
      v3->mNext = v3;
      v3[1].mNext = v3;
      mNext_high = 0;
      v3[2].mNext = 0i64;
      v3[3].mNext = 0i64;
      v3[4].mNext = 0i64;
      LODWORD(v3[5].mNext) = v6;
      LODWORD(v3[6].mNext) = 0;
      v3[9].mNext = v3 + 9;
      v3[10].mNext = v3 + 9;
      LODWORD(v3[11].mNext) = 0;
      HIDWORD(v3[11].mNext) = v6;
      LODWORD(v3[12].mNext) = -1;
      v3[13].mNext = (UFG::allocator::free_link *)memory_pool;
      v3[7].mNext = 0i64;
      v3[8].mNext = 0i64;
    }
    else
    {
      mNext_high = 0;
      v3 = 0i64;
    }
  }
  else
  {
    v2 = UFG::gMainMemoryPool;
    if ( !UFG::gMainMemoryPool )
    {
      UFG::InternalSetupMainMemoryPool((UFG *)UFG::gMainMemoryPool);
      v2 = UFG::gMainMemoryPool;
    }
    v3 = UFG::qMemoryPool::Allocate(v2, 0x70ui64, "CreatedLoadTable", 0i64, 1u);
    if ( v3 )
    {
      v4 = (int)UFG::qChunkFileSystem::mNextLoadTableUID;
      LODWORD(UFG::qChunkFileSystem::mNextLoadTableUID) = (_DWORD)UFG::qChunkFileSystem::mNextLoadTableUID + 1;
      v3->mNext = v3;
      v3[1].mNext = v3;
      mNext_high = 0;
      v3[2].mNext = 0i64;
      v3[3].mNext = 0i64;
      v3[4].mNext = 0i64;
      LODWORD(v3[5].mNext) = v4;
      LODWORD(v3[6].mNext) = 0;
      v3[9].mNext = v3 + 9;
      v3[10].mNext = v3 + 9;
      LODWORD(v3[11].mNext) = 0;
      HIDWORD(v3[11].mNext) = v4;
      LODWORD(v3[12].mNext) = -1;
      v3[13].mNext = 0i64;
      v3[7].mNext = 0i64;
      v3[8].mNext = 0i64;
    }
    else
    {
      mNext_high = 0;
      v3 = 0i64;
    }
  }
  if ( v3 )
    mNext_high = HIDWORD(v3[11].mNext);
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_WARNING,
    "[Resource - CreateLoadTable] tab=%p uid=0x%08x Table: %s\n");
  if ( !v3 )
    return mNext_high;
  UFG::qBaseTreeRB::Add(&UFG::qChunkFileSystem::mCreatedLoadTables.mTree, (UFG::qBaseNodeRB *)&v3[2]);
  return HIDWORD(v3[11].mNext);
}

// File Line: 2764
// RVA: 0x176FB0
bool __fastcall UFG::qChunkFileSystem::LoadLoadTable(
        unsigned int load_table_uid,
        void (__fastcall *callback)(const char *, bool, void *),
        void *callback_param,
        bool bundle_and_sort)
{
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v8; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *i; // rcx
  UFG::ResourceLoadTable *p_mUID; // rbx
  bool v12; // zf
  UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *mPrev; // rax

  if ( !load_table_uid )
    goto LABEL_14;
  v8 = &UFG::qChunkFileSystem::mCreatedLoadTables;
  while ( 1 )
  {
    mUID = v8->mTree.mRoot.mUID;
    if ( v8 != &UFG::qChunkFileSystem::mCreatedLoadTables && mUID == load_table_uid )
      break;
    if ( load_table_uid > mUID )
      v8 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v8->mTree.mRoot.mChild[1];
    else
      v8 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v8->mTree.mRoot.mChild[0];
    if ( v8 == (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)&UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL )
      goto LABEL_14;
  }
  for ( i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v8->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != load_table_uid )
      break;
    v8 = i;
  }
  p_mUID = (UFG::ResourceLoadTable *)&v8[-1].mTree.mNULL.mUID;
  if ( !v8 )
LABEL_14:
    p_mUID = 0i64;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_WARNING,
    "[Resource - LoadLoadTable] uid=0x%08x Table: %s Callback %p param(%p)\n");
  v12 = p_mUID == 0i64;
  if ( p_mUID )
  {
    p_mUID->mCallbacks.mFilename = callback;
    p_mUID->mCallbackParam = callback_param;
    if ( !bundle_and_sort
      || (UFG::qList<UFG::LoadTableEntry,UFG::LoadTableEntry,1,0> *)p_mUID->mTableEntries.mNode.mNext == &p_mUID->mTableEntries )
    {
      UFG::qChunkFileSystem::Internal_Load(p_mUID);
    }
    else
    {
      p_mUID->mState = STATE_PHONE_CONTACTS;
      mPrev = UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mPrev;
      UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mPrev->mNext = p_mUID;
      p_mUID->mPrev = mPrev;
      p_mUID->mNext = (UFG::qNode<UFG::ResourceLoadTable,UFG::ResourceLoadTable> *)&UFG::qChunkFileSystem::mLoadTablesBundleSort;
      UFG::qChunkFileSystem::mLoadTablesBundleSort.mNode.mPrev = p_mUID;
    }
    v12 = p_mUID == 0i64;
  }
  return !v12;
}

// File Line: 2797
// RVA: 0x17F290
bool __fastcall UFG::qChunkFileSystem::UnloadLoadTable(unsigned int load_table_uid, bool reverse_order)
{
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *v4; // rax
  unsigned int mUID; // ecx
  UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *i; // rcx
  UFG::ResourceLoadTable *p_mUID; // rbx
  bool v8; // zf

  if ( !load_table_uid )
    goto LABEL_14;
  v4 = &UFG::qChunkFileSystem::mCreatedLoadTables;
  while ( 1 )
  {
    mUID = v4->mTree.mRoot.mUID;
    if ( v4 != &UFG::qChunkFileSystem::mCreatedLoadTables && mUID == load_table_uid )
      break;
    if ( load_table_uid > mUID )
      v4 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v4->mTree.mRoot.mChild[1];
    else
      v4 = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v4->mTree.mRoot.mChild[0];
    if ( v4 == (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)&UFG::qChunkFileSystem::mCreatedLoadTables.mTree.mNULL )
      goto LABEL_14;
  }
  for ( i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)v4->mTree.mRoot.mChild[0];
        i;
        i = (UFG::qTreeRB<UFG::ResourceLoadTable,UFG::ResourceLoadTable,1> *)i->mTree.mRoot.mChild[0] )
  {
    if ( i->mTree.mRoot.mUID != load_table_uid )
      break;
    v4 = i;
  }
  p_mUID = (UFG::ResourceLoadTable *)&v4[-1].mTree.mNULL.mUID;
  if ( !v4 )
LABEL_14:
    p_mUID = 0i64;
  UFG::qPrintChannel::Print(
    &UFG::qChunkFileSystem::mResourceChannel,
    OUTPUT_LEVEL_WARNING,
    "[Resource - UnloadLoadTable] uid=0x%08x Table: %s\n");
  v8 = p_mUID == 0i64;
  if ( p_mUID )
  {
    UFG::qChunkFileSystem::Internal_Unload(p_mUID, reverse_order);
    v8 = p_mUID == 0i64;
  }
  return !v8;
}

// File Line: 2849
// RVA: 0x166130
// attributes: thunk
void __fastcall UFG::qChunkFileSystem::AddExternalResourceFileReference(
        unsigned int filename_uid,
        char *memory_location,
        unsigned __int64 location_size,
        void *user_data)
{
  UFG::ExternallyLoadedChunk::AddNewChunk(filename_uid, memory_location, location_size, user_data);
}

// File Line: 2854
// RVA: 0x166120
// attributes: thunk
void __fastcall UFG::qChunkFileSystem::AddExternalResourceFileReference(
        unsigned int filename_uid,
        UFG::qVRAMemoryHandle *handle,
        void *user_data)
{
  UFG::ExternallyLoadedChunk::AddNewChunk(filename_uid, handle, user_data);
}

// File Line: 2859
// RVA: 0x17A8C0
void __fastcall UFG::qChunkFileSystem::RemoveExternalResourceFileReference(
        unsigned int filename_uid,
        char *memory_location,
        unsigned __int64 location_size)
{
  UFG::qResourceData *ExistingChunk; // rax
  UFG::ResourceFile *v4; // rbx

  ExistingChunk = (UFG::qResourceData *)UFG::ExternallyLoadedChunk::FindExistingChunk(filename_uid, memory_location);
  v4 = (UFG::ResourceFile *)ExistingChunk;
  if ( ExistingChunk )
  {
    UFG::qResourceInventory::Remove(&UFG::gResourceFileInventory, ExistingChunk);
    --UFG::ExternallyLoadedChunk::sLoadedChunkCount;
    UFG::ResourceFile::~ResourceFile(v4);
    UFG::qMemoryPool::Free(UFG::gMainMemoryPool, (char *)v4);
  }
  else
  {
    UFG::qResourceFileInventory::PrintContents(&UFG::gResourceFileInventory);
  }
}

// File Line: 2864
// RVA: 0x17A8B0
// attributes: thunk
void __fastcall UFG::qChunkFileSystem::RemoveExternalResourceFileReference(
        unsigned int filename_uid,
        UFG::qVRAMemoryHandle *handle)
{
  UFG::ExternallyLoadedChunk::RemoveExistingChunk(filename_uid, handle);
}

// File Line: 2869
// RVA: 0x172F70
__int64 __fastcall UFG::qChunkFileSystem::GetZeroRefResourceFileUserData(void **user_datas, unsigned int max_values)
{
  __int64 v2; // r8
  UFG::qNode<UFG::ResourceFile,UFG::ZeroRefResourceFile> **i; // rax
  UFG::qNode<UFG::ResourceFile,UFG::ZeroRefResourceFile> *v4; // r9

  v2 = 0i64;
  for ( i = &stru_14235B120.mNode.mNext[-6].mNext;
        i != (UFG::qNode<UFG::ResourceFile,UFG::ZeroRefResourceFile> **)&unk_14235B0C8;
        i = &i[12][-6].mNext )
  {
    v4 = i[25];
    if ( v4 )
    {
      user_datas[v2] = v4;
      v2 = (unsigned int)(v2 + 1);
      if ( (_DWORD)v2 == max_values )
        break;
    }
  }
  return (unsigned int)v2;
}

// File Line: 2874
// RVA: 0x16DB00
bool __fastcall UFG::qChunkFileSystem::ExternalChunkMoved(
        unsigned int filename_uid,
        char *old_memory_location,
        char *new_memory_location)
{
  UFG::ExternallyLoadedChunk *ExistingChunk; // rax
  UFG::ExternallyLoadedChunk *v5; // rdx
  UFG::qVRAMemoryPool *mPool; // rcx

  ExistingChunk = UFG::ExternallyLoadedChunk::FindExistingChunk(filename_uid, old_memory_location);
  v5 = ExistingChunk;
  if ( ExistingChunk )
  {
    ExistingChunk->mMemoryHandle.mAllocationProfile->mMemory.mMemoryPool.mAllocationParams = (unsigned __int64)new_memory_location;
    mPool = ExistingChunk->mMemoryHandle.mAllocationProfile->mMemory.mVRAMemoryPool.mPool;
    LOBYTE(ExistingChunk) = 1;
    v5->mMemoryHandle.mAllocateReturned = mPool;
  }
  return (char)ExistingChunk;
}

