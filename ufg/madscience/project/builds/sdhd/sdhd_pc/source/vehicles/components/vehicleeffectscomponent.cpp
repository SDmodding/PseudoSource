// File Line: 64
// RVA: 0x1582D40
__int64 UFG::_dynamic_initializer_for__gSym_M_WheelL01__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_WheelL01, 0xE0335D38);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_WheelL01__);
}

// File Line: 65
// RVA: 0x1582DA0
__int64 UFG::_dynamic_initializer_for__gSym_M_WheelR01__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_WheelR01, 0xF7AF1A62);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_WheelR01__);
}

// File Line: 66
// RVA: 0x1582D70
__int64 UFG::_dynamic_initializer_for__gSym_M_WheelL02__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_WheelL02, 0xED707BE1);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_WheelL02__);
}

// File Line: 67
// RVA: 0x1582DD0
__int64 UFG::_dynamic_initializer_for__gSym_M_WheelR02__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_WheelR02, 0xFAEC3CBB);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_WheelR02__);
}

// File Line: 68
// RVA: 0x1582CE0
__int64 UFG::_dynamic_initializer_for__gSym_M_Wheel01__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_Wheel01, 0x1BF0B5Eu);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_Wheel01__);
}

// File Line: 69
// RVA: 0x1582D10
__int64 UFG::_dynamic_initializer_for__gSym_M_Wheel02__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_M_Wheel02, 0xCFC2D87u);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_M_Wheel02__);
}

// File Line: 70
// RVA: 0x1582C80
__int64 UFG::_dynamic_initializer_for__gSym_E_CTC_Spark01__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_E_CTC_Spark01, 0x28196922u);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_E_CTC_Spark01__);
}

// File Line: 71
// RVA: 0x1582CB0
__int64 UFG::_dynamic_initializer_for__gSym_E_CTC_Spark02__()
{
  UFG::qSymbol::qSymbol((UFG::qWiseSymbol *)&gSym_E_CTC_Spark02, 0x255A4FFBu);
  return atexit(UFG::_dynamic_atexit_destructor_for__gSym_E_CTC_Spark02__);
}

// File Line: 153
// RVA: 0x1582BC0
__int64 UFG::_dynamic_initializer_for__gEffectMapping__()
{
  `eh vector constructor iterator(gEffectMapping, 4ui64, 39, (void (__fastcall *)(void *))BackInfo::BackInfo);
  return atexit(UFG::_dynamic_atexit_destructor_for__gEffectMapping__);
}

// File Line: 157
// RVA: 0x157B8D0
__int64 dynamic_initializer_for__UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList__()
{
  return atexit(dynamic_atexit_destructor_for__UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList__);
}

// File Line: 158
// RVA: 0x67B490
const char *__fastcall UFG::VehicleEffectsComponent::GetTypeName(UFG::VehicleEffectsComponent *this)
{
  return "VehicleEffectsComponent";
}

// File Line: 163
// RVA: 0x67E0C0
void UFG::VehicleEffectsComponent::Initialize(void)
{
  UFG::qWiseSymbol result; // [rsp+30h] [rbp+10h]

  gEffectMapping[0] = (UFG::qSymbol)UFG::qSymbol::qSymbol(&result, 0x68B2D88Bu)->mUID;
  dword_1424358C4 = UFG::qSymbol::qSymbol(&result, 0xDE47AAE4)->mUID;
  dword_1424358C8 = UFG::qSymbol::qSymbol(&result, 0x16121D48u)->mUID;
  dword_1424358CC = UFG::qSymbol::qSymbol(&result, 0xFB3F2CA3)->mUID;
  dword_1424358D0 = UFG::qSymbol::qSymbol(&result, 0xC64DCA4C)->mUID;
  dword_1424358D4 = UFG::qSymbol::qSymbol(&result, 0x69704F24u)->mUID;
  dword_1424358D8 = UFG::qSymbol::qSymbol(&result, 0xF1569F07)->mUID;
  dword_1424358DC = UFG::qSymbol::qSymbol(&result, 0xB1C7D497)->mUID;
  dword_1424358E0 = UFG::qSymbol::qSymbol(&result, 0x72EB2041u)->mUID;
  dword_1424358E4 = UFG::qSymbol::qSymbol(&result, 0xE42BA211)->mUID;
  dword_1424358E8 = UFG::qSymbol::qSymbol(&result, 0xF4AE627C)->mUID;
  dword_1424358EC = UFG::qSymbol::qSymbol(&result, 0x626EE02Cu)->mUID;
  dword_1424358F0 = UFG::qSymbol::qSymbol(&result, 0xDA0D0882)->mUID;
  dword_1424358F4 = UFG::qSymbol::qSymbol(&result, 0xE6D4E6C8)->mUID;
  dword_1424358F8 = UFG::qSymbol::qSymbol(&result, 0x4A66E748u)->mUID;
  dword_1424358FC = UFG::qSymbol::qSymbol(&result, 0x43AD7ADDu)->mUID;
  dword_142435900 = UFG::qSymbol::qSymbol(&result, 0x526076E2u)->mUID;
  dword_142435904 = UFG::qSymbol::qSymbol(&result, 0x87723FFC)->mUID;
  dword_142435908 = UFG::qSymbol::qSymbol(&result, 0x383CD830u)->mUID;
  dword_14243590C = UFG::qSymbol::qSymbol(&result, 0xBE5EDA27)->mUID;
  dword_142435910 = UFG::qSymbol::qSymbol(&result, 0xB7C28598)->mUID;
  dword_142435914 = UFG::qSymbol::qSymbol(&result, 0x2BD12287u)->mUID;
  dword_142435918 = UFG::qSymbol::qSymbol(&result, 0xFCC35764)->mUID;
  dword_14243591C = UFG::qSymbol::qSymbol(&result, 0x1DB38206u)->mUID;
  dword_142435920 = UFG::qSymbol::qSymbol(&result, 0x4BDD6667u)->mUID;
  dword_142435924 = UFG::qSymbol::qSymbol(&result, 0x306A6885u)->mUID;
  dword_142435928 = UFG::qSymbol::qSymbol(&result, 0x7FC9860Au)->mUID;
  dword_14243592C = UFG::qSymbol::qSymbol(&result, 0x74ADF140u)->mUID;
  dword_142435930 = UFG::qSymbol::qSymbol(&result, 0x9D9F30Bu)->mUID;
  dword_142435934 = UFG::qSymbol::qSymbol(&result, 0x2783711Au)->mUID;
  dword_142435938 = UFG::qSymbol::qSymbol(&result, 0x17B1B2D1u)->mUID;
  dword_14243593C = UFG::qSymbol::qSymbol(&result, 0x4AB72539u)->mUID;
  dword_142435940 = UFG::qSymbol::qSymbol(&result, 0x95EDC23C)->mUID;
  dword_142435944 = UFG::qSymbol::qSymbol(&result, 0xF775B35E)->mUID;
  dword_142435948 = UFG::qSymbol::qSymbol(&result, 0xF8532576)->mUID;
  dword_14243594C = UFG::qSymbol::qSymbol(&result, 0xB904107C)->mUID;
  dword_142435950 = UFG::qSymbol::qSymbol(&result, 0x97F6E95F)->mUID;
  dword_142435954 = UFG::qSymbol::qSymbol(&result, 0x37AA47BBu)->mUID;
  dword_142435958 = UFG::qSymbol::qSymbol(&result, 0x23EA247Bu)->mUID;
}

// File Line: 269
// RVA: 0x66AFD0
void __fastcall UFG::VehicleEffectsComponent::VehicleEffectsComponent(UFG::VehicleEffectsComponent *this, UFG::SceneObjectProperties *pSceneObj, component_VehicleEffects *data)
{
  component_VehicleEffects *v3; // rbx
  UFG::SceneObjectProperties *v4; // rsi
  UFG::VehicleEffectsComponent *v5; // r14
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v6; // rdi
  UFG::TransformNodeComponent *v7; // rbp
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v8; // rax
  UFG::qSafeArray<UFG::WheelModelsBinding,4> *v9; // rcx
  UFG::qSafeArray<UFG::PhysicsSurfaceProperties *,4> *v10; // rdx
  UFG::qSafeArray<unsigned long,4> *v11; // rax
  signed __int64 v12; // rdi
  UFG::qMemoryPool *v13; // rax
  UFG::allocator::free_link *v14; // rax
  UFG::TransformNodeComponent *v15; // rax
  UFG::qMemoryPool *v16; // rax
  UFG::allocator::free_link *v17; // rax
  UFG::TransformNodeComponent *v18; // rax
  UFG::qMemoryPool *v19; // rax
  UFG::allocator::free_link *v20; // rax
  UFG::TransformNodeComponent *v21; // rax
  UFG::qMemoryPool *v22; // rax
  UFG::allocator::free_link *v23; // rax
  UFG::TransformNodeComponent *v24; // rax

  v3 = data;
  v4 = pSceneObj;
  v5 = this;
  UFG::SimComponent::SimComponent((UFG::SimComponent *)&this->vfptr, pSceneObj->m_NameUID);
  v6 = (UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *)&v5->mPrev;
  v6->mPrev = v6;
  v6->mNext = v6;
  v5->vfptr = (UFG::qSafePointerNode<UFG::SimComponent>Vtbl *)&UFG::VehicleEffectsComponent::`vftable;
  v5->mDamageTransferUID = -1;
  `eh vector constructor iterator(
    v5->mEffectStatusTable,
    0x18ui64,
    39,
    (void (__fastcall *)(void *))UFG::EffectStatus::EffectStatus);
  UFG::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0>::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0>(&v5->mWaterFloatingTrackerComponent);
  UFG::RebindingComponentHandle<UFG::CompositeDrawableComponent,0>::RebindingComponentHandle<UFG::CompositeDrawableComponent,0>(&v5->mDrawableComponent);
  UFG::RebindingComponentHandle<Render::FXSimComponent,0>::RebindingComponentHandle<Render::FXSimComponent,0>(&v5->mFXComponent);
  UFG::RebindingComponentHandle<UFG::PhysicsMoverInterface,0>::RebindingComponentHandle<UFG::PhysicsMoverInterface,0>(&v5->mMoverComponent);
  UFG::RebindingComponentHandle<UFG::RoadSpaceComponent,0>::RebindingComponentHandle<UFG::RoadSpaceComponent,0>(&v5->mRoadSpaceComponent);
  UFG::RebindingComponentHandle<UFG::VehicleDriverInterface,0>::RebindingComponentHandle<UFG::VehicleDriverInterface,0>(&v5->mVehicleDriverComponent);
  v7 = 0i64;
  v5->mWheelBoneId.p = 0i64;
  *(_QWORD *)&v5->mWheelBoneId.size = 0i64;
  v5->mEffectGroup.mUID = -1;
  *(_QWORD *)&v5->mLevelOfDetail = 0i64;
  v5->mNumQueuedHeadlightChanges = 0;
  v5->mPreTurnLane = 0i64;
  v5->mSpeedLevel = 1;
  v5->mRigUID = -1;
  v5->mVandalizedDamage = 0;
  v5->mDamageRig = 0i64;
  v5->mInitialGrimePercentage = 0.0;
  v5->mInitialGrimeFactor = 1.0;
  v5->mExtinguishFireCountdown = -1.0;
  v5->mAirTime = 0.0;
  v5->mHeadlightFlashesLength = 0.69999999;
  v5->mIsOffGround = 0;
  v5->mFramesOffGround = 0;
  *((_DWORD *)v5 + 471) &= 0xFFFFFF00;
  v8 = UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList.mNode.mPrev;
  UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList.mNode.mPrev->mNext = (UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *)&v5->mPrev;
  v6->mPrev = v8;
  v5->mNext = (UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *)&UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList;
  UFG::VehicleEffectsComponent::s_VehicleEffectsComponentList.mNode.mPrev = (UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *)&v5->mPrev;
  UFG::SimComponent::AddType(
    (UFG::SimComponent *)&v5->vfptr,
    UFG::VehicleEffectsComponent::_VehicleEffectsComponentTypeUID,
    "VehicleEffectsComponent");
  UFG::VehicleEffectsComponent::PropertiesLoad(v5, v4, v3);
  v9 = &v5->mWheelModelBindings;
  v10 = &v5->mLastPhysicsSurfacProperty;
  v11 = &v5->mRimSparksEffect;
  v12 = 4i64;
  do
  {
    v11[-1].array[0] = -1;
    v11->array[0] = -1;
    v11[1].array[0] = -1;
    v11[2].array[0] = -1;
    v10->array[0] = 0i64;
    v11[-2].array[0] = -1;
    v11[-12].array[0] = 0;
    v9->array[0].mModelBindings[0] = 0i64;
    v9->array[0].mModelBindings[1] = 0i64;
    v9->array[0].mModelBindings[2] = 0i64;
    v10 = (UFG::qSafeArray<UFG::PhysicsSurfaceProperties *,4> *)((char *)v10 + 8);
    v11 = (UFG::qSafeArray<unsigned long,4> *)((char *)v11 + 4);
    v9 = (UFG::qSafeArray<UFG::WheelModelsBinding,4> *)((char *)v9 + 24);
    --v12;
  }
  while ( v12 );
  memset(&v5->mTransformNodes, 0, sizeof(v5->mTransformNodes));
  v13 = UFG::GetSimulationMemoryPool();
  v14 = UFG::qMemoryPool::Allocate(v13, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
  if ( v14 )
    UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v14, 0xCA5C386E, 0i64, 0);
  else
    v15 = 0i64;
  v5->mTransformNodes.array[0] = v15;
  v16 = UFG::GetSimulationMemoryPool();
  v17 = UFG::qMemoryPool::Allocate(v16, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
  if ( v17 )
    UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v17, 0xF40235F6, 0i64, 0);
  else
    v18 = 0i64;
  v5->mTransformNodes.array[1] = v18;
  v19 = UFG::GetSimulationMemoryPool();
  v20 = UFG::qMemoryPool::Allocate(v19, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
  if ( v20 )
    UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v20, 0x8CCC0D4C, 0i64, 0);
  else
    v21 = 0i64;
  v5->mTransformNodes.array[2] = v21;
  v22 = UFG::GetSimulationMemoryPool();
  v23 = UFG::qMemoryPool::Allocate(v22, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
  if ( v23 )
  {
    UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v23, 0xE57C3F77, 0i64, 0);
    v7 = v24;
  }
  v5->mTransformNodes.array[3] = v7;
  v5->mHeadlightFlareOnTime = (float)((float)(UFG::qRandom(1.0, &UFG::qDefaultSeed) * 3600.0) * 0.15000001) + 61200.0;
  v5->mHeadlightFlareOffTime = 25200.0 - (float)((float)(UFG::qRandom(1.0, &UFG::qDefaultSeed) * 3600.0) * 0.15000001);
  UFG::qMemSet(v5->mSprayEffects, 0, 0x50u);
}

// File Line: 314
// RVA: 0x687A70
void __fastcall UFG::VehicleEffectsComponent::PropertiesLoad(UFG::VehicleEffectsComponent *this, UFG::SceneObjectProperties *pSceneObj, component_VehicleEffects *data)
{
  UFG::VehicleEffectsComponent *v3; // rbx
  const char *v4; // rsi
  component_VehicleEffects *v5; // rdi
  UFG::SceneObjectProperties *v6; // rbp
  float v7; // xmm0_4
  UFG::qPropertySet *v8; // rcx
  UFG::qPropertySet *v9; // rax
  char *v10; // rcx
  __int64 v11; // rax
  float v12; // xmm0_4

  v3 = this;
  this->mSpeedLevelThreshold[0] = data->Speed0;
  v4 = 0i64;
  this->mSpeedLevelThreshold[1] = data->Speed1;
  v5 = data;
  this->mSpeedLevelThreshold[2] = data->Speed2;
  v6 = pSceneObj;
  this->mSpeedLevelThreshold[3] = data->Speed3;
  *((_DWORD *)this + 471) ^= (*((_DWORD *)this + 471) ^ 32 * (data->headlightsAlwaysOn != 0)) & 0x20;
  *((_DWORD *)this + 471) ^= ((unsigned __int8)*((_DWORD *)this + 471) ^ (unsigned __int8)((data->headlightsAlwaysOff != 0) << 6)) & 0x40;
  v7 = data->GrimeFactor;
  if ( v7 <= 0.0 )
  {
    v7 = 0.0;
  }
  else if ( v7 >= 1.0 )
  {
    v7 = *(float *)&FLOAT_1_0;
  }
  this->mInitialGrimeFactor = v7;
  *((_DWORD *)this + 471) ^= (*((_DWORD *)this + 471) ^ 8
                                                      * (UFG::qRandom(1.0, &UFG::qDefaultSeed) <= data->headlightsInRainProbability)) & 8;
  v3->mEffectGroup.mUID = v5->EffectGroupName.mUID;
  v8 = v6->mpWritableProperties;
  if ( !v8 )
    v8 = v6->mpConstProperties;
  v9 = UFG::qPropertySet::Get<UFG::qPropertySet>(
         v8,
         (UFG::qSymbol *)&component_BaseAnimation::sPropertyName.mUID,
         DEPTH_RECURSE);
  if ( v9 )
    v10 = UFG::qPropertySet::GetMemImagePtr(v9);
  else
    v10 = 0i64;
  v3->mDamageTransferUID = v5->DamageTransfer.mUID;
  v11 = *((_QWORD *)v10 + 1);
  if ( v11 )
    v4 = &v10[v11 + 8];
  v3->mRigUID = UFG::qStringHashUpper32(v4, 0xFFFFFFFF);
  v12 = v5->InitialDirtSeed;
  if ( v12 <= 0.0 )
    v3->mInitialGrimePercentage = 0.0;
  else
    v3->mInitialGrimePercentage = UFG::qRandom(v12, &UFG::qDefaultSeed);
}

// File Line: 340
// RVA: 0x68CB10
void __fastcall UFG::VehicleEffectsComponent::Suspend(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx

  v1 = this;
  UFG::VehicleEffectsComponent::TurnOffEffects(this, 1);
  v1->m_Flags |= 2u;
}

// File Line: 347
// RVA: 0x689A90
void __fastcall UFG::SimComponent::Restore(UFG::SimComponent *this)
{
  this->m_Flags &= 0xFFFDu;
}

// File Line: 354
// RVA: 0x675430
void __fastcall UFG::VehicleEffectsComponent::CreateWheelDamageBinding(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // r13
  UFG::SimObjectGame *v2; // rcx
  UFG::SimComponent *v3; // rbp
  unsigned __int16 v4; // dx
  UFG::SimComponent *v5; // rax
  UFG::SimObjectGame *v6; // rcx
  UFG::SimComponent *v7; // rax
  unsigned __int16 v8; // dx
  unsigned int v9; // er8
  __int64 v10; // rdi
  __int64 v11; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v12; // rdx
  __int64 v13; // rsi
  __int64 v14; // rbx
  signed __int64 v15; // rbx
  unsigned int *v16; // rdi
  unsigned int v17; // edx
  unsigned int v18; // er8
  signed int v19; // eax
  float v20; // xmm1_4
  __int64 v21; // rax
  signed __int64 v22; // rcx
  unsigned int v23; // er12
  __int64 v24; // r14
  signed __int64 v25; // r15
  __int64 v26; // rax
  signed __int64 v27; // rcx
  signed __int64 v28; // rsi
  unsigned int *v29; // rbx
  __int64 v30; // rdi
  ModelType::ModelBindingRigid *v31; // rax
  unsigned int v32; // edx
  ModelType::ModelBindingRigid *v33; // rbp
  unsigned int v34; // [rsp+20h] [rbp-88h]
  UFG::SimComponent *v35; // [rsp+28h] [rbp-80h]
  UFG::SimComponent *v36; // [rsp+30h] [rbp-78h]
  signed __int64 v37; // [rsp+38h] [rbp-70h]
  unsigned int *v38; // [rsp+40h] [rbp-68h]
  __int64 v39; // [rsp+48h] [rbp-60h]
  unsigned int model_index; // [rsp+B0h] [rbp+8h]
  unsigned int wheelIndex; // [rsp+B8h] [rbp+10h]
  unsigned int v42; // [rsp+C0h] [rbp+18h]
  unsigned int v43; // [rsp+C8h] [rbp+20h]

  v1 = this;
  v2 = (UFG::SimObjectGame *)this->m_pSimObject;
  if ( v2 )
  {
    v4 = v2->m_Flags;
    if ( (v4 >> 14) & 1 )
    {
      v3 = v2->m_Components.p[10].m_pComponent;
    }
    else if ( (v4 & 0x8000u) == 0 )
    {
      if ( (v4 >> 13) & 1 )
      {
        v3 = v2->m_Components.p[7].m_pComponent;
      }
      else
      {
        if ( (v4 >> 12) & 1 )
          v5 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::StreamedResourceComponent::_TypeUID);
        else
          v5 = UFG::SimObject::GetComponentOfType(
                 (UFG::SimObject *)&v2->vfptr,
                 UFG::StreamedResourceComponent::_TypeUID);
        v3 = v5;
      }
    }
    else
    {
      v3 = v2->m_Components.p[10].m_pComponent;
    }
  }
  else
  {
    v3 = 0i64;
  }
  v6 = (UFG::SimObjectGame *)v1->m_pSimObject;
  v36 = v3;
  if ( v6 )
  {
    v8 = v6->m_Flags;
    if ( (v8 >> 14) & 1 )
    {
      v7 = v6->m_Components.p[14].m_pComponent;
    }
    else if ( (v8 & 0x8000u) == 0 )
    {
      if ( (v8 >> 13) & 1 )
      {
        v7 = v6->m_Components.p[9].m_pComponent;
      }
      else if ( (v8 >> 12) & 1 )
      {
        v7 = UFG::SimObjectGame::GetComponentOfTypeHK(v6, UFG::CompositeDrawableComponent::_TypeUID);
      }
      else
      {
        v7 = UFG::SimObject::GetComponentOfType((UFG::SimObject *)&v6->vfptr, UFG::CompositeDrawableComponent::_TypeUID);
      }
    }
    else
    {
      v7 = v6->m_Components.p[14].m_pComponent;
    }
  }
  else
  {
    v7 = 0i64;
  }
  v9 = 0;
  v35 = v7;
  model_index = 0;
  if ( v3[4].m_TypeUID )
  {
    do
    {
      v10 = v9;
      v11 = *((unsigned int *)&v3[4].m_pSimObject + 4 * v9);
      if ( (_DWORD)v11 != -1 )
      {
        v12 = v3[4].m_SafePointerList.mNode.mNext;
        v13 = *((_QWORD *)&v12[v9 + 3].mNext->mPrev + v11);
        v39 = v13;
        if ( *(_DWORD *)(v13 + 60) == -1233990156 )
        {
          v14 = HIDWORD(v12[2].mPrev);
          UFG::TrueCrowdDataBase::Instance();
          v15 = 80 * v10 + 1292 * v14;
          v16 = (unsigned int *)((char *)UFG::TrueCrowdDataBase::sTrueCrowdDataBase->mDefinition.mEntities[0].mComponents[0].mBoneUID
                               + v15);
          v38 = (unsigned int *)((char *)UFG::TrueCrowdDataBase::sTrueCrowdDataBase->mDefinition.mEntities[0].mComponents[0].mBoneUID
                               + v15);
          UFG::TrueCrowdDataBase::Instance();
          v17 = *(unsigned int *)((char *)&UFG::TrueCrowdDataBase::sTrueCrowdDataBase->mDefinition.mEntities[0].mComponents[0].mNumBoneUIDs
                                + v15);
          v18 = 0;
          v34 = *(unsigned int *)((char *)&UFG::TrueCrowdDataBase::sTrueCrowdDataBase->mDefinition.mEntities[0].mComponents[0].mNumBoneUIDs
                                + v15);
          while ( 1 )
          {
            v19 = *(unsigned __int16 *)(v13 + 56);
            v43 = v18;
            v20 = (float)v19;
            if ( (float)v19 >= 3.0 )
              v20 = FLOAT_3_0;
            if ( (float)(signed int)v18 >= v20 )
              break;
            v21 = *(_QWORD *)(v13 + 64);
            if ( v21 )
              v22 = v21 + v13 + 64;
            else
              v22 = 0i64;
            v23 = 0;
            v24 = v18;
            v42 = 0;
            v25 = v22 + 16i64 * v18;
            v37 = v25;
            if ( *(_DWORD *)v25 )
            {
              do
              {
                v26 = *(_QWORD *)(v25 + 8);
                if ( v26 )
                  v27 = v26 + v25 + 8;
                else
                  v27 = 0i64;
                v28 = v27 + 16i64 * v23;
                if ( v17 )
                {
                  v29 = v16;
                  v30 = v17;
                  do
                  {
                    v31 = ModelType::FindRigidModelBinding(
                            *((ModelType **)&v35[22].m_SafePointerList.mNode.mNext + v24),
                            *(_DWORD *)(v28 + 8),
                            *v29,
                            model_index);
                    v32 = *v29;
                    v33 = v31;
                    wheelIndex = 0;
                    if ( UFG::VehicleEffectsComponent::GetWheelIndexFromBoneID(v1, v32, &wheelIndex) )
                      v1->mWheelModelBindings.array[0].mModelBindings[v24
                                                                    + 2i64 * (signed int)wheelIndex
                                                                    + (signed int)wheelIndex] = v33;
                    ++v29;
                    --v30;
                  }
                  while ( v30 );
                  v25 = v37;
                  v23 = v42;
                  v17 = v34;
                  v16 = v38;
                }
                v42 = ++v23;
              }
              while ( v23 < *(_DWORD *)v25 );
              v18 = v43;
              v13 = v39;
            }
            ++v18;
          }
          v9 = model_index;
          v3 = v36;
        }
      }
      model_index = ++v9;
    }
    while ( v9 < v3[4].m_TypeUID );
  }
}

// File Line: 401
// RVA: 0x67CAE0
void __fastcall UFG::VehicleEffectsComponent::HandleResourceLoadedEvent(UFG::VehicleEffectsComponent *this, UFG::ResourceRequest *request, bool loaded)
{
  UFG::VehicleEffectsComponent *v3; // rbx
  UFG::qResourceWarehouse *v4; // rax
  UFG::qResourceInventory *v5; // rax

  v3 = this;
  if ( loaded )
  {
    if ( !this->mDamageRig )
    {
      v4 = UFG::qResourceWarehouse::Instance();
      v5 = UFG::qResourceWarehouse::GetInventory(v4, 0x39BC0A7Eu);
      if ( v5 )
      {
        if ( v5->mNode.mUID == 0x39BC0A7E && (__int64)v5->vfptr->Get(v5, v3->mRigUID) )
        {
          UFG::VehicleEffectsComponent::CreateDamageRig(v3);
          UFG::VehicleEffectsComponent::BindEffectMarkers(v3);
        }
      }
    }
    if ( v3->mDamageRig )
      UFG::VehicleEffectsComponent::CreateWheelDamageBinding(v3);
  }
  else
  {
    memset(&this->mWheelModelBindings, 0, sizeof(this->mWheelModelBindings));
  }
}

// File Line: 443
// RVA: 0x688310
UFG::SimComponent *__fastcall UFG::VehicleEffectsComponent::PropertiesOnActivateNew(UFG::SceneObjectProperties *sceneObject, bool required)
{
  bool v2; // bp
  UFG::SceneObjectProperties *v3; // rbx
  UFG::qPropertySet *v4; // rcx
  UFG::qPropertySet *v5; // rax
  UFG::SimComponent *v6; // rsi
  char *v7; // rdi
  UFG::qMemoryPool *v9; // rax
  UFG::allocator::free_link *v10; // rax
  UFG::SimComponent *v11; // rax
  UFG::SimObject *v12; // rdx
  unsigned __int16 v13; // cx
  unsigned int v14; // ebx
  UFG::SimObjectModifier v15; // [rsp+38h] [rbp-30h]

  v2 = required;
  v3 = sceneObject;
  v4 = sceneObject->mpWritableProperties;
  if ( !v4 )
    v4 = v3->mpConstProperties;
  v5 = UFG::qPropertySet::Get<UFG::qPropertySet>(
         v4,
         (UFG::qSymbol *)&component_VehicleEffects::sPropertyName.mUID,
         DEPTH_RECURSE);
  v6 = 0i64;
  if ( v5 )
    v7 = UFG::qPropertySet::GetMemImagePtr(v5);
  else
    v7 = 0i64;
  if ( !v2 && !v7 )
    return 0i64;
  v9 = UFG::GetSimulationMemoryPool();
  v10 = UFG::qMemoryPool::Allocate(v9, 0x760ui64, "VehicleEffectsComponent", 0i64, 1u);
  if ( v10 )
  {
    UFG::VehicleEffectsComponent::VehicleEffectsComponent(
      (UFG::VehicleEffectsComponent *)v10,
      v3,
      (component_VehicleEffects *)v7);
    v6 = v11;
  }
  v12 = v3->m_pSimObject;
  v13 = v12->m_Flags;
  if ( (v13 >> 14) & 1 || (v13 & 0x8000u) == 0 )
    v14 = -1;
  else
    v14 = 32;
  UFG::SimObjectModifier::SimObjectModifier(&v15, v12, 1);
  UFG::SimObjectModifier::AttachComponent(&v15, v6, v14);
  UFG::SimObjectModifier::Close(&v15);
  UFG::SimObjectModifier::~SimObjectModifier(&v15);
  return v6;
}

// File Line: 468
// RVA: 0x67E4A0
void __fastcall UFG::VehicleEffectsComponent::InitializeEffect_New(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id)
{
  UFG::VehicleEffectsComponent *v2; // r12
  __int64 v3; // r14
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl **v4; // r15
  UFG::CharacterAnimationComponent *v5; // rdi
  unsigned int v6; // edx
  UFG::qBaseTreeRB *v7; // rbp
  unsigned int v8; // ebx
  UFG::qBaseTreeRB *v9; // rax
  UFG::qBaseTreeRB *v10; // rsi
  unsigned int v11; // edx
  UFG::qBaseTreeRB *v12; // rax
  UFG::qBaseTreeRB *v13; // r13
  UFG::allocator::free_link *v14; // rax
  __int64 v15; // rax
  __int64 v16; // r15
  UFG::qBaseTreeRB *v17; // rbx
  UFG::allocator::free_link *v18; // rax
  UFG::qBaseNodeRB *v19; // rax
  UFG::qBaseNodeRB *v20; // rax
  UFG::VehicleEffect *i; // rbx
  unsigned int v22; // edx
  UFG::qBaseTreeRB *v23; // rax
  UFG::allocator::free_link *v24; // rax
  UFG::qBaseNodeRB *v25; // rax
  UFG::qBaseNodeRB *v26; // rax
  signed __int64 v27; // rsi
  UFG::SimObjectCVBase *v28; // rcx
  unsigned __int16 v29; // dx
  UFG::CharacterAnimationComponent *v30; // rax
  Creature *v31; // rdi
  UFG::qBaseTreeRB *j; // rbx
  unsigned int v33; // edx
  signed int v34; // eax
  unsigned int v35; // edx
  signed int v36; // eax
  unsigned int v37; // edx
  signed int v38; // eax
  DamageRig *v39; // rcx
  char *v40; // rax
  unsigned int v41; // edx
  UFG::qSymbol symbol; // [rsp+80h] [rbp+8h]
  __int64 v43; // [rsp+90h] [rbp+18h]
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl **v44; // [rsp+98h] [rbp+20h]

  v2 = this;
  if ( *((_BYTE *)this + 1884) >= 0 )
  {
    this->mEffectStatusTable[id].mState = 1;
    return;
  }
  v3 = id;
  v43 = id;
  v4 = &(&this->vfptr)[(signed int)id + 2i64 * (signed int)id + 23];
  v44 = v4;
  v5 = 0i64;
  if ( *(_DWORD *)v4 == 1 )
    *(_DWORD *)v4 = 0;
  if ( !*(_DWORD *)v4 )
  {
    v6 = this->mEffectGroup.mUID;
    if ( v6 != -1 )
    {
      v7 = 0i64;
      v8 = gEffectMapping[v3].mUID;
      if ( !v6 )
        goto LABEL_71;
      v9 = UFG::qBaseTreeRB::Get(&UFG::VehicleEffectManager::m_Instance->mVehicleEffectTemplates.mTree, v6);
      v10 = v9;
      if ( !v9 )
        goto LABEL_71;
      v11 = HIDWORD(v9->mNULL.mParent);
      if ( v11 )
      {
        v12 = UFG::qBaseTreeRB::Get(&UFG::VehicleEffectManager::m_Instance->mVehicleEffectTemplates.mTree, v11);
        if ( v12 )
        {
          if ( !v8 )
            goto LABEL_13;
          v7 = UFG::qBaseTreeRB::Get((UFG::qBaseTreeRB *)((char *)v12 + 40), v8);
        }
      }
      if ( v8 )
      {
        v13 = UFG::qBaseTreeRB::Get((UFG::qBaseTreeRB *)((char *)v10 + 40), v8);
        goto LABEL_15;
      }
LABEL_13:
      v13 = 0i64;
LABEL_15:
      if ( v7 || v13 )
      {
        v14 = UFG::qMalloc(0x78ui64, "VehicleEffectState", 0i64);
        if ( v14 )
        {
          symbol.mUID = v8;
          UFG::VehicleEffectState::VehicleEffectState((UFG::VehicleEffectState *)v14, (__int64)&symbol);
          v16 = v15;
        }
        else
        {
          v16 = 0i64;
        }
        if ( v7 )
        {
          v17 = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)v7->mNULL.mChild);
          if ( v17 )
          {
            do
            {
              v18 = UFG::qMalloc(0x78ui64, "VehicleEffect", 0i64);
              if ( v18 )
                UFG::VehicleEffect::VehicleEffect((UFG::VehicleEffect *)v18, (UFG::VehicleEffect *)v17);
              else
                v19 = 0i64;
              UFG::qBaseTreeRB::Add((UFG::qBaseTreeRB *)(v16 + 40), v19);
              v17 = UFG::qBaseTreeRB::GetNext((UFG::qBaseTreeRB *)((char *)v7 + 40), &v17->mRoot);
            }
            while ( v17 );
            v3 = v43;
          }
          v20 = v7[1].mNULL.mChild[0];
          if ( v20 )
            *(_QWORD *)(v16 + 112) = v20;
        }
        if ( v13 )
        {
          for ( i = (UFG::VehicleEffect *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)v13->mNULL.mChild);
                i;
                i = (UFG::VehicleEffect *)UFG::qBaseTreeRB::GetNext((UFG::qBaseTreeRB *)((char *)v13 + 40), &i->mNode) )
          {
            v22 = i->mName.mUID;
            if ( v22 && (v23 = UFG::qBaseTreeRB::Get((UFG::qBaseTreeRB *)(v16 + 40), v22)) != 0i64 )
            {
              UFG::VehicleEffect::operator=((UFG::VehicleEffect *)v23, i);
            }
            else
            {
              v24 = UFG::qMalloc(0x78ui64, "VehicleEffect", 0i64);
              v43 = (__int64)v24;
              if ( v24 )
                UFG::VehicleEffect::VehicleEffect((UFG::VehicleEffect *)v24, i);
              else
                v25 = 0i64;
              UFG::qBaseTreeRB::Add((UFG::qBaseTreeRB *)(v16 + 40), v25);
            }
          }
          v26 = v13[1].mNULL.mChild[0];
          if ( v26 )
            *(_QWORD *)(v16 + 112) = v26;
        }
        v27 = (signed __int64)v2 + 24 * (v3 + 8);
        *(_QWORD *)v27 = v16;
        v28 = (UFG::SimObjectCVBase *)v2->m_pSimObject;
        if ( v28 )
        {
          v29 = v28->m_Flags;
          if ( (v29 >> 14) & 1 )
          {
            v30 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v28);
          }
          else if ( (v29 & 0x8000u) == 0 )
          {
            if ( (v29 >> 13) & 1 )
            {
              v30 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v28);
            }
            else if ( (v29 >> 12) & 1 )
            {
              v30 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                          (UFG::SimObjectGame *)&v28->vfptr,
                                                          UFG::CharacterAnimationComponent::_TypeUID);
            }
            else
            {
              v30 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                          (UFG::SimObject *)&v28->vfptr,
                                                          UFG::CharacterAnimationComponent::_TypeUID);
            }
          }
          else
          {
            v30 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v28);
          }
          v5 = v30;
        }
        v31 = v5->mCreature;
        for ( j = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)(*(_QWORD *)v27 + 40i64));
              j;
              j = UFG::qBaseTreeRB::GetNext((UFG::qBaseTreeRB *)(*(_QWORD *)v27 + 40i64), &j->mRoot) )
        {
          v33 = HIDWORD(j->mNULL.mChild[0]);
          if ( v33 != -1 && v31->mPose.mRigHandle.mData )
            v34 = Skeleton::GetBoneID(v31->mPose.mRigHandle.mUFGSkeleton, v33);
          else
            v34 = -1;
          LODWORD(j->mNULL.mChild[0]) = v34;
          v35 = HIDWORD(j[1].mRoot.mChild[1]);
          if ( v35 != -1 && v31->mPose.mRigHandle.mData )
            v36 = Skeleton::GetBoneID(v31->mPose.mRigHandle.mUFGSkeleton, v35);
          else
            v36 = -1;
          LODWORD(j[1].mRoot.mChild[1]) = v36;
          v37 = HIDWORD(j[1].mRoot.mChild[0]);
          if ( v37 != -1 && v31->mPose.mRigHandle.mData )
            v38 = Skeleton::GetBoneID(v31->mPose.mRigHandle.mUFGSkeleton, v37);
          else
            v38 = -1;
          LODWORD(j[1].mRoot.mChild[0]) = v38;
          v39 = v2->mDamageRig;
          if ( !v39 )
          {
            v40 = UFG::qSymbol::as_cstr_dbg((UFG::qSymbolUC *)&v2->m_pSimObject->m_Name);
            UFG::qPrintf("vehicle %s missing mDamageRig. resources unloaded?\n", v40);
            v39 = v2->mDamageRig;
            if ( !v39 )
              continue;
          }
          v41 = HIDWORD(j[1].mRoot.mChild[0]);
          if ( v41 != -1 )
            DamageRig::GetDamageMarkerIndex(v39, v41, (unsigned int *)j[1].mNULL.mChild);
        }
        *(_DWORD *)v44 = 4;
        return;
      }
LABEL_71:
      *(_DWORD *)v4 = 2;
      return;
    }
  }
}

// File Line: 587
// RVA: 0x68E350
void __fastcall UFG::VehicleEffectsComponent::TurnOnEffect_New(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id)
{
  signed __int64 v2; // rsi
  UFG::VehicleEffectsComponent *v3; // rdi
  signed __int64 v4; // rbx
  UFG::EffectStatus::State v5; // eax
  signed __int64 v6; // rsi
  UFG::VehicleEffect *i; // rbx
  int v8; // er8
  unsigned int v9; // edx
  Render::FXSimComponent *v10; // rcx
  UFG::SimObject *v11; // rax
  UFG::SimComponent *v12; // rcx
  UFG::VehiclePhantom *v13; // rsi
  UFG::SimComponent *v14; // rax
  SkeletalPose *v15; // rbx
  UFG::PhysicsVehicle *v16; // rdi
  int v17; // eax
  UFG::qMatrix44 matrixMS; // [rsp+30h] [rbp-48h]

  v2 = id;
  v3 = this;
  v4 = id;
  if ( this->mEffectStatusTable[id].mState == UNINITIALIZED )
    UFG::VehicleEffectsComponent::InitializeEffect_New(this, id);
  v5 = v3->mEffectStatusTable[v4].mState;
  if ( v5 == 4 )
  {
    v6 = v2;
    v3->mEffectStatusTable[v4].mState = 3;
    for ( i = (UFG::VehicleEffect *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&v3->mEffectStatusTable[v6].mInternalState->mEffects);
          i;
          i = (UFG::VehicleEffect *)UFG::qBaseTreeRB::GetNext(
                                      &v3->mEffectStatusTable[v6].mInternalState->mEffects.mTree,
                                      &i->mNode) )
    {
      UFG::VehicleEffectsComponent::UpdateEffectSpeed(v3, i);
      v8 = i->mMarker;
      v9 = i->mBoundEffect[i->mSpeed];
      v10 = (Render::FXSimComponent *)v3->mFXComponent.m_pSimComponent;
      if ( v10 && v8 != -1 && i->mEffectRef == -1 && v9 )
        i->mEffectRef = Render::FXSimComponent::AttachEffect(v10, v9, v8, 0i64);
    }
    v11 = v3->m_pSimObject;
    if ( v11 )
    {
      if ( !((LOBYTE(v11->m_Flags) >> 1) & 1) )
      {
        v12 = v3->mDrawableComponent.m_pSimComponent;
        v13 = v3->mEffectStatusTable[v6].mInternalState->mPhantom;
        if ( v12 )
        {
          v14 = v3->mMoverComponent.m_pSimComponent;
          if ( v14 )
          {
            if ( v13 )
            {
              v15 = (SkeletalPose *)v12[21].vfptr;
              if ( v15 )
              {
                v16 = (UFG::PhysicsVehicle *)v14[10].m_SafePointerList.mNode.mPrev;
                if ( v16 )
                {
                  v17 = Skeleton::GetBoneID(v15->mRigHandle.mUFGSkeleton, v13->mMarkerUID);
                  SkeletalPose::GetPositionMS(v15, v17, &matrixMS);
                  UFG::PhysicsVehicle::ActivateVolume(v16, 0x914EB7E3, &v13->mHalfExtents, &matrixMS, 2.0);
                }
              }
            }
          }
        }
      }
    }
  }
  else if ( v5 == 1 )
  {
    *((_DWORD *)&v3->mEffectStatusTable[v4] + 4) |= 1u;
  }
}

// File Line: 657
// RVA: 0x68D840
void __fastcall UFG::VehicleEffectsComponent::TurnOffEffect_New(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id)
{
  UFG::VehicleEffectsComponent *v2; // r14
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl **v3; // rsi
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl **v4; // r15
  UFG::qBaseTreeRB *i; // rbx
  Render::FXSimComponent *v6; // rcx
  unsigned int v7; // edx
  UFG::qBaseNodeRB *v8; // rax
  UFG::qBaseNodeRB *v9; // rdi

  v2 = this;
  v3 = &(&this->vfptr)[3 * id];
  if ( *((_DWORD *)v3 + 46) == 3 )
  {
    *((_DWORD *)v3 + 46) = 4;
    v4 = &(&this->vfptr)[3 * ((signed int)id + 8i64)];
    for ( i = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&(&this->vfptr)[3 * ((signed int)id + 8i64)][5]);
          i;
          i = UFG::qBaseTreeRB::GetNext((UFG::qBaseTreeRB *)&(*v4)[5], &i->mRoot) )
    {
      v6 = (Render::FXSimComponent *)v2->mFXComponent.m_pSimComponent;
      if ( v6 )
      {
        v7 = i[1].mRoot.mUID;
        if ( v7 != -1 )
        {
          Render::FXSimComponent::DetachEffect(v6, v7, 0);
          i[1].mRoot.mUID = -1;
        }
      }
      i[1].mRoot.mUID = -1;
      v8 = i[1].mNULL.mParent;
      if ( v8 )
      {
        --LODWORD(v8->mParent);
        v9 = i[1].mNULL.mParent;
        if ( SLODWORD(v9->mParent) <= 0 )
        {
          if ( v9 )
          {
            Render::FXOverride::~FXOverride((Render::FXOverride *)i[1].mNULL.mParent);
            operator delete[](v9);
          }
          i[1].mNULL.mParent = 0i64;
        }
        i[1].mNULL.mParent = 0i64;
      }
    }
  }
  *((_DWORD *)v3 + 50) &= 0xFFFFFFFE;
  if ( *((_DWORD *)v3 + 46) == 1 )
    *((_DWORD *)v3 + 46) = 0;
}

// File Line: 704
// RVA: 0x68E280
void __fastcall UFG::VehicleEffectsComponent::TurnOnDisabledEffect(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rdi
  UFG::SimObjectGame *v2; // rcx
  unsigned __int16 v3; // dx
  UFG::SimComponent *v4; // rax
  UFG::WaterFloatingTrackerComponent *v5; // rbx

  v1 = this;
  v2 = (UFG::SimObjectGame *)this->m_pSimObject;
  if ( !v2 )
    goto LABEL_15;
  v3 = v2->m_Flags;
  if ( (v3 >> 14) & 1 )
  {
    v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
LABEL_11:
    v5 = (UFG::WaterFloatingTrackerComponent *)v4;
    goto LABEL_12;
  }
  if ( (v3 & 0x8000u) == 0 )
  {
    if ( (v3 >> 13) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else if ( (v3 >> 12) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else
    {
      v4 = UFG::SimObject::GetComponentOfType(
             (UFG::SimObject *)&v2->vfptr,
             UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    goto LABEL_11;
  }
  v5 = (UFG::WaterFloatingTrackerComponent *)v2->m_Components.p[35].m_pComponent;
LABEL_12:
  if ( !v5
    || !UFG::WaterFloatingTrackerComponent::IsInWater(v5)
    || !UFG::WaterFloatingTrackerComponent::IsSubmerged(v5, 0.64999998) )
  {
LABEL_15:
    UFG::VehicleEffectsComponent::TurnOffEffect_New(v1, FX_DISABLED);
  }
}

// File Line: 722
// RVA: 0x68D950
void __fastcall UFG::VehicleEffectsComponent::TurnOffEffects(UFG::VehicleEffectsComponent *this, bool headlights)
{
  bool v2; // bp
  UFG::VehicleEffectsComponent *v3; // rsi
  UFG::VehicleEffectId v4; // ebx
  _BYTE *v5; // rdi
  unsigned int v6; // edi
  unsigned int *v7; // rbx
  unsigned int v8; // edx
  unsigned int v9; // edx
  unsigned int v10; // edx
  unsigned int v11; // edx
  unsigned int v12; // edx

  v2 = headlights;
  v3 = this;
  v4 = 0;
  v5 = (char *)this->mEffectStatusTable + 16;
  do
  {
    if ( *((_DWORD *)v5 - 4) == 3 || *v5 & 1 )
    {
      if ( (unsigned int)(v4 - 2) > 3 && v4 )
      {
        if ( (unsigned int)(v4 - 6) <= 1 )
        {
          if ( v2 == 1 )
            UFG::VehicleEffectsComponent::TurnOffEffect_New(v3, v4);
        }
        else
        {
          UFG::VehicleEffectsComponent::TurnOffEffect_New(v3, v4);
        }
      }
      else if ( v2 == 1 )
      {
        UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, v4);
      }
    }
    ++v4;
    v5 += 24;
  }
  while ( (unsigned int)v4 < 0x27 );
  v6 = 0;
  if ( v3->mNumWheels > 0 )
  {
    v7 = v3->mSkidEmitters.array;
    do
    {
      if ( *((_BYTE *)v3 + 1884) < 0 )
      {
        v8 = v7[44];
        if ( v8 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, v8, 0);
          v7[44] = -1;
        }
        if ( *v7 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, *v7, 0);
          *v7 = 0;
        }
      }
      v9 = v7[48];
      if ( v9 != -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v9, 0);
        v7[48] = -1;
      }
      v10 = v7[52];
      if ( v10 != -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v10, 0);
        v7[52] = -1;
      }
      v11 = v7[56];
      if ( v11 != -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v11, 0);
        v7[56] = -1;
      }
      ++v6;
      ++v7;
    }
    while ( v6 < v3->mNumWheels );
  }
  Render::FXManager::KillEffect(&Render::gFXManager, v3->mSprayEffects[0].mDropletEffectRef, 0);
  v12 = v3->mSprayEffects[1].mDropletEffectRef;
  v3->mSprayEffects[0].mDropletEffectRef = -1;
  Render::FXManager::KillEffect(&Render::gFXManager, v12, 0);
  v3->mSprayEffects[1].mDropletEffectRef = -1;
}

// File Line: 787
// RVA: 0x66D450
void __fastcall UFG::VehicleEffectsComponent::~VehicleEffectsComponent(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v2; // r14
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v3; // rcx
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v4; // rax
  UFG::TransformNodeComponent *v5; // rcx
  UFG::TransformNodeComponent *v6; // rcx
  UFG::qSafeArray<UFG::TransformNodeComponent *,16> *v7; // rdi
  signed __int64 v8; // rsi
  DamageRig *v9; // rdi
  unsigned int *v10; // rcx
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v11; // rcx
  UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *v12; // rax

  v1 = this;
  this->vfptr = (UFG::qSafePointerNode<UFG::SimComponent>Vtbl *)&UFG::VehicleEffectsComponent::`vftable;
  if ( this == UFG::VehicleEffectsComponent::s_VehicleEffectsComponentpCurrentIterator )
    UFG::VehicleEffectsComponent::s_VehicleEffectsComponentpCurrentIterator = (UFG::VehicleEffectsComponent *)&this->mPrev[-4];
  v2 = (UFG::qNode<UFG::VehicleEffectsComponent,UFG::VehicleEffectsComponent> *)&this->mPrev;
  v3 = this->mPrev;
  v4 = v2->mNext;
  v3->mNext = v4;
  v4->mPrev = v3;
  v2->mPrev = v2;
  v2->mNext = v2;
  UFG::VehicleEffectsComponent::TurnOffEffects(v1, 1);
  UFG::VehicleEffectsComponent::TurnOffFire(v1);
  v5 = v1->mSprayEffects[0].mTransform;
  if ( v5 )
  {
    v5->vfptr->__vecDelDtor((UFG::qSafePointerNode<UFG::SimComponent> *)&v5->vfptr, 1u);
    v1->mSprayEffects[0].mTransform = 0i64;
  }
  v6 = v1->mSprayEffects[1].mTransform;
  if ( v6 )
  {
    v6->vfptr->__vecDelDtor((UFG::qSafePointerNode<UFG::SimComponent> *)&v6->vfptr, 1u);
    v1->mSprayEffects[1].mTransform = 0i64;
  }
  v7 = &v1->mTransformNodes;
  v8 = 16i64;
  do
  {
    if ( v7->array[0] )
      v7->array[0]->vfptr->__vecDelDtor((UFG::qSafePointerNode<UFG::SimComponent> *)&v7->array[0]->vfptr, 1u);
    v7 = (UFG::qSafeArray<UFG::TransformNodeComponent *,16> *)((char *)v7 + 8);
    --v8;
  }
  while ( v8 );
  v9 = v1->mDamageRig;
  if ( v9 )
  {
    DamageRig::~DamageRig(v1->mDamageRig);
    operator delete[](v9);
  }
  v10 = v1->mWheelBoneId.p;
  if ( v10 )
    operator delete[](v10);
  v1->mWheelBoneId.p = 0i64;
  *(_QWORD *)&v1->mWheelBoneId.size = 0i64;
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mVehicleDriverComponent);
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mRoadSpaceComponent);
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mMoverComponent);
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mFXComponent);
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mDrawableComponent);
  UFG::RebindingComponentHandle<UFG::RagdollComponent,0>::~RebindingComponentHandle<UFG::RagdollComponent,0>((UFG::RebindingComponentHandle<UFG::TransformNodeComponent,0> *)&v1->mWaterFloatingTrackerComponent);
  `eh vector destructor iterator(
    v1->mEffectStatusTable,
    0x18ui64,
    39,
    (void (__fastcall *)(void *))UFG::EffectStatus::~EffectStatus);
  v11 = v2->mPrev;
  v12 = v2->mNext;
  v11->mNext = v12;
  v12->mPrev = v11;
  v2->mPrev = v2;
  v2->mNext = v2;
  UFG::SimComponent::~SimComponent((UFG::SimComponent *)&v1->vfptr);
}

// File Line: 823
// RVA: 0x6838A0
void __fastcall UFG::VehicleEffectsComponent::OnAttach(UFG::VehicleEffectsComponent *this, UFG::SimObject *object)
{
  UFG::VehicleEffectsComponent *v2; // rbx
  UFG::SimObjectVehicle *v3; // rdi
  UFG::RebindingComponentHandle<Render::FXSimComponent,0> *v4; // rbx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v5; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v6; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v7; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v8; // rdx

  v2 = this;
  v3 = (UFG::SimObjectVehicle *)object;
  UFG::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0>::Bind<UFG::SimObjectVehicle>(
    &this->mWaterFloatingTrackerComponent,
    (UFG::SimObjectVehicle *)object);
  UFG::RebindingComponentHandle<UFG::CompositeDrawableComponent,0>::Bind<UFG::SimObjectVehicle>(
    &v2->mDrawableComponent,
    v3);
  UFG::RebindingComponentHandle<UFG::PhysicsMoverInterface,0>::Bind<UFG::SimObjectVehicle>(&v2->mMoverComponent, v3);
  UFG::RebindingComponentHandle<UFG::RoadSpaceComponent,0>::Bind<UFG::SimObjectVehicle>(&v2->mRoadSpaceComponent, v3);
  UFG::RebindingComponentHandle<UFG::VehicleDriverInterface,0>::Bind<UFG::SimObjectVehicle>(
    &v2->mVehicleDriverComponent,
    v3);
  v4 = &v2->mFXComponent;
  if ( v4->m_pSimComponent )
  {
    v5 = v4->mNext;
    v6 = v4->mPrev;
    v6->mNext = v5;
    v5->mPrev = v6;
    v4->m_pSimComponent = 0i64;
LABEL_7:
    v4->m_pSimObject = 0i64;
    v4->mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v4->mPrev;
    v4->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v4->mPrev;
    goto LABEL_8;
  }
  if ( v4->m_pSimObject
    && ((UFG::RebindingComponentHandle<Render::FXSimComponent,0> *)v4->mPrev != v4
     || (UFG::RebindingComponentHandle<Render::FXSimComponent,0> *)v4->mNext != v4) )
  {
    v7 = v4->mNext;
    v8 = v4->mPrev;
    v8->mNext = v7;
    v7->mPrev = v8;
    goto LABEL_7;
  }
LABEL_8:
  v4->m_Changed = 1;
  v4->m_pSimObject = (UFG::SimObject *)&v3->vfptr;
  v4->m_TypeUID = Render::FXSimComponent::_TypeUID;
  UFG::RebindingComponentHandle<Render::FXSimComponent,0>::BindInternal<UFG::SimObjectVehicle>(v4, v3);
}

// File Line: 838
// RVA: 0x674850
void __fastcall UFG::VehicleEffectsComponent::CreateDamageRig(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rdi
  UFG::qResourceData *v2; // rax
  UFG::qResourceData *v3; // rbx
  UFG::allocator::free_link *v4; // rax
  DamageRig *v5; // rax
  DamageRig *v6; // rcx
  unsigned int v7; // edx
  UFG::qBaseTreeRB *v8; // rbp
  unsigned int v9; // eax
  int v10; // er12
  unsigned __int64 v11; // rax
  unsigned __int64 v12; // kr00_8
  unsigned int i; // er14
  signed __int64 v14; // rsi
  __m128 v15; // xmm1
  DamageRig::DamageMarker *v16; // rcx
  unsigned int v17; // edx
  float v18; // xmm0_4
  UFG::qBaseTreeRB *v19; // rax
  unsigned int v20; // eax
  unsigned int v21; // esi
  unsigned __int64 v22; // rax
  unsigned __int64 v23; // kr10_8
  unsigned int j; // er13
  signed __int64 v25; // r14
  __m128 v26; // xmm1
  DamageRig::TriggeredMarker *v27; // rcx
  unsigned __int64 v28; // rax
  __int64 v29; // r8
  float v30; // xmm0_4
  UFG::qBaseTreeRB *v31; // rax
  UFG::qBaseNodeRB *v32; // rax
  UFG::SimObjectGame *v33; // rcx
  unsigned __int16 v34; // dx
  UFG::VehicleLookComponent *v35; // rax
  unsigned int uid; // [rsp+80h] [rbp+8h]
  ModelType *v37; // [rsp+88h] [rbp+10h]

  v1 = this;
  v37 = (ModelType *)this->mDrawableComponent.m_pSimComponent[22].m_SafePointerList.mNode.mNext;
  v2 = UFG::qResourceInventory::Get((UFG::qResourceInventory *)&UFG::gRigInventory.vfptr, this->mRigUID);
  v3 = v2;
  if ( LODWORD(v2[2].mResourceHandles.mNode.mPrev) || v2[2].mTypeUID )
  {
    v4 = UFG::qMalloc(0x530ui64, "DamageRig", 0i64);
    if ( v4 )
    {
      DamageRig::DamageRig((DamageRig *)v4);
      v6 = v5;
    }
    else
    {
      v6 = 0i64;
    }
    v1->mDamageRig = v6;
    v6->mGrimeFactor = v1->mInitialGrimeFactor;
    v1->mDamageRig->mNumDamageMarkers = (unsigned int)v3[2].mResourceHandles.mNode.mPrev;
    v1->mDamageRig->mNumTriggeredMarkers = v3[2].mTypeUID;
    v7 = v1->mDamageTransferUID;
    if ( v7 )
      v8 = UFG::qBaseTreeRB::Get(&UFG::VehicleEffectManager::m_Instance->mDamageTransferNodes.mTree, v7);
    else
      v8 = 0i64;
    v9 = (unsigned int)v3[2].mResourceHandles.mNode.mPrev;
    v10 = LODWORD(v3[1].mNode.mChild[0][1].mChild[1]) - v9 - v3[2].mTypeUID;
    if ( v9 )
    {
      v12 = v9;
      v11 = 36i64 * v9;
      if ( !is_mul_ok(v12, 0x24ui64) )
        v11 = -1i64;
      v1->mDamageRig->mDamageMarkers = (DamageRig::DamageMarker *)UFG::qMalloc(v11, "DamageMarker", 0i64);
      for ( i = 0; i < LODWORD(v3[2].mResourceHandles.mNode.mPrev); ++i )
      {
        v14 = i;
        v1->mDamageRig->mDamageMarkers[v14].mValue = 0.0;
        v1->mDamageRig->mDamageMarkers[v14].mSignal = 0.0;
        v1->mDamageRig->mDamageMarkers[v14].mTransferredDamage = 0.0;
        v1->mDamageRig->mDamageMarkers[v14].mBoneIndex = *((_DWORD *)&v3[2].mResourceHandles.mNode.mNext->mPrev + i);
        v15 = *(__m128 *)(*(_QWORD *)&v3[1].mNode.mChild[0][1].mUID
                        + 48i64 * *((signed int *)&v3[2].mResourceHandles.mNode.mNext->mPrev + i));
        v16 = v1->mDamageRig->mDamageMarkers;
        LODWORD(v16[v14].mPosition.x) = v15.m128_i32[0];
        LODWORD(v16[v14].mPosition.y) = (unsigned __int128)_mm_shuffle_ps(v15, v15, 85);
        LODWORD(v16[v14].mPosition.z) = (unsigned __int128)_mm_shuffle_ps(v15, v15, 170);
        v17 = *(_DWORD *)(*(_QWORD *)&v3[1].mNode.mUID
                        + 4i64 * *((unsigned int *)&v3[2].mResourceHandles.mNode.mNext->mPrev + i));
        v1->mDamageRig->mDamageMarkers[v14].mNameUID = v17;
        v18 = *(float *)&FLOAT_1_0;
        if ( v8 )
        {
          if ( v17 && (v19 = UFG::qBaseTreeRB::Get((UFG::qBaseTreeRB *)((char *)v8 + 32), v17)) != 0i64 )
            v18 = *(float *)&v19->mNULL.mChild[1];
          else
            v18 = *(float *)&v8[1].mNULL.mParent;
        }
        v1->mDamageRig->mDamageMarkers[i].mDamageScalar = v18;
      }
    }
    v20 = v3[2].mTypeUID;
    if ( v20 )
    {
      v21 = 0;
      v23 = v20;
      v22 = 48i64 * v20;
      if ( !is_mul_ok(v23, 0x30ui64) )
        v22 = -1i64;
      v1->mDamageRig->mTriggeredMarkers = (DamageRig::TriggeredMarker *)UFG::qMalloc(v22, "TriggeredMarker", 0i64);
      for ( j = 0; j < v3[2].mTypeUID; ++j )
      {
        v25 = j;
        v1->mDamageRig->mTriggeredMarkers[v25].mValue = 0.0;
        v1->mDamageRig->mTriggeredMarkers[v25].mSignal = 0.0;
        v1->mDamageRig->mTriggeredMarkers[v25].mBoneIndex = *(_DWORD *)(*(_QWORD *)&v3[2].mDebugName[4] + 4i64 * j);
        v26 = *(__m128 *)(*(_QWORD *)&v3[1].mNode.mChild[0][1].mUID
                        + 48i64 * *(signed int *)(*(_QWORD *)&v3[2].mDebugName[4] + 4i64 * j));
        v27 = v1->mDamageRig->mTriggeredMarkers;
        LODWORD(v27[v25].mPosition.x) = v26.m128_i32[0];
        LODWORD(v27[v25].mPosition.y) = (unsigned __int128)_mm_shuffle_ps(v26, v26, 85);
        LODWORD(v27[v25].mPosition.z) = (unsigned __int128)_mm_shuffle_ps(v26, v26, 170);
        uid = *(_DWORD *)(*(_QWORD *)&v3[1].mNode.mUID
                        + 4i64 * *(unsigned int *)(*(_QWORD *)&v3[2].mDebugName[4] + 4i64 * j));
        v1->mDamageRig->mTriggeredMarkers[v25].mNameUID = uid;
        v1->mDamageRig->mTriggeredMarkers[v25].mNumTriggers = *(_DWORD *)(*(_QWORD *)&v3[2].mDebugName[28] + 4i64 * j);
        v28 = 4i64 * v1->mDamageRig->mTriggeredMarkers[j].mNumTriggers;
        if ( !is_mul_ok(v1->mDamageRig->mTriggeredMarkers[j].mNumTriggers, 4ui64) )
          v28 = -1i64;
        v1->mDamageRig->mTriggeredMarkers[j].mTriggerIndices = (unsigned int *)UFG::qMalloc(v28, "TriggerIndices", 0i64);
        v29 = 0i64;
        if ( *(_DWORD *)(*(_QWORD *)&v3[2].mDebugName[28] + 4i64 * j) )
        {
          do
          {
            v1->mDamageRig->mTriggeredMarkers[j].mTriggerIndices[v29] = *(_DWORD *)(*(_QWORD *)&v3[2].mDebugName[20]
                                                                                  + 4i64 * v21++)
                                                                      - v10;
            v29 = (unsigned int)(v29 + 1);
          }
          while ( (unsigned int)v29 < *(_DWORD *)(*(_QWORD *)&v3[2].mDebugName[28] + 4i64 * j) );
        }
        v30 = *(float *)&FLOAT_1_0;
        if ( v8 )
        {
          if ( uid && (v31 = UFG::qBaseTreeRB::Get((UFG::qBaseTreeRB *)((char *)v8 + 32), uid)) != 0i64 )
            v30 = *(float *)&v31->mNULL.mChild[1];
          else
            v30 = *(float *)&v8[1].mNULL.mParent;
        }
        v1->mDamageRig->mTriggeredMarkers[j].mDamageScalar = v30;
      }
    }
    v32 = ModelType::GetSkeleton(v37);
    DamageRig::SetDetachableBones(v1->mDamageRig, (Skeleton *)v32);
    v33 = (UFG::SimObjectGame *)v1->m_pSimObject;
    if ( v33 )
    {
      v34 = v33->m_Flags;
      if ( (v34 >> 14) & 1 )
      {
        v35 = (UFG::VehicleLookComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                             v33,
                                             UFG::VehicleLookComponent::_TypeUID);
      }
      else if ( (v34 & 0x8000u) == 0 )
      {
        if ( (v34 >> 13) & 1 )
        {
          v35 = (UFG::VehicleLookComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                               v33,
                                               UFG::VehicleLookComponent::_TypeUID);
        }
        else if ( (v34 >> 12) & 1 )
        {
          v35 = (UFG::VehicleLookComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                               v33,
                                               UFG::VehicleLookComponent::_TypeUID);
        }
        else
        {
          v35 = (UFG::VehicleLookComponent *)UFG::SimObject::GetComponentOfType(
                                               (UFG::SimObject *)&v33->vfptr,
                                               UFG::VehicleLookComponent::_TypeUID);
        }
      }
      else
      {
        v35 = (UFG::VehicleLookComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                             v33,
                                             UFG::VehicleLookComponent::_TypeUID);
      }
      if ( v35 )
        v35->mVehicleEffectsComponent = v1;
    }
    v1->mVandalizedDamage = 0;
  }
}

// File Line: 954
// RVA: 0x67B960
char __fastcall UFG::VehicleEffectsComponent::GetWheelIndexFromBoneID(UFG::VehicleEffectsComponent *this, unsigned int boneId, unsigned int *wheelIndex)
{
  UFG::VehicleEffectsComponent *v3; // rdi
  UFG::SimObjectCVBase *v4; // rcx
  unsigned int v5; // ebx
  unsigned int *v6; // r14
  unsigned int v7; // esi
  UFG::CharacterAnimationComponent *v8; // rax
  unsigned __int16 v9; // dx
  Creature *v10; // rcx
  int v11; // eax
  unsigned int v12; // edx
  unsigned int *v13; // rcx

  v3 = this;
  v4 = (UFG::SimObjectCVBase *)this->m_pSimObject;
  v5 = 0;
  v6 = wheelIndex;
  v7 = boneId;
  if ( v4 )
  {
    v9 = v4->m_Flags;
    if ( (v9 >> 14) & 1 )
    {
      v8 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v4);
    }
    else if ( (v9 & 0x8000u) == 0 )
    {
      if ( (v9 >> 13) & 1 )
      {
        v8 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v4);
      }
      else if ( (v9 >> 12) & 1 )
      {
        v8 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                   (UFG::SimObjectGame *)&v4->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
      else
      {
        v8 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                   (UFG::SimObject *)&v4->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
    }
    else
    {
      v8 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v4);
    }
  }
  else
  {
    v8 = 0i64;
  }
  v10 = v8->mCreature;
  if ( !v10 )
    return 0;
  if ( !v10->mPose.mRigHandle.mData )
    return 0;
  v11 = Skeleton::GetBoneID(v10->mPose.mRigHandle.mUFGSkeleton, v7);
  if ( v11 == -1 )
    return 0;
  v12 = v3->mNumWheels;
  if ( !v12 )
    return 0;
  v13 = v3->mWheelBoneId.p;
  while ( *v13 != v11 )
  {
    ++v5;
    ++v13;
    if ( v5 >= v12 )
      return 0;
  }
  *v6 = v5;
  return 1;
}

// File Line: 981
// RVA: 0x673430
void __fastcall UFG::VehicleEffectsComponent::BindEffectMarkers(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx
  UFG::SimObjectCVBase *v2; // rcx
  UFG::CharacterAnimationComponent *v3; // rax
  unsigned __int16 v4; // dx
  Creature *v5; // rdi
  unsigned int v6; // er15
  __int64 v7; // r14
  unsigned int v8; // ebp
  unsigned int *v9; // rax
  unsigned int v10; // er15
  __int64 v11; // r14
  unsigned int v12; // ebp
  unsigned int *v13; // rax
  unsigned int v14; // er15
  __int64 v15; // r14
  unsigned int v16; // ebp
  unsigned int *v17; // rax
  unsigned int v18; // er15
  __int64 v19; // r14
  unsigned int v20; // ebp
  unsigned int *v21; // rax
  unsigned int v22; // er15
  __int64 v23; // r14
  unsigned int v24; // ebp
  unsigned int *v25; // rax
  unsigned int v26; // er15
  __int64 v27; // r14
  unsigned int v28; // ebp
  unsigned int *v29; // rax
  unsigned int v30; // eax
  unsigned int v31; // eax
  unsigned int v32; // eax
  unsigned int v33; // ecx
  UFG::qSafeArray<unsigned long,4> *v34; // rax

  v1 = this;
  if ( this->mDamageRig && this->mDrawableComponent.m_pSimComponent )
  {
    v2 = (UFG::SimObjectCVBase *)this->m_pSimObject;
    if ( v2 )
    {
      v4 = v2->m_Flags;
      if ( (v4 >> 14) & 1 )
      {
        v3 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v2);
      }
      else if ( (v4 & 0x8000u) == 0 )
      {
        if ( (v4 >> 13) & 1 )
          v3 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v2);
        else
          v3 = (UFG::CharacterAnimationComponent *)((v4 >> 12) & 1 ? UFG::SimObjectGame::GetComponentOfTypeHK(
                                                                       (UFG::SimObjectGame *)&v2->vfptr,
                                                                       UFG::CharacterAnimationComponent::_TypeUID) : UFG::SimObject::GetComponentOfType((UFG::SimObject *)&v2->vfptr, UFG::CharacterAnimationComponent::_TypeUID));
      }
      else
      {
        v3 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v2);
      }
    }
    else
    {
      v3 = 0i64;
    }
    v5 = v3->mCreature;
    if ( v5 )
    {
      if ( !v3->mTemporaryRig && v3->mRigHandle.mData )
      {
        *((_DWORD *)v1 + 471) |= 0x80u;
        if ( v5->mPose.mRigHandle.mData )
        {
          v6 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_WheelL01.mUID);
          if ( v6 != -1 )
          {
            v7 = v1->mWheelBoneId.size;
            v8 = v7 + 1;
            if ( (unsigned int)(v7 + 1) > v1->mWheelBoneId.capacity )
              UFG::qArray<long,0>::Reallocate(
                (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                4 * ((v8 >> 2) + ((((_BYTE)v7 + 1) & 3) != 0)),
                "qArray.Add");
            v9 = v1->mWheelBoneId.p;
            v1->mWheelBoneId.size = v8;
            v9[v7] = v6;
          }
          if ( v5->mPose.mRigHandle.mData )
          {
            v10 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_WheelR01.mUID);
            if ( v10 != -1 )
            {
              v11 = v1->mWheelBoneId.size;
              v12 = v11 + 1;
              if ( (unsigned int)(v11 + 1) > v1->mWheelBoneId.capacity )
                UFG::qArray<long,0>::Reallocate(
                  (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                  4 * ((v12 >> 2) + ((((_BYTE)v11 + 1) & 3) != 0)),
                  "qArray.Add");
              v13 = v1->mWheelBoneId.p;
              v1->mWheelBoneId.size = v12;
              v13[v11] = v10;
            }
            if ( v5->mPose.mRigHandle.mData )
            {
              v14 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_WheelL02.mUID);
              if ( v14 != -1 )
              {
                v15 = v1->mWheelBoneId.size;
                v16 = v15 + 1;
                if ( (unsigned int)(v15 + 1) > v1->mWheelBoneId.capacity )
                  UFG::qArray<long,0>::Reallocate(
                    (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                    4 * ((v16 >> 2) + ((((_BYTE)v15 + 1) & 3) != 0)),
                    "qArray.Add");
                v17 = v1->mWheelBoneId.p;
                v1->mWheelBoneId.size = v16;
                v17[v15] = v14;
              }
              if ( v5->mPose.mRigHandle.mData )
              {
                v18 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_WheelR02.mUID);
                if ( v18 != -1 )
                {
                  v19 = v1->mWheelBoneId.size;
                  v20 = v19 + 1;
                  if ( (unsigned int)(v19 + 1) > v1->mWheelBoneId.capacity )
                    UFG::qArray<long,0>::Reallocate(
                      (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                      4 * ((v20 >> 2) + ((((_BYTE)v19 + 1) & 3) != 0)),
                      "qArray.Add");
                  v21 = v1->mWheelBoneId.p;
                  v1->mWheelBoneId.size = v20;
                  v21[v19] = v18;
                }
                if ( v5->mPose.mRigHandle.mData )
                {
                  v22 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_Wheel01.mUID);
                  if ( v22 != -1 )
                  {
                    v23 = v1->mWheelBoneId.size;
                    v24 = v23 + 1;
                    if ( (unsigned int)(v23 + 1) > v1->mWheelBoneId.capacity )
                      UFG::qArray<long,0>::Reallocate(
                        (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                        4 * ((v24 >> 2) + ((((_BYTE)v23 + 1) & 3) != 0)),
                        "qArray.Add");
                    v25 = v1->mWheelBoneId.p;
                    v1->mWheelBoneId.size = v24;
                    v25[v23] = v22;
                  }
                  if ( v5->mPose.mRigHandle.mData )
                  {
                    v26 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_M_Wheel02.mUID);
                    if ( v26 != -1 )
                    {
                      v27 = v1->mWheelBoneId.size;
                      v28 = v27 + 1;
                      if ( (unsigned int)(v27 + 1) > v1->mWheelBoneId.capacity )
                        UFG::qArray<long,0>::Reallocate(
                          (UFG::qArray<unsigned long,0> *)&v1->mWheelBoneId,
                          4 * ((v28 >> 2) + ((((_BYTE)v27 + 1) & 3) != 0)),
                          "qArray.Add");
                      v29 = v1->mWheelBoneId.p;
                      v1->mWheelBoneId.size = v28;
                      v29[v27] = v26;
                    }
                  }
                }
              }
            }
          }
        }
        if ( v5->mPose.mRigHandle.mData )
        {
          v30 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_E_CTC_Spark01.mUID);
          if ( v30 != -1 )
            v1->mBumperBoneId.array[3] = v30;
          if ( v5->mPose.mRigHandle.mData )
          {
            v31 = Skeleton::GetBoneID(v5->mPose.mRigHandle.mUFGSkeleton, gSym_E_CTC_Spark02.mUID);
            if ( v31 != -1 )
              v1->mBumperBoneId.array[2] = v31;
          }
        }
        v32 = v1->mWheelBoneId.size;
        v33 = 0;
        v1->mNumWheels = v32;
        if ( v32 )
        {
          v34 = &v1->mSkidEmitters;
          do
          {
            v34->array[0] = 0;
            ++v33;
            v34 = (UFG::qSafeArray<unsigned long,4> *)((char *)v34 + 4);
          }
          while ( v33 < v1->mNumWheels );
        }
      }
    }
  }
}

// File Line: 1026
// RVA: 0x684470
void __fastcall UFG::VehicleEffectsComponent::OnDetach(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx
  DamageRig *v2; // rdi
  UFG::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0> *v3; // rdx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v4; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v5; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v6; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v7; // rax
  UFG::RebindingComponentHandle<UFG::PhysicsMoverInterface,0> *v8; // rdx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v9; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v10; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v11; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v12; // rax
  UFG::RebindingComponentHandle<UFG::CompositeDrawableComponent,0> *v13; // rdx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v14; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v15; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v16; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v17; // rax
  UFG::RebindingComponentHandle<UFG::RoadSpaceComponent,0> *v18; // rdx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v19; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v20; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v21; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v22; // rax
  UFG::RebindingComponentHandle<UFG::VehicleDriverInterface,0> *v23; // rdx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v24; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v25; // rax
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v26; // rcx
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v27; // rax

  v1 = this;
  UFG::VehicleEffectsComponent::TurnOffEffects(this, 1);
  UFG::VehicleEffectsComponent::TurnOffFire(v1);
  v2 = v1->mDamageRig;
  if ( v2 )
  {
    DamageRig::~DamageRig(v2);
    operator delete[](v2);
    v1->mDamageRig = 0i64;
  }
  v3 = &v1->mWaterFloatingTrackerComponent;
  if ( v1->mWaterFloatingTrackerComponent.m_pSimComponent )
  {
    v4 = v3->mPrev;
    v5 = v1->mWaterFloatingTrackerComponent.mNext;
    v4->mNext = v5;
    v5->mPrev = v4;
    v1->mWaterFloatingTrackerComponent.m_pSimComponent = 0i64;
LABEL_9:
    v1->mWaterFloatingTrackerComponent.m_pSimObject = 0i64;
    v1->mWaterFloatingTrackerComponent.mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v1->mWaterFloatingTrackerComponent.mPrev;
    v3->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v3->mPrev;
    goto LABEL_10;
  }
  if ( v1->mWaterFloatingTrackerComponent.m_pSimObject
    && ((UFG::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0> *)v3->mPrev != v3
     || (UFG::RebindingComponentHandle<UFG::WaterFloatingTrackerComponent,0> *)v1->mWaterFloatingTrackerComponent.mNext != &v1->mWaterFloatingTrackerComponent) )
  {
    v6 = v3->mPrev;
    v7 = v1->mWaterFloatingTrackerComponent.mNext;
    v6->mNext = v7;
    v7->mPrev = v6;
    goto LABEL_9;
  }
LABEL_10:
  v1->mWaterFloatingTrackerComponent.m_Changed = 1;
  v8 = &v1->mMoverComponent;
  if ( v1->mMoverComponent.m_pSimComponent )
  {
    v9 = v8->mPrev;
    v10 = v1->mMoverComponent.mNext;
    v9->mNext = v10;
    v10->mPrev = v9;
    v1->mMoverComponent.m_pSimComponent = 0i64;
LABEL_16:
    v1->mMoverComponent.m_pSimObject = 0i64;
    v1->mMoverComponent.mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v1->mMoverComponent.mPrev;
    v8->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v8->mPrev;
    goto LABEL_17;
  }
  if ( v1->mMoverComponent.m_pSimObject
    && ((UFG::RebindingComponentHandle<UFG::PhysicsMoverInterface,0> *)v8->mPrev != v8
     || (UFG::RebindingComponentHandle<UFG::PhysicsMoverInterface,0> *)v1->mMoverComponent.mNext != &v1->mMoverComponent) )
  {
    v11 = v8->mPrev;
    v12 = v1->mMoverComponent.mNext;
    v11->mNext = v12;
    v12->mPrev = v11;
    goto LABEL_16;
  }
LABEL_17:
  v1->mMoverComponent.m_Changed = 1;
  v13 = &v1->mDrawableComponent;
  if ( v1->mDrawableComponent.m_pSimComponent )
  {
    v14 = v13->mPrev;
    v15 = v1->mDrawableComponent.mNext;
    v14->mNext = v15;
    v15->mPrev = v14;
    v1->mDrawableComponent.m_pSimComponent = 0i64;
LABEL_23:
    v1->mDrawableComponent.m_pSimObject = 0i64;
    v1->mDrawableComponent.mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v1->mDrawableComponent.mPrev;
    v13->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v13->mPrev;
    goto LABEL_24;
  }
  if ( v1->mDrawableComponent.m_pSimObject
    && ((UFG::RebindingComponentHandle<UFG::CompositeDrawableComponent,0> *)v13->mPrev != v13
     || (UFG::RebindingComponentHandle<UFG::CompositeDrawableComponent,0> *)v1->mDrawableComponent.mNext != &v1->mDrawableComponent) )
  {
    v16 = v13->mPrev;
    v17 = v1->mDrawableComponent.mNext;
    v16->mNext = v17;
    v17->mPrev = v16;
    goto LABEL_23;
  }
LABEL_24:
  v1->mDrawableComponent.m_Changed = 1;
  v18 = &v1->mRoadSpaceComponent;
  if ( v1->mRoadSpaceComponent.m_pSimComponent )
  {
    v19 = v18->mPrev;
    v20 = v1->mRoadSpaceComponent.mNext;
    v19->mNext = v20;
    v20->mPrev = v19;
    v1->mRoadSpaceComponent.m_pSimComponent = 0i64;
LABEL_30:
    v1->mRoadSpaceComponent.m_pSimObject = 0i64;
    v1->mRoadSpaceComponent.mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v1->mRoadSpaceComponent.mPrev;
    v18->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v18->mPrev;
    goto LABEL_31;
  }
  if ( v1->mRoadSpaceComponent.m_pSimObject
    && ((UFG::RebindingComponentHandle<UFG::RoadSpaceComponent,0> *)v18->mPrev != v18
     || (UFG::RebindingComponentHandle<UFG::RoadSpaceComponent,0> *)v1->mRoadSpaceComponent.mNext != &v1->mRoadSpaceComponent) )
  {
    v21 = v18->mPrev;
    v22 = v1->mRoadSpaceComponent.mNext;
    v21->mNext = v22;
    v22->mPrev = v21;
    goto LABEL_30;
  }
LABEL_31:
  v1->mRoadSpaceComponent.m_Changed = 1;
  v23 = &v1->mVehicleDriverComponent;
  if ( v1->mVehicleDriverComponent.m_pSimComponent )
  {
    v24 = v23->mPrev;
    v25 = v1->mVehicleDriverComponent.mNext;
    v24->mNext = v25;
    v25->mPrev = v24;
    v1->mVehicleDriverComponent.m_pSimComponent = 0i64;
LABEL_37:
    v1->mVehicleDriverComponent.m_pSimObject = 0i64;
    v1->mVehicleDriverComponent.mNext = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v1->mVehicleDriverComponent.mPrev;
    v23->mPrev = (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)&v23->mPrev;
    goto LABEL_38;
  }
  if ( v1->mVehicleDriverComponent.m_pSimObject
    && ((UFG::RebindingComponentHandle<UFG::VehicleDriverInterface,0> *)v23->mPrev != v23
     || (UFG::RebindingComponentHandle<UFG::VehicleDriverInterface,0> *)v1->mVehicleDriverComponent.mNext != &v1->mVehicleDriverComponent) )
  {
    v26 = v23->mPrev;
    v27 = v1->mVehicleDriverComponent.mNext;
    v26->mNext = v27;
    v27->mPrev = v26;
    goto LABEL_37;
  }
LABEL_38:
  v1->mVehicleDriverComponent.m_Changed = 1;
}>mPrev = v26;
    goto LABEL_37;
  }
LABEL_38:
  v1->mVehicleDriverComponent.m_Changed = 1;
}

// File Line: 1044
// RVA: 0x698A80
void __fastcall UFG::VehicleEffectsComponent::UpdateSkidTransform(UFG::VehicleEffectsComponent *this, unsigned int wheelIndex, UFG::qMatrix44 *wheelTransform, UFG::qMatrix44 *rootXform, float wheelRad)
{
  UFG::TransformNodeComponent *v5; // rcx
  float v6; // xmm0_4
  float v7; // xmm1_4
  float v8; // xmm3_4
  float v9; // xmm4_4
  float v10; // xmm5_4
  float v11; // xmm2_4
  float v12; // xmm0_4
  float v13; // xmm1_4
  float v14; // xmm1_4
  float v15; // xmm1_4
  float v16; // xmm0_4
  UFG::qMatrix44 m; // [rsp+20h] [rbp-48h]

  v5 = this->mTransformNodes.array[wheelIndex + 4];
  if ( v5 )
  {
    v6 = rootXform->v0.x;
    v7 = rootXform->v0.y;
    v8 = rootXform->v2.x;
    m.v0.w = 0.0;
    m.v1.w = 0.0;
    m.v2.w = 0.0;
    v9 = rootXform->v2.y;
    v10 = rootXform->v2.z;
    v11 = wheelTransform->v3.z;
    m.v0.x = v6;
    v12 = rootXform->v0.z;
    m.v0.y = v7;
    v13 = rootXform->v1.x;
    m.v0.z = v12;
    m.v1.y = rootXform->v1.y;
    m.v1.x = v13;
    v14 = rootXform->v1.z;
    m.v2.x = v8;
    m.v2.y = v9;
    m.v1.z = v14;
    v15 = wheelTransform->v3.y;
    m.v2.z = v10;
    v16 = wheelTransform->v3.x - (float)(v8 * wheelRad);
    m.v3.y = v15 - (float)(v9 * wheelRad);
    m.v3.z = v11 - (float)(v10 * wheelRad);
    m.v3.x = v16;
    LODWORD(m.v3.w) = (_DWORD)FLOAT_1_0;
    UFG::TransformNodeComponent::SetLocalTransform(v5, &m);
  }
}

// File Line: 1063
// RVA: 0x695200
void __fastcall UFG::VehicleEffectsComponent::UpdateBumperTransform(UFG::VehicleEffectsComponent *this, unsigned int wheelIndex, Creature *creature)
{
  Creature *v3; // r9
  int v4; // er8
  UFG::TransformNodeComponent **v5; // rbx
  UFG::qVector3 result; // [rsp+20h] [rbp-18h]

  v3 = creature;
  v4 = this->mBumperBoneId.array[wheelIndex];
  if ( v4 != -1 )
  {
    v5 = (UFG::TransformNodeComponent **)&(&this->vfptr)[wheelIndex + 12];
    if ( v5[178] )
    {
      Creature::GetTranslation(v3, &result, v4);
      UFG::TransformNodeComponent::SetLocalTranslation(v5[178], &result);
    }
  }
}

// File Line: 1077
// RVA: 0x695B40
void __fastcall UFG::VehicleEffectsComponent::UpdateDirectionalTransform(UFG::VehicleEffectsComponent *this, unsigned int wheelIndex, UFG::qMatrix44 *wheelTransform, UFG::qMatrix44 *rootXform, float wheelRad)
{
  UFG::TransformNodeComponent *v5; // rcx
  float v6; // xmm7_4
  float v7; // xmm8_4
  float v8; // xmm9_4
  float v9; // xmm2_4
  float v10; // xmm5_4
  float v11; // xmm4_4
  float v12; // xmm0_4
  float v13; // xmm3_4
  float v14; // xmm2_4
  float v15; // xmm1_4
  float v16; // xmm0_4
  float v17; // xmm1_4
  UFG::qMatrix44 m; // [rsp+20h] [rbp-88h]

  v5 = this->mTransformNodes.array[wheelIndex + 8];
  if ( v5 )
  {
    v6 = wheelTransform->v1.x;
    v7 = wheelTransform->v1.y;
    v8 = wheelTransform->v1.z;
    if ( (float)((float)((float)(wheelTransform->v1.y * rootXform->v1.y) + (float)(v6 * rootXform->v1.x))
               + (float)(wheelTransform->v1.z * rootXform->v1.z)) < 0.0 )
    {
      v6 = v6 * -1.0;
      v7 = v7 * -1.0;
      v8 = v8 * -1.0;
    }
    v9 = rootXform->v2.x;
    v10 = rootXform->v2.z;
    v11 = rootXform->v2.y;
    m.v2.w = 0.0;
    m.v0.w = 0.0;
    m.v1.w = 0.0;
    m.v2.x = v9;
    m.v2.y = v11;
    m.v2.z = v10;
    m.v1.x = v6;
    m.v1.y = v7;
    m.v1.z = v8;
    m.v0.x = (float)(v10 * v7) - (float)(v11 * v8);
    v12 = v9;
    m.v0.y = (float)(v9 * v8) - (float)(v10 * v6);
    v13 = v9;
    v14 = wheelTransform->v3.z;
    v15 = (float)(v11 * v6) - (float)(v12 * v7);
    v16 = wheelTransform->v3.x;
    m.v0.z = v15;
    v17 = wheelTransform->v3.y - (float)(v11 * wheelRad);
    m.v3.x = v16 - (float)(v13 * wheelRad);
    m.v3.y = v17;
    LODWORD(m.v3.w) = (_DWORD)FLOAT_1_0;
    m.v3.z = v14 - (float)(v10 * wheelRad);
    UFG::TransformNodeComponent::SetLocalTransform(v5, &m);
  }
}

// File Line: 1107
// RVA: 0x681FF0
UFG::TransformNodeComponent *__fastcall UFG::VehicleEffectsComponent::ObtainTransform(UFG::VehicleEffectsComponent *this, unsigned int transformIndex)
{
  __int64 v2; // rsi
  UFG::VehicleEffectsComponent *v3; // rdi
  __int64 v4; // r14
  UFG::qMemoryPool *v5; // rax
  UFG::allocator::free_link *v6; // rax
  UFG::TransformNodeComponent *v7; // rax
  UFG::TransformNodeComponent *v8; // rbx
  UFG::CharacterAnimationComponent *v9; // rbx
  UFG::TransformNodeComponent *v10; // rax
  __int64 v11; // r15
  UFG::SimObject *v12; // rsi
  UFG::TransformNodeComponent *v13; // rsi
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v14; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v15; // rax
  float v16; // xmm6_4
  UFG::SimObjectCVBase *v17; // rcx
  unsigned __int16 v18; // dx
  UFG::CharacterAnimationComponent *v19; // rax
  Creature *v20; // rcx
  UFG::CharacterAnimationComponent *v21; // rbx
  UFG::TransformNodeComponent *v22; // rax
  __int64 v23; // r15
  UFG::SimObject *v24; // rsi
  UFG::TransformNodeComponent *v25; // rsi
  float v26; // xmm6_4
  UFG::SimObjectCVBase *v27; // rcx
  unsigned __int16 v28; // dx
  UFG::CharacterAnimationComponent *v29; // rax
  Creature *v30; // rcx
  UFG::TransformNodeComponent *v31; // rax
  UFG::TransformNodeComponent *v32; // rbx
  unsigned int v33; // esi
  UFG::SimObjectCVBase *v34; // rcx
  unsigned __int16 v35; // dx
  UFG::CharacterAnimationComponent *v36; // rax
  Creature *v37; // r8
  UFG::qMatrix44 rootXform; // [rsp+18h] [rbp-59h]
  __int64 v40; // [rsp+58h] [rbp-19h]
  UFG::qMatrix44 transform; // [rsp+68h] [rbp-9h]
  UFG::allocator::free_link *v42; // [rsp+D8h] [rbp+67h]

  v40 = -2i64;
  v2 = (signed int)transformIndex;
  v3 = this;
  v4 = (signed int)transformIndex;
  if ( !this->mTransformNodes.array[transformIndex] )
  {
    v5 = UFG::GetSimulationMemoryPool();
    v6 = UFG::qMemoryPool::Allocate(v5, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
    v42 = v6;
    if ( (unsigned int)v2 > 3 )
    {
      if ( (unsigned int)v2 > 7 )
      {
        if ( (unsigned int)v2 > 0xB )
        {
          if ( v6 )
          {
            UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v6, 0, 0i64, 0);
            v32 = v31;
          }
          else
          {
            v32 = 0i64;
          }
          v3->mTransformNodes.array[v2] = v32;
          v33 = v2 - 12;
          v34 = (UFG::SimObjectCVBase *)v3->m_pSimObject;
          if ( v34 )
          {
            v35 = v34->m_Flags;
            if ( (v35 >> 14) & 1 )
            {
              v36 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v34);
            }
            else if ( (v35 & 0x8000u) == 0 )
            {
              if ( (v35 >> 13) & 1 )
                v36 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v34);
              else
                v36 = (UFG::CharacterAnimationComponent *)((v35 >> 12) & 1 ? UFG::SimObjectGame::GetComponentOfTypeHK(
                                                                               (UFG::SimObjectGame *)&v34->vfptr,
                                                                               UFG::CharacterAnimationComponent::_TypeUID) : UFG::SimObject::GetComponentOfType((UFG::SimObject *)&v34->vfptr, UFG::CharacterAnimationComponent::_TypeUID));
            }
            else
            {
              v36 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v34);
            }
            if ( v36 )
            {
              v37 = v36->mCreature;
              if ( v37 )
                UFG::VehicleEffectsComponent::UpdateBumperTransform(v3, v33, v37);
            }
          }
        }
        else
        {
          v21 = 0i64;
          if ( v6 )
            UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v6, 0, 0i64, 0);
          else
            v22 = 0i64;
          v3->mTransformNodes.array[v2] = v22;
          v23 = (unsigned int)(v2 - 8);
          v24 = v3->m_pSimObject;
          if ( v24 )
            v25 = v24->m_pTransformNodeComponent;
          else
            v25 = 0i64;
          UFG::TransformNodeComponent::UpdateWorldTransform(v25);
          rootXform.v0.x = v25->mWorldTransform.v0.x;
          rootXform.v0.y = v25->mWorldTransform.v0.y;
          rootXform.v0.z = v25->mWorldTransform.v0.z;
          rootXform.v0.w = v25->mWorldTransform.v0.w;
          rootXform.v1.x = v25->mWorldTransform.v1.x;
          rootXform.v1.y = v25->mWorldTransform.v1.y;
          rootXform.v1.z = v25->mWorldTransform.v1.z;
          rootXform.v1.w = v25->mWorldTransform.v1.w;
          rootXform.v2.x = v25->mWorldTransform.v2.x;
          rootXform.v2.y = v25->mWorldTransform.v2.y;
          rootXform.v2.z = v25->mWorldTransform.v2.z;
          rootXform.v2.w = v25->mWorldTransform.v2.w;
          rootXform.v3.x = v25->mWorldTransform.v3.x;
          rootXform.v3.y = v25->mWorldTransform.v3.y;
          rootXform.v3.z = v25->mWorldTransform.v3.z;
          rootXform.v3.w = v25->mWorldTransform.v3.w;
          v26 = UFG::PhysicsMoverInterface::GetWheelRadius((UFG::PhysicsMoverInterface *)v3->mMoverComponent.m_pSimComponent);
          v27 = (UFG::SimObjectCVBase *)v3->m_pSimObject;
          if ( v27 )
          {
            v28 = v27->m_Flags;
            if ( (v28 >> 14) & 1 )
            {
              v29 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v27);
            }
            else if ( (v28 & 0x8000u) == 0 )
            {
              if ( (v28 >> 13) & 1 )
              {
                v29 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v27);
              }
              else if ( (v28 >> 12) & 1 )
              {
                v29 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                            (UFG::SimObjectGame *)&v27->vfptr,
                                                            UFG::CharacterAnimationComponent::_TypeUID);
              }
              else
              {
                v29 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                            (UFG::SimObject *)&v27->vfptr,
                                                            UFG::CharacterAnimationComponent::_TypeUID);
              }
            }
            else
            {
              v29 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v27);
            }
            v21 = v29;
          }
          v30 = v21->mCreature;
          if ( v30 )
          {
            Creature::GetTransform(v30, v3->mWheelBoneId.p[v23], &transform);
            UFG::VehicleEffectsComponent::UpdateDirectionalTransform(v3, v23, &transform, &rootXform, v26);
          }
        }
      }
      else
      {
        v9 = 0i64;
        if ( v6 )
          UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v6, 0, 0i64, 0);
        else
          v10 = 0i64;
        v3->mTransformNodes.array[v2] = v10;
        v11 = (unsigned int)(v2 - 4);
        v12 = v3->m_pSimObject;
        if ( v12 )
          v13 = v12->m_pTransformNodeComponent;
        else
          v13 = 0i64;
        UFG::TransformNodeComponent::UpdateWorldTransform(v13);
        rootXform.v0.x = v13->mWorldTransform.v0.x;
        rootXform.v0.y = v13->mWorldTransform.v0.y;
        rootXform.v0.z = v13->mWorldTransform.v0.z;
        rootXform.v0.w = v13->mWorldTransform.v0.w;
        rootXform.v1.x = v13->mWorldTransform.v1.x;
        rootXform.v1.y = v13->mWorldTransform.v1.y;
        rootXform.v1.z = v13->mWorldTransform.v1.z;
        rootXform.v1.w = v13->mWorldTransform.v1.w;
        rootXform.v2.x = v13->mWorldTransform.v2.x;
        rootXform.v2.y = v13->mWorldTransform.v2.y;
        rootXform.v2.z = v13->mWorldTransform.v2.z;
        rootXform.v2.w = v13->mWorldTransform.v2.w;
        rootXform.v3.x = v13->mWorldTransform.v3.x;
        rootXform.v3.y = v13->mWorldTransform.v3.y;
        rootXform.v3.z = v13->mWorldTransform.v3.z;
        rootXform.v3.w = v13->mWorldTransform.v3.w;
        v14 = v3->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
        if ( !v14 )
          goto LABEL_72;
        v15 = 0i64;
        if ( BYTE4(v14[37].mNext) & 7 )
          v15 = v3->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
        if ( v15 )
          v16 = *((float *)&v15[62].mPrev + 1);
        else
LABEL_72:
          v16 = FLOAT_0_27000001;
        v17 = (UFG::SimObjectCVBase *)v3->m_pSimObject;
        if ( v17 )
        {
          v18 = v17->m_Flags;
          if ( (v18 >> 14) & 1 )
          {
            v19 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v17);
          }
          else if ( (v18 & 0x8000u) == 0 )
          {
            if ( (v18 >> 13) & 1 )
            {
              v19 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v17);
            }
            else if ( (v18 >> 12) & 1 )
            {
              v19 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                          (UFG::SimObjectGame *)&v17->vfptr,
                                                          UFG::CharacterAnimationComponent::_TypeUID);
            }
            else
            {
              v19 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                          (UFG::SimObject *)&v17->vfptr,
                                                          UFG::CharacterAnimationComponent::_TypeUID);
            }
          }
          else
          {
            v19 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v17);
          }
          v9 = v19;
        }
        v20 = v9->mCreature;
        if ( v20 )
        {
          Creature::GetTransform(v20, v3->mWheelBoneId.p[v11], &transform);
          UFG::VehicleEffectsComponent::UpdateSkidTransform(v3, v11, &transform, &rootXform, v16);
        }
      }
    }
    else
    {
      if ( v6 )
      {
        UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v6, 0, 0i64, 0);
        v8 = v7;
      }
      else
      {
        v8 = 0i64;
      }
      v3->mTransformNodes.array[v2] = v8;
    }
  }
  return v3->mTransformNodes.array[v4];
}

// File Line: 1208
// RVA: 0x696B30
void __fastcall UFG::VehicleEffectsComponent::UpdateEffectStateMachine(UFG::VehicleEffectsComponent *this, bool didSpeedLevelChange)
{
  bool v2; // r12
  UFG::VehicleEffectsComponent *v3; // rsi
  UFG::VehicleEffectState **v4; // r14
  signed int v5; // ebx
  unsigned int v6; // ebp
  __int64 v7; // r15
  int v8; // eax
  UFG::qBaseTreeRB *i; // rbx
  unsigned int v10; // edx
  DamageRig *v11; // rcx
  Render::FXSimComponent *v12; // rcx
  unsigned int v13; // edx
  UFG::qBaseNodeRB *v14; // rax
  UFG::qBaseNodeRB *v15; // rdi
  UFG::VehicleEffect *j; // rbx
  float health_output; // [rsp+60h] [rbp+8h]

  v2 = didSpeedLevelChange;
  v3 = this;
  if ( *((_BYTE *)this + 1884) < 0 )
  {
    v4 = &this->mEffectStatusTable[0].mInternalState;
    v5 = 57469;
    v6 = 0;
    v7 = 0i64;
    do
    {
      v8 = *((_DWORD *)v4 - 2);
      if ( v8 == 1 )
      {
        UFG::VehicleEffectsComponent::InitializeEffect_New(v3, (UFG::VehicleEffectId)v6);
        if ( (_BYTE)v4[1] & 1 )
        {
          if ( v6 <= 0xF && _bittest(&v5, v6) )
            UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, (UFG::VehicleEffectId)v6);
          else
            UFG::VehicleEffectsComponent::TurnOnEffect_New(v3, (UFG::VehicleEffectId)v6);
        }
        goto LABEL_34;
      }
      if ( v8 == 3 )
      {
        if ( v6 <= 0xF && _bittest(&v5, v6) )
        {
          for ( i = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&(*v4)->mEffects);
                i;
                i = UFG::qBaseTreeRB::GetNext(&(*v4)->mEffects.mTree, &i->mRoot) )
          {
            v10 = HIDWORD(i[1].mRoot.mChild[0]);
            v11 = v3->mDamageRig;
            health_output = 0.0;
            DamageRig::GetTriggerMarkerHealth(v11, v10, &health_output);
            if ( health_output > 0.33000001 )
            {
              v12 = (Render::FXSimComponent *)v3->mFXComponent.m_pSimComponent;
              if ( v12 )
              {
                v13 = i[1].mRoot.mUID;
                if ( v13 != -1 )
                {
                  Render::FXSimComponent::DetachEffect(v12, v13, 0);
                  i[1].mRoot.mUID = -1;
                }
              }
              i[1].mRoot.mUID = -1;
              v14 = i[1].mNULL.mParent;
              if ( v14 )
              {
                --LODWORD(v14->mParent);
                v15 = i[1].mNULL.mParent;
                if ( SLODWORD(v15->mParent) <= 0 )
                {
                  if ( v15 )
                  {
                    Render::FXOverride::~FXOverride((Render::FXOverride *)i[1].mNULL.mParent);
                    operator delete[](v15);
                  }
                  i[1].mNULL.mParent = 0i64;
                }
                i[1].mNULL.mParent = 0i64;
              }
              if ( !(v7 & 0xFFFFFFFFFFFFFFFAui64) && v7 != 1 )
                DamageRig::RemoveSignal(v3->mDamageRig, HIDWORD(i[1].mRoot.mChild[0]), 2.0);
            }
          }
        }
        else
        {
          if ( !v2 || !((v6 - 33) & 0xFFFFFFFA) && v6 != 37 )
            goto LABEL_34;
          for ( j = (UFG::VehicleEffect *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&(*v4)->mEffects);
                j;
                j = (UFG::VehicleEffect *)UFG::qBaseTreeRB::GetNext(&(*v4)->mEffects.mTree, &j->mNode) )
          {
            UFG::VehicleEffectsComponent::UpdateEffectSpeed(v3, j);
            UFG::VehicleEffectsComponent::StartEffect(v3, &j->mEffectRef, j->mBoundEffect[j->mSpeed], j->mMarker, 0i64);
          }
        }
        v5 = 57469;
      }
LABEL_34:
      ++v6;
      ++v7;
      v4 += 3;
    }
    while ( v6 < 0x27 );
  }
}

// File Line: 1276
// RVA: 0x69B080
void __fastcall UFG::VehicleEffectsComponent::UpdateTransforms(UFG::VehicleEffectsComponent *this, float deltaTime)
{
  UFG::VehicleEffectsComponent *v2; // rdi
  float v3; // xmm6_4
  UFG::WaterFloatingTrackerComponent *v4; // rbx
  UFG::SimObjectVehicle *v5; // r14
  bool v6; // bp
  int v7; // esi
  float v8; // xmm0_4
  char v9; // al
  bool v10; // r12
  bool v11; // cf
  UFG::SimComponent *v12; // rax
  bool v13; // r15
  bool v14; // r8
  float v15; // xmm1_4
  signed int v16; // edx
  float *v17; // rax
  signed __int64 v18; // rcx
  float v19; // xmm1_4
  int v20; // ebx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v21; // rcx
  UFG::WaterFloatingTrackerComponent *v22; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v23; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v24; // rax
  UFG::SimObject *v25; // rbx
  UFG::TransformNodeComponent *v26; // rbx
  float v27; // xmm7_4
  float v28; // xmm8_4
  float v29; // xmm9_4
  UFG::TransformNodeComponent *v30; // rbx
  signed __int64 v31; // rbx
  UFG::BaseCameraComponent *v32; // rax
  signed __int64 v33; // rax
  __m128 v34; // xmm2
  UFG::VehicleEffectsComponent::Lod v35; // eax
  float v36; // xmm0_4
  UFG::VehicleEffectsComponent::Lod v37; // ecx

  v2 = this;
  v3 = deltaTime;
  if ( (LOBYTE(this->m_Flags) >> 1) & 1 )
    return;
  v4 = (UFG::WaterFloatingTrackerComponent *)this->mWaterFloatingTrackerComponent.m_pSimComponent;
  v5 = (UFG::SimObjectVehicle *)this->m_pSimObject;
  if ( v4
    && UFG::WaterFloatingTrackerComponent::IsInWater(v4)
    && UFG::WaterFloatingTrackerComponent::IsSubmerged(v4, 0.25) )
  {
    UFG::VehicleEffectsComponent::TurnOffFire(v2);
    if ( UFG::WaterFloatingTrackerComponent::IsSubmerged(v4, 0.89999998) )
      UFG::VehicleEffectsComponent::TurnOffEffects(v2, 0);
    return;
  }
  v6 = 0;
  v7 = 0;
  v8 = UFG::TimeOfDayManager::GetInstance()->m_SecondsSinceMidnight;
  if ( v8 < 21600.0 || (v9 = 1, v8 > 64800.0) )
    v9 = 0;
  v10 = v9 == 0;
  v11 = 1.0 < UFG::TimeOfDayManager::GetInstance()->m_WeatherState;
  v12 = v2->mMoverComponent.m_pSimComponent;
  v13 = v11;
  v14 = 0;
  if ( v12 )
  {
    v15 = *((float *)&v12[10].m_BoundComponentHandles.mNode.mPrev + 1);
    v16 = 3;
    v17 = &v2->mSpeedLevelThreshold[3];
    v18 = 3i64;
    v19 = v15 * 3.5999999;
    v6 = COERCE_FLOAT(LODWORD(v19) & _xmm) > 5.0;
    while ( v19 <= *v17 )
    {
      --v16;
      --v17;
      if ( --v18 < 0 )
        goto LABEL_17;
    }
    if ( v2->mSpeedLevel != v16 )
    {
      v2->mSpeedLevel = v16;
      v14 = 1;
    }
  }
LABEL_17:
  UFG::VehicleEffectsComponent::UpdateEffectStateMachine(v2, v14);
  v20 = UFG::VehicleUtility::GetVehicleOrientation(v5, 0, 0i64);
  if ( v6 != 1
    || (v21 = v2->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev) == 0i64
    || HIDWORD(v21[34].mPrev) != 3
    || (v22 = (UFG::WaterFloatingTrackerComponent *)v21[2].mNext) != 0i64
    && UFG::WaterFloatingTrackerComponent::IsInWater(v22)
    || v20 )
  {
    v2->mIsOffGround = 0;
  }
  else
  {
    v23 = v2->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
    if ( v23 )
    {
      v24 = 0i64;
      if ( BYTE4(v23[37].mNext) & 7 )
        v24 = v2->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
      if ( v24 && (LODWORD(v24[68].mNext) >> 3) & 1 )
      {
        ++v2->mFramesOffGround;
        if ( !v2->mIsOffGround && v2->mFramesOffGround > 3 )
        {
          v2->mIsOffGround = 1;
          UFG::VehicleEffectsComponent::TurnOnEffect_New(v2, FX_WHEELEDVEHICLEJUMP);
          UFG::VehicleEffectsComponent::TurnOffEffect_New(v2, FX_WHEELEDVEHICLEIMPACT);
        }
        goto LABEL_36;
      }
    }
    if ( v2->mIsOffGround == 1 )
    {
      v2->mIsOffGround = 0;
      UFG::VehicleEffectsComponent::TurnOffEffect_New(v2, FX_WHEELEDVEHICLEJUMP);
      if ( v2->mFramesOffGround > 0x19 )
        UFG::VehicleEffectsComponent::TurnOnEffect_New(v2, FX_WHEELEDVEHICLEIMPACT);
    }
  }
  v2->mFramesOffGround = 0;
LABEL_36:
  v25 = v2->m_pSimObject;
  if ( v25 )
    v26 = v25->m_pTransformNodeComponent;
  else
    v26 = 0i64;
  UFG::TransformNodeComponent::UpdateWorldTransform(v26);
  v27 = v26->mWorldTransform.v3.x;
  v28 = v26->mWorldTransform.v3.y;
  v29 = v26->mWorldTransform.v3.z;
  if ( LocalPlayer )
  {
    v30 = LocalPlayer->m_pTransformNodeComponent;
    UFG::TransformNodeComponent::UpdateWorldTransform(LocalPlayer->m_pTransformNodeComponent);
    v31 = (signed __int64)&v30->mWorldTransform.v3;
  }
  else
  {
    v32 = UFG::Director::Get()->mCurrentCamera;
    if ( v32 )
      v33 = (signed __int64)&v32->mCamera;
    else
      v33 = 0i64;
    v31 = v33 + 176;
  }
  v34 = (__m128)*(unsigned int *)(v31 + 4);
  v35 = v2->mLevelOfDetail;
  v34.m128_f32[0] = (float)((float)((float)(v34.m128_f32[0] - v28) * (float)(v34.m128_f32[0] - v28))
                          + (float)((float)(*(float *)v31 - v27) * (float)(*(float *)v31 - v27)))
                  + (float)((float)(*(float *)(v31 + 8) - v29) * (float)(*(float *)(v31 + 8) - v29));
  LODWORD(v36) = (unsigned __int128)_mm_sqrt_ps(v34);
  if ( v36 <= 50.0 )
  {
    LOBYTE(v7) = v36 <= 30.0;
    v2->mLevelOfDetail = v7 + 2;
  }
  else
  {
    v2->mLevelOfDetail = 1;
  }
  v37 = v2->mLevelOfDetail;
  if ( v37 != v35 && v37 == 1 )
    UFG::VehicleEffectsComponent::TurnOffEffects(v2, 0);
  UFG::VehicleEffectsComponent::ManageHeadlights(v2, v3, v13);
  switch ( v2->mLevelOfDetail )
  {
    case 1:
      UFG::VehicleEffectsComponent::UpdateLowDetailEffects(v2, v3, v6);
      break;
    case 2:
      UFG::VehicleEffectsComponent::ManageDamageEffects(v2, v3);
      UFG::VehicleEffectsComponent::UpdateMedDetailEffects(v2, v3, v6);
      break;
    case 3:
      UFG::VehicleEffectsComponent::ManageSignalLights(v2, v3);
      UFG::VehicleEffectsComponent::ManageDamageEffects(v2, v3);
      UFG::VehicleEffectsComponent::UpdateHighDetailEffects(v2, v3, v6, v10);
      break;
  }
}

// File Line: 1443
// RVA: 0x67FFA0
void __fastcall UFG::VehicleEffectsComponent::ManageHeadlights(UFG::VehicleEffectsComponent *this, float deltaTime, bool isRaining)
{
  bool v3; // bl
  UFG::VehicleEffectsComponent *v4; // rdi
  UFG::TimeOfDayManager *v5; // rax
  float v6; // xmm7_4
  bool v7; // bl
  bool v8; // zf
  float v9; // xmm6_4
  bool v10; // cf
  int v11; // eax
  UFG::SimComponent *v12; // rax

  v3 = isRaining;
  v4 = this;
  v5 = UFG::TimeOfDayManager::GetInstance();
  v6 = v5->m_SecondsSinceMidnight;
  v7 = v3 && *((_BYTE *)v4 + 1884) & 8
    || (unsigned __int8)Render::FXManager::IsInBetweenTime(
                          &Render::gFXManager,
                          v5->m_SecondsSinceMidnight,
                          HEADLIGHT_ON_TIME,
                          HEADLIGHT_OFF_TIME);
  v8 = v4->mNumQueuedHeadlightChanges == 0;
  if ( v4->mNumQueuedHeadlightChanges )
  {
    v9 = deltaTime + v4->mHeadlightFlashesTimer;
    v10 = v9 < v4->mHeadlightFlashesLength;
    v8 = v9 == v4->mHeadlightFlashesLength;
    v4->mHeadlightFlashesTimer = v9;
    if ( !v10 && !v8 )
    {
      if ( v4->mEffectStatusTable[4].mState == 3 || v4->mEffectStatusTable[5].mState == 3 )
        UFG::VehicleEffectsComponent::TurnOffHeadlights(v4);
      else
        UFG::VehicleEffectsComponent::TurnOnHeadlights(v4, v7);
      --v4->mNumQueuedHeadlightChanges;
      v4->mHeadlightFlashesTimer = 0.0;
    }
    v8 = v4->mNumQueuedHeadlightChanges == 0;
  }
  if ( v8 )
  {
    v11 = *((_DWORD *)v4 + 471);
    if ( !(v11 & 0x10) )
    {
      if ( v11 & 0x20 )
      {
LABEL_25:
        UFG::VehicleEffectsComponent::TurnOnHeadlights(v4, v7);
        return;
      }
      if ( v11 & 0x40 )
      {
LABEL_18:
        UFG::VehicleEffectsComponent::TurnOffHeadlights(v4);
        return;
      }
      if ( (v11 & 0x80u) != 0 && v4->mEffectStatusTable[7].mState != 3 )
      {
        v12 = v4->mVehicleDriverComponent.m_pSimComponent;
        if ( v12 )
        {
          if ( !((LODWORD(v12[4].vfptr) - 2) & 0xFFFFFFFD) )
          {
            if ( !v7
              && !(unsigned __int8)Render::FXManager::IsInBetweenTime(
                                     &Render::gFXManager,
                                     v6,
                                     v4->mHeadlightFlareOnTime,
                                     v4->mHeadlightFlareOffTime) )
            {
              goto LABEL_18;
            }
            goto LABEL_25;
          }
        }
      }
    }
  }
}

// File Line: 1501
// RVA: 0x6800F0
void __fastcall UFG::VehicleEffectsComponent::ManageSignalLights(UFG::VehicleEffectsComponent *this, float deltaTime)
{
  UFG::SimComponent *v2; // rdi
  UFG::VehicleEffectsComponent *v3; // rbx
  UFG::RoadNetworkLane *v4; // rbp
  UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *v5; // rsi
  float v6; // xmm6_4
  UFG::RoadNetworkLocation *v7; // rax
  float v8; // xmm6_4
  int v9; // eax
  UFG::RoadNetworkLane *v10; // rax
  float v11; // xmm1_4

  v2 = this->mRoadSpaceComponent.m_pSimComponent;
  v3 = this;
  if ( !v2 || !LOBYTE(v2[8].m_Flags) )
  {
    if ( !this->mPreTurnLane )
      return;
    goto LABEL_16;
  }
  if ( this->mEffectStatusTable[14].mState == 3 || this->mEffectStatusTable[15].mState == 3 )
  {
    v10 = this->mPreTurnLane;
    if ( !v10 )
      return;
    if ( (UFG::RoadNetworkLane *)v2[6].m_BoundComponentHandles.mNode.mNext == v10 )
      return;
    v11 = this->mSignalTimer - deltaTime;
    this->mSignalTimer = v11;
    if ( v11 > 0.0 )
      return;
LABEL_16:
    UFG::VehicleEffectsComponent::TurnOffLightEffects(this, FX_LEFTTURN);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, FX_RIGHTTURN);
    v3->mPreTurnLane = 0i64;
    return;
  }
  if ( this->mLevelOfDetail == 3 )
  {
    v4 = (UFG::RoadNetworkLane *)v2[7].m_SafePointerList.mNode.mPrev;
    v5 = v2[6].m_BoundComponentHandles.mNode.mNext;
    if ( v5 )
    {
      if ( v4 )
      {
        if ( v5 != (UFG::qNode<UFG::RebindingComponentHandleBase,UFG::RebindingComponentHandleBase> *)v4 )
        {
          v6 = UFG::RoadNetworkLane::GetLength((UFG::RoadNetworkLane *)v2[6].m_BoundComponentHandles.mNode.mNext);
          v7 = Scaleform::GFx::AS3::Instances::fl::XML::GetName((UFG::RoadNetworkGuide *)&v2[5].m_BoundComponentHandles.mNode.mNext);
          v8 = v6 - UFG::RoadNetworkLocation::GetDistanceAlongSpline(v7);
          v9 = UFG::RoadNetworkLane::GetTurnDirection(v4);
          if ( v8 < 10.0 )
          {
            if ( v9 )
            {
              UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, (UFG::VehicleEffectId)((v9 != 1) + 14));
              v3->mPreTurnLane = (UFG::RoadNetworkLane *)v5;
              v3->mSignalTimer = 3.0;
            }
          }
        }
      }
    }
  }
}

// File Line: 1552
// RVA: 0x67FE40
void __fastcall UFG::VehicleEffectsComponent::ManageDamageEffects(UFG::VehicleEffectsComponent *this, float deltaTime)
{
  UFG::SimComponent *v2; // rax
  UFG::VehicleEffectsComponent *v3; // rbx
  float v4; // xmm1_4
  float v5; // xmm6_4
  signed int v6; // edi
  UFG::VehicleEffectId *v7; // rsi
  UFG::VehicleEffectId v8; // edx
  float v9; // xmm1_4

  v2 = this->mMoverComponent.m_pSimComponent;
  v3 = this;
  if ( HIDWORD(v2[2].m_BoundComponentHandles.mNode.mPrev) == 2 )
  {
    if ( *((_BYTE *)this + 1884) & 1 )
    {
      v9 = this->mExtinguishFireCountdown - deltaTime;
      this->mExtinguishFireCountdown = v9;
      if ( v9 < 0.0 )
        UFG::VehicleEffectsComponent::TurnOffFire(this);
    }
    v8 = 22;
    this = v3;
    if ( v3->mLevelOfDetail != 3 )
    {
      UFG::VehicleEffectsComponent::TurnOffEffect_New(v3, FX_SMOLDERING);
      return;
    }
LABEL_14:
    UFG::VehicleEffectsComponent::TurnOnEffect_New(this, v8);
    return;
  }
  v4 = *(float *)&v2[2].m_BoundComponentHandles.mNode.mPrev;
  if ( v4 >= 1.0 )
  {
    v5 = *(float *)&v2[3].vfptr;
    v6 = 0;
    v7 = sDestructStates;
    do
    {
      if ( v5 > (float)((float)v6 * 0.33333334) )
        UFG::VehicleEffectsComponent::TurnOnEffect_New(v3, *v7);
      ++v6;
      ++v7;
    }
    while ( (unsigned int)v6 < 3 );
    return;
  }
  if ( *(float *)&v2[13].m_BoundComponentHandles.mNode.mPrev >= 0.0 )
  {
    UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_DAMAGE);
    UFG::VehicleEffectsComponent::TurnOffEffect_New(v3, FX_ENGINEDAMAGE);
    UFG::VehicleEffectsComponent::TurnOnEffect_New(v3, FX_ENGINEBLOWN);
    return;
  }
  if ( v4 >= UFG::PhysicsMoverInterface::mEngineDamagedThreshold )
  {
    UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_DAMAGE);
    UFG::VehicleEffectsComponent::TurnOnEffect_New(v3, FX_ENGINEDAMAGE);
    return;
  }
  if ( v4 >= UFG::PhysicsMoverInterface::mRipeForTakedownThreshold )
  {
    v8 = 28;
    goto LABEL_14;
  }
}

// File Line: 1611
// RVA: 0x695260
void __fastcall UFG::VehicleEffectsComponent::UpdateBuoyancy(UFG::VehicleEffectsComponent *this, UFG::PhysicsBoat *physicsBoat)
{
  UFG::PhysicsBoat *v2; // r12
  UFG::VehicleEffectsComponent *v3; // rdi
  UFG::SimObjectCVBase *v4; // rcx
  UFG::CharacterAnimationComponent *v5; // rax
  unsigned __int16 v6; // dx
  Creature *v7; // r14
  float v8; // xmm6_4
  signed int v9; // ebx
  UFG::qMatrix44 *v10; // r15
  __int64 v11; // rsi
  int v12; // eax
  char v13; // al
  float v14; // xmm15_4
  float v15; // xmm7_4
  float v16; // xmm1_4
  float v17; // xmm12_4
  float v18; // xmm13_4
  float v19; // xmm14_4
  float v20; // xmm3_4
  float v21; // xmm2_4
  float v22; // xmm1_4
  float v23; // xmm0_4
  float v24; // xmm11_4
  float v25; // xmm1_4
  float v26; // xmm8_4
  float v27; // xmm9_4
  float v28; // xmm10_4
  float v29; // xmm2_4
  float v30; // xmm1_4
  float v31; // xmm3_4
  float v32; // xmm4_4
  float v33; // xmm5_4
  float v34; // xmm1_4
  float v35; // xmm0_4
  float v36; // xmm12_4
  float v37; // xmm13_4
  float v38; // xmm14_4
  float v39; // xmm0_4
  float v40; // xmm15_4
  float v41; // xmm6_4
  float v42; // xmm7_4
  float v43; // xmm11_4
  float v44; // xmm0_4
  float v45; // xmm3_4
  float v46; // xmm4_4
  float v47; // xmm2_4
  float v48; // [rsp+20h] [rbp-B8h]
  float v49; // [rsp+24h] [rbp-B4h]
  float v50; // [rsp+28h] [rbp-B0h]
  float v51; // [rsp+2Ch] [rbp-ACh]
  __int64 v52; // [rsp+30h] [rbp-A8h]
  UFG::qMatrix44 transform; // [rsp+40h] [rbp-98h]
  float v54; // [rsp+88h] [rbp-50h]
  float v55; // [rsp+8Ch] [rbp-4Ch]
  float v56; // [rsp+90h] [rbp-48h]
  float v57; // [rsp+C8h] [rbp-10h]
  float v58; // [rsp+CCh] [rbp-Ch]
  float v59; // [rsp+D0h] [rbp-8h]
  float v60; // [rsp+108h] [rbp+30h]
  float v61; // [rsp+10Ch] [rbp+34h]
  float v62; // [rsp+110h] [rbp+38h]
  UFG::qMatrix44 v63; // [rsp+118h] [rbp+40h]

  v52 = -2i64;
  v2 = physicsBoat;
  v3 = this;
  v4 = (UFG::SimObjectCVBase *)this->m_pSimObject;
  if ( v4 )
  {
    v6 = v4->m_Flags;
    if ( (v6 >> 14) & 1 )
    {
      v5 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v4);
    }
    else if ( (v6 & 0x8000u) == 0 )
    {
      if ( (v6 >> 13) & 1 )
      {
        v5 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v4);
      }
      else if ( (v6 >> 12) & 1 )
      {
        v5 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                   (UFG::SimObjectGame *)&v4->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
      else
      {
        v5 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                   (UFG::SimObject *)&v4->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
    }
    else
    {
      v5 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v4);
    }
  }
  else
  {
    v5 = 0i64;
  }
  v7 = v5->mCreature;
  if ( !(_S24_1 & 1) )
  {
    _S24_1 |= 1u;
    buoyanceBoneNames[0] = UFG::qStringHashUpper32("E_SprayFrontL", 0xFFFFFFFF);
    dword_142438D6C = UFG::qStringHashUpper32("E_SprayFrontR", 0xFFFFFFFF);
    dword_142438D70 = UFG::qStringHashUpper32("E_SprayRearL", 0xFFFFFFFF);
    dword_142438D74 = UFG::qStringHashUpper32("E_SprayRearR", 0xFFFFFFFF);
  }
  v8 = 0.0;
  if ( v7 )
  {
    v9 = 0;
    v10 = &transform;
    v11 = 0i64;
    do
    {
      *(float *)((char *)&v48 + v11 * 4) = UFG::PhysicsBoat::GetFloatBuoyancy(v2, v9);
      if ( v7->mPose.mRigHandle.mData )
        v12 = Skeleton::GetBoneID(v7->mPose.mRigHandle.mUFGSkeleton, buoyanceBoneNames[v11]);
      else
        v12 = -1;
      Creature::GetTransform(v7, v12, v10);
      v8 = v8 + UFG::PhysicsBoat::GetFloatBuoyancy(v2, v9++);
      ++v10;
      ++v11;
    }
    while ( v9 < 4 );
    Creature::GetTransform(v7, 0, &v63);
  }
  else
  {
    v63 = UFG::qMatrix44::msIdentity;
  }
  if ( v63.v3.z >= 0.0 || (v13 = 1, v8 <= 0.1) )
    v13 = 0;
  *((_DWORD *)v3 + 471) &= 0xFFFFFFFB;
  *((_DWORD *)v3 + 471) |= 4 * (v13 & 1);
  Render::DebugDrawManager::GetContext(Render::DebugDrawManager::mInstance, 2u);
  v3->mSprayEffects[0].mBuoyancyRatio = 0.0;
  v14 = v50;
  v15 = v48;
  if ( (float)(v50 + v48) > 0.0 )
    v3->mSprayEffects[0].mBuoyancyRatio = (float)(v48 / (float)(v50 + v48)) * 0.1;
  v16 = v3->mSprayEffects[0].mBuoyancyRatio;
  v17 = transform.v3.x;
  v18 = transform.v3.y;
  v19 = transform.v3.z;
  v20 = (float)(v59 - transform.v3.z) * v16;
  v21 = transform.v3.x + (float)((float)(v57 - transform.v3.x) * v16);
  v22 = transform.v3.y + (float)((float)(v58 - transform.v3.y) * v16);
  v23 = transform.v3.z + v20;
  v3->mSprayEffects[0].mWaterLinePosition.x = v21;
  v3->mSprayEffects[0].mWaterLinePosition.y = v22;
  v3->mSprayEffects[0].mWaterLinePosition.z = v23;
  v3->mSprayEffects[1].mBuoyancyRatio = 0.0;
  v24 = v49;
  if ( (float)(v51 + v49) > 0.0 )
    v3->mSprayEffects[1].mBuoyancyRatio = (float)(v49 / (float)(v51 + v49)) * 0.1;
  v25 = v3->mSprayEffects[1].mBuoyancyRatio;
  v26 = v54;
  v27 = v55;
  v28 = v56;
  v29 = v54 + (float)((float)(v60 - v54) * v25);
  v30 = v55 + (float)((float)(v61 - v55) * v25);
  v3->mSprayEffects[1].mWaterLinePosition.x = v29;
  v3->mSprayEffects[1].mWaterLinePosition.y = v30;
  v3->mSprayEffects[0].mWaterLinePosition.z = 0.0;
  v3->mSprayEffects[1].mWaterLinePosition.z = 0.0;
  if ( *((_BYTE *)v3 + 1884) & 4 )
  {
    v31 = (float)((float)((float)(v17 + v26) + v57) + v60) * 0.25;
    v32 = (float)((float)((float)(v18 + v27) + v58) + v61) * 0.25;
    v33 = (float)((float)((float)(v19 + v28) + v59) + v62) * 0.25;
    v34 = 1.0 / v8;
    v35 = 1.0 - (float)(v15 * (float)(1.0 / v8));
    v36 = (float)(v17 - v31) * v35;
    v37 = (float)(v18 - v32) * v35;
    v38 = (float)(v19 - v33) * v35;
    v39 = 1.0 - (float)(v24 * (float)(1.0 / v8));
    v40 = v14 * (float)(1.0 / v8);
    v41 = (float)((float)(v57 - v31) * (float)(1.0 - v40)) + (float)((float)((float)(v26 - v31) * v39) + v36);
    v42 = (float)((float)(v58 - v32) * (float)(1.0 - v40)) + (float)((float)((float)(v27 - v32) * v39) + v37);
    v43 = (float)((float)(v59 - v33) * (float)(1.0 - v40)) + (float)((float)((float)(v28 - v33) * v39) + v38);
    v44 = v60 - v31;
    v45 = v61 - v32;
    v46 = v62 - v33;
    v47 = 1.0 - (float)(v51 * v34);
    v3->mSprayVector.x = (float)(v44 * v47) + v41;
    v3->mSprayVector.y = (float)(v45 * v47) + v42;
    v3->mSprayVector.z = (float)(v46 * v47) + v43;
  }
}

// File Line: 1714
// RVA: 0x699A20
void __fastcall UFG::VehicleEffectsComponent::UpdateSprayEffects(UFG::VehicleEffectsComponent *this, UFG::HullSprayEffects *sEffect, unsigned int markerId, UFG::PhysicsBoat *physicsBoat)
{
  UFG::PhysicsBoat *v4; // r13
  unsigned int v5; // er12
  UFG::HullSprayEffects *v6; // rdi
  UFG::VehicleEffectsComponent *v7; // r14
  bool v8; // bp
  int v9; // edx
  signed __int64 v10; // rbx
  UFG::VehicleEffectState *v11; // rax
  UFG::qBaseTreeRB *v12; // r15
  UFG::qBaseTreeRB *v13; // rbx
  UFG::qBaseTreeRB *v14; // rax
  unsigned int v15; // edx
  UFG::VehicleEffect *v16; // rsi
  Render::FXOverride *v17; // rax
  Render::FXOverride *v18; // rbp
  UFG::VehicleEffect *v19; // rsi
  float v20; // xmm0_4
  float v21; // xmm1_4
  UFG::TransformNodeComponent *v22; // rcx
  float v23; // xmm0_4
  float v24; // xmm1_4
  float v25; // xmm0_4
  float v26; // xmm1_4
  float v27; // xmm0_4
  float v28; // xmm1_4
  float v29; // xmm0_4
  float v30; // xmm1_4
  float v31; // xmm0_4
  float v32; // xmm1_4
  float v33; // xmm0_4
  float v34; // xmm1_4
  UFG::allocator::free_link *v35; // rax
  float v36; // xmm3_4
  float v37; // xmm4_4
  __m128 v38; // xmm5
  float v39; // xmm6_4
  __m128 v40; // xmm2
  float v41; // xmm1_4
  float v42; // xmm8_4
  __m128 v43; // xmm2
  float v44; // xmm9_4
  float v45; // xmm4_4
  float v46; // xmm5_4
  float v47; // xmm6_4
  __m128 v48; // xmm7
  float v49; // xmm2_4
  Render::FXOverride *v50; // rax
  UFG::TransformNodeComponent *v51; // r8
  unsigned int v52; // edx
  Render::FXOverride *v53; // rax
  Render::FXOverride *v54; // rbx
  UFG::qMatrix44 m; // [rsp+30h] [rbp-A8h]
  bool v56; // [rsp+E0h] [rbp+8h]

  v4 = physicsBoat;
  v5 = markerId;
  v6 = sEffect;
  v7 = this;
  v8 = this->mVehicleDriverComponent.m_pSimComponent
    && ((unsigned __int8 (*)(void))this->mVehicleDriverComponent.m_pSimComponent->vfptr[15].__vecDelDtor)();
  v56 = v8;
  v9 = 34 - (v8 != 0);
  v10 = v9;
  if ( v7->mEffectStatusTable[v9].mState == UNINITIALIZED )
    UFG::VehicleEffectsComponent::InitializeEffect_New(v7, (UFG::VehicleEffectId)v9);
  v11 = v7->mEffectStatusTable[v10].mInternalState;
  if ( v11 )
  {
    v12 = &v11->mEffects.mTree;
    v13 = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&v11->mEffects);
    if ( v13 )
    {
      do
      {
        if ( HIDWORD(v13->mNULL.mChild[0]) == v5 )
        {
          v14 = (UFG::qBaseTreeRB *)v6->mEffectState;
          if ( v14 )
          {
            if ( v14 != v13 )
            {
              v15 = v14[1].mRoot.mUID;
              if ( v15 != -1 )
              {
                Render::FXManager::KillEffect(&Render::gFXManager, v15, 0);
                v6->mEffectState->mEffectRef = -1;
                v16 = v6->mEffectState;
                v17 = v16->mEffectOverride.m_pPointer;
                if ( v17 )
                {
                  --v17->mReferenceCount;
                  v18 = v16->mEffectOverride.m_pPointer;
                  if ( v18->mReferenceCount <= 0 )
                  {
                    if ( v18 )
                    {
                      Render::FXOverride::~FXOverride(v16->mEffectOverride.m_pPointer);
                      operator delete[](v18);
                    }
                    v16->mEffectOverride.m_pPointer = 0i64;
                  }
                  v16->mEffectOverride.m_pPointer = 0i64;
                }
              }
            }
          }
          v6->mEffectState = (UFG::VehicleEffect *)v13;
        }
        v13 = UFG::qBaseTreeRB::GetNext(v12, &v13->mRoot);
      }
      while ( v13 );
      v8 = v56;
    }
  }
  v19 = v6->mEffectState;
  if ( v19 )
  {
    if ( *((_BYTE *)v7 + 1884) & 4 )
    {
      v20 = v4->mBodyTransform.v0.x;
      v21 = v4->mBodyTransform.v0.y;
      v22 = v6->mTransform;
      m.v3.w = 1.0;
      m.v0.x = v20;
      v23 = v4->mBodyTransform.v0.z;
      m.v0.y = v21;
      v24 = v4->mBodyTransform.v0.w;
      m.v0.z = v23;
      m.v1.x = v4->mBodyTransform.v1.x;
      v25 = v4->mBodyTransform.v1.z;
      m.v0.w = v24;
      v26 = v4->mBodyTransform.v1.y;
      m.v1.z = v25;
      v27 = v4->mBodyTransform.v2.x;
      m.v1.y = v26;
      v28 = v4->mBodyTransform.v1.w;
      m.v2.x = v27;
      v29 = v4->mBodyTransform.v2.z;
      m.v1.w = v28;
      v30 = v4->mBodyTransform.v2.y;
      m.v2.z = v29;
      v31 = v6->mWaterLinePosition.x;
      m.v2.y = v30;
      v32 = v4->mBodyTransform.v2.w;
      m.v3.x = v31;
      v33 = v6->mWaterLinePosition.z;
      m.v2.w = v32;
      v34 = v6->mWaterLinePosition.y;
      m.v3.z = v33;
      m.v3.y = v34;
      UFG::TransformNodeComponent::SetWorldTransform(v22, &m);
      if ( v19->mRequestedSpeed != v7->mSpeedLevel || v19->mEffectRef == -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v19->mEffectRef, 0);
        v19->mEffectRef = -1;
        UFG::VehicleEffectsComponent::UpdateEffectSpeed(v7, v19);
        v35 = Render::FXOverride::CreateOverride("VehicleEffectsComponent::Spray Override", 0i64);
        FX::SharedPointer<Render::FXOverride>::Set(&v19->mEffectOverride, (Render::FXOverride *)v35);
        v19->mEffectRef = Render::FXManager::CreateEffect(
                            &Render::gFXManager,
                            v19->mBoundEffect[v19->mSpeed],
                            v6->mTransform,
                            0xFFFFFFFF,
                            v19->mEffectOverride.m_pPointer);
      }
      v38 = (__m128)LODWORD(m.v3.y);
      v36 = 0.0;
      v37 = m.v3.x - v4->mBodyTransform.v3.x;
      v38.m128_f32[0] = m.v3.y - v4->mBodyTransform.v3.y;
      v39 = m.v3.z - v4->mBodyTransform.v3.z;
      v40 = v38;
      v40.m128_f32[0] = (float)((float)(v38.m128_f32[0] * v38.m128_f32[0]) + (float)(v37 * v37)) + (float)(v39 * v39);
      if ( v40.m128_f32[0] == 0.0 )
        v41 = 0.0;
      else
        v41 = 1.0 / COERCE_FLOAT(_mm_sqrt_ps(v40));
      v42 = v7->mSprayVector.y;
      v43 = (__m128)LODWORD(v7->mSprayVector.x);
      v44 = v7->mSprayVector.z;
      v45 = v37 * v41;
      v46 = v38.m128_f32[0] * v41;
      v47 = v39 * v41;
      v48 = v43;
      v48.m128_f32[0] = (float)((float)(v43.m128_f32[0] * v43.m128_f32[0]) + (float)(v42 * v42)) + (float)(v44 * v44);
      if ( v48.m128_f32[0] != 0.0 )
        v36 = 1.0 / COERCE_FLOAT(_mm_sqrt_ps(v48));
      v49 = (float)((float)((float)((float)((float)(v43.m128_f32[0] * v36) * v45) + (float)((float)(v42 * v36) * v46))
                          + (float)((float)(v44 * v36) * v47))
                  * 1.35)
          + 1.0;
      if ( v49 < 0.97500002 )
        v49 = FLOAT_0_97500002;
      v50 = v19->mEffectOverride.m_pPointer;
      if ( v50 )
        v50->sizeScale = v49;
      if ( v8 && v49 > 1.075 && v19->mSpeed > 1 )
      {
        if ( !((v6->mDropletEffectRef + 1) & 0xFFFFFFFE) )
        {
          v51 = v6->mTransform;
          if ( v5 == -875726393 )
            v6->mDropletEffectRef = Render::FXManager::CreateEffect(
                                      &Render::gFXManager,
                                      0x57EBAD32u,
                                      v51,
                                      0xFFFFFFFF,
                                      0i64);
          else
            v6->mDropletEffectRef = Render::FXManager::CreateEffect(
                                      &Render::gFXManager,
                                      0xCDC1D02A,
                                      v51,
                                      0xFFFFFFFF,
                                      0i64);
        }
        return;
      }
      v52 = v6->mDropletEffectRef;
      if ( v52 == -1 )
        return;
    }
    else
    {
      Render::FXManager::KillEffect(&Render::gFXManager, v19->mEffectRef, 0);
      v19->mEffectRef = -1;
      v53 = v19->mEffectOverride.m_pPointer;
      if ( v53 )
      {
        --v53->mReferenceCount;
        v54 = v19->mEffectOverride.m_pPointer;
        if ( v54->mReferenceCount <= 0 )
        {
          if ( v54 )
          {
            Render::FXOverride::~FXOverride(v19->mEffectOverride.m_pPointer);
            operator delete[](v54);
          }
          v19->mEffectOverride.m_pPointer = 0i64;
        }
        v19->mEffectOverride.m_pPointer = 0i64;
      }
      v52 = v6->mDropletEffectRef;
    }
    Render::FXManager::KillEffect(&Render::gFXManager, v52, 0);
    v6->mDropletEffectRef = -1;
  }
}

// File Line: 1810
// RVA: 0x696F60
void __fastcall UFG::VehicleEffectsComponent::UpdateHighDetailEffects(UFG::VehicleEffectsComponent *this, float deltaTime, bool isMoving, bool isNightTime)
{
  bool v4; // r14
  UFG::VehicleEffectsComponent *v5; // rdi
  UFG::SimObject *v6; // rbx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v7; // rsi
  UFG::qMemoryPool *v8; // rax
  UFG::allocator::free_link *v9; // rax
  UFG::qMemoryPool *v10; // rax
  UFG::allocator::free_link *v11; // rax
  int v12; // ebx
  float v13; // xmm0_4
  UFG::VehicleEffectId v14; // edx
  float v15; // xmm10_4
  float v16; // xmm11_4
  float v17; // xmm12_4
  float v18; // xmm0_4
  float v19; // xmm13_4
  float v20; // xmm14_4
  float v21; // xmm15_4
  float v22; // xmm0_4
  float v23; // xmm8_4
  float v24; // xmm7_4
  float v25; // xmm6_4
  float v26; // xmm0_4
  float v27; // xmm1_4
  float v28; // xmm2_4
  float v29; // xmm3_4
  float v30; // xmm9_4
  UFG::SimObjectCVBase *v31; // rcx
  UFG::CharacterAnimationComponent *v32; // rax
  unsigned __int16 v33; // dx
  Creature *v34; // r14
  __int64 v35; // rbx
  UFG::TransformNodeComponent **v36; // rsi
  UFG::TransformNodeComponent *v37; // rcx
  unsigned int v38; // ecx
  int v39; // er15
  signed int v40; // eax
  int v41; // esi
  __int64 v42; // r13
  __int64 v43; // r14
  unsigned int *v44; // rbx
  signed __int64 v45; // r14
  UFG::SimComponent *v46; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v47; // rax
  UFG::PhysicsWheeledVehicle *v48; // rcx
  float v49; // xmm6_4
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v50; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v51; // rax
  unsigned int v52; // eax
  UFG::TransformNodeComponent *v53; // rax
  UFG::SimComponent *v54; // rax
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v55; // rdx
  UFG::PhysicsWheeledVehicle *v56; // rcx
  UFG::SimComponent *v57; // rbx
  UFG::PhysicsVehicle *v58; // rcx
  float v59; // xmm1_4
  __m128 v60; // xmm0
  float v61; // xmm2_4
  float v62; // xmm10_4
  __int128 v63; // xmm0
  bool v64; // dl
  UFG::PhysicsSurfaceProperties **v65; // r12
  unsigned int *v66; // rbx
  signed __int64 v67; // r8
  signed __int64 v68; // r9
  signed __int64 v69; // r13
  UFG::SimComponent *v70; // rdx
  float v71; // xmm7_4
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v72; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v73; // rax
  float v74; // xmm6_4
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v75; // rax
  bool v76; // zf
  UFG::PhysicsWheeledVehicle *v77; // rcx
  unsigned __int64 v78; // rsi
  UFG::qReflectObjectType<UFG::PhysicsSurfaceProperties,UFG::qReflectObject> *v79; // rcx
  const char *v80; // rax
  unsigned int v81; // edx
  UFG::SimComponent *v82; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v83; // rax
  UFG::PhysicsWheeledVehicle *v84; // rcx
  unsigned int v85; // edx
  UFG::PhysicsSurfaceProperties *v86; // rsi
  unsigned int v87; // er14
  UFG::TransformNodeComponent *v88; // rax
  UFG::qMatrix44 rootXform; // [rsp+30h] [rbp-A8h]
  UFG::qVector3 result; // [rsp+70h] [rbp-68h]
  float v91; // [rsp+7Ch] [rbp-5Ch]
  float v92; // [rsp+80h] [rbp-58h]
  int v93; // [rsp+84h] [rbp-54h]
  float v94; // [rsp+88h] [rbp-50h]
  float v95; // [rsp+8Ch] [rbp-4Ch]
  float v96; // [rsp+90h] [rbp-48h]
  int v97; // [rsp+94h] [rbp-44h]
  float v98; // [rsp+98h] [rbp-40h]
  float v99; // [rsp+9Ch] [rbp-3Ch]
  float v100; // [rsp+A0h] [rbp-38h]
  int v101; // [rsp+A4h] [rbp-34h]
  __int64 v102; // [rsp+A8h] [rbp-30h]
  __int64 v103; // [rsp+B0h] [rbp-28h]
  __int64 v104; // [rsp+B8h] [rbp-20h]
  __int64 v105; // [rsp+C0h] [rbp-18h]
  UFG::qMatrix44 transform; // [rsp+C8h] [rbp-10h]
  UFG::allocator::free_link *v107; // [rsp+1D8h] [rbp+100h]

  v105 = -2i64;
  v4 = isMoving;
  v5 = this;
  v6 = this->m_pSimObject;
  if ( v6 )
    v6 = (UFG::SimObject *)v6->m_pTransformNodeComponent;
  if ( this->mMoverComponent.m_pSimComponent && v6 && *((_BYTE *)this + 1884) < 0 )
  {
    v7 = this->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
    if ( v7 && !(BYTE4(v7[37].mNext) & 7) )
    {
      if ( !this->mSprayEffects[0].mTransform )
      {
        v8 = UFG::GetSimulationMemoryPool();
        v9 = UFG::qMemoryPool::Allocate(v8, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
        v107 = v9;
        if ( v9 )
          UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v9, 0xADF7E713, 0i64, 0);
        v5->mSprayEffects[0].mTransform = (UFG::TransformNodeComponent *)v9;
      }
      if ( !v5->mSprayEffects[1].mTransform )
      {
        v10 = UFG::GetSimulationMemoryPool();
        v11 = UFG::qMemoryPool::Allocate(v10, 0x110ui64, "VehicleEffectsComponent.TransformNodeComponent", 0i64, 1u);
        v107 = v11;
        if ( v11 )
          UFG::TransformNodeComponent::TransformNodeComponent((UFG::TransformNodeComponent *)v11, 0x290B50E6u, 0i64, 0);
        v5->mSprayEffects[1].mTransform = (UFG::TransformNodeComponent *)v11;
      }
      v12 = *((_DWORD *)v5 + 471) >> 2;
      UFG::VehicleEffectsComponent::UpdateBuoyancy(v5, (UFG::PhysicsBoat *)v7);
      UFG::VehicleEffectsComponent::UpdateSprayEffects(v5, v5->mSprayEffects, 0xCBCD79C7, (UFG::PhysicsBoat *)v7);
      UFG::VehicleEffectsComponent::UpdateSprayEffects(v5, &v5->mSprayEffects[1], 0xBB5202BD, (UFG::PhysicsBoat *)v7);
      if ( v12 & 1 )
      {
        if ( *((_BYTE *)v5 + 1884) & 4 )
          goto LABEL_26;
      }
      else if ( *((_BYTE *)v5 + 1884) & 4 )
      {
        if ( v5->mAirTime <= 0.33000001 )
          goto LABEL_27;
        UFG::VehicleEffectsComponent::TurnOffEffect_New(v5, FX_EXITWATER);
        if ( *(float *)&v7[6].mPrev[10].mNext[35].mNext < -3.0 )
          UFG::VehicleEffectsComponent::TurnOnEffect_New(v5, FX_ENTERWATER);
LABEL_26:
        v5->mAirTime = 0.0;
LABEL_27:
        if ( *((_BYTE *)v5 + 1884) & 4 && v4 )
          UFG::VehicleEffectsComponent::TurnOnExhaust(v5);
        else
          UFG::VehicleEffectsComponent::TurnOffExhaust(v5);
        v14 = 12;
LABEL_165:
        UFG::VehicleEffectsComponent::TurnOffEffect_New(v5, v14);
        return;
      }
      v13 = v5->mAirTime;
      if ( v13 <= 0.33000001 && (float)(v13 + deltaTime) > 0.33000001 )
      {
        UFG::VehicleEffectsComponent::TurnOffEffect_New(v5, FX_ENTERWATER);
        UFG::VehicleEffectsComponent::TurnOnEffect_New(v5, FX_EXITWATER);
      }
      v5->mAirTime = deltaTime + v5->mAirTime;
      goto LABEL_27;
    }
    UFG::VehicleEffectsComponent::DoRimAndBumperSparks(this, isMoving);
    if ( v5->mVehicleDriverComponent.m_pSimComponent
      && v5->mVehicleDriverComponent.m_pSimComponent[3].m_BoundComponentHandles.mNode.mNext )
    {
      UFG::VehicleEffectsComponent::TurnOnExhaust(v5);
    }
    else
    {
      UFG::VehicleEffectsComponent::TurnOffExhaust(v5);
    }
    if ( v5->mVehicleDriverComponent.m_pSimComponent
      && v5->mVehicleDriverComponent.m_pSimComponent[3].m_BoundComponentHandles.mNode.mNext
      && UFG::PhysicsMoverInterface::AreAllWheelsOnGround((UFG::PhysicsMoverInterface *)v5->mMoverComponent.m_pSimComponent) )
    {
      UFG::VehicleEffectsComponent::TurnOnEffect_New(v5, FX_DRAGGING);
    }
    else
    {
      UFG::VehicleEffectsComponent::TurnOffEffect_New(v5, FX_DRAGGING);
    }
    UFG::TransformNodeComponent::UpdateWorldTransform((UFG::TransformNodeComponent *)v6);
    v15 = *(float *)&v6[1].vfptr;
    v16 = *((float *)&v6[1].vfptr + 1);
    v17 = *(float *)&v6[1].m_SafePointerList.mNode.mPrev;
    v18 = *((float *)&v6[1].m_SafePointerList.mNode.mPrev + 1);
    rootXform.v0.x = *(float *)&v6[1].vfptr;
    rootXform.v0.y = v16;
    rootXform.v0.z = v17;
    rootXform.v0.w = v18;
    v19 = *(float *)&v6[1].m_SafePointerList.mNode.mNext;
    v20 = *((float *)&v6[1].m_SafePointerList.mNode.mNext + 1);
    v21 = *(float *)&v6[1].m_SafePointerWithCallbackList.mNode.mPrev;
    v22 = *((float *)&v6[1].m_SafePointerWithCallbackList.mNode.mPrev + 1);
    rootXform.v1.x = *(float *)&v6[1].m_SafePointerList.mNode.mNext;
    rootXform.v1.y = v20;
    rootXform.v1.z = v21;
    rootXform.v1.w = v22;
    v23 = *(float *)&v6[1].m_SafePointerWithCallbackList.mNode.mNext;
    v24 = *((float *)&v6[1].m_SafePointerWithCallbackList.mNode.mNext + 1);
    v25 = *(float *)&v6[1].mNode.mParent;
    v26 = *((float *)&v6[1].mNode.mParent + 1);
    rootXform.v2.x = *(float *)&v6[1].m_SafePointerWithCallbackList.mNode.mNext;
    rootXform.v2.y = v24;
    rootXform.v2.z = v25;
    rootXform.v2.w = v26;
    v27 = *((float *)v6[1].mNode.mChild + 1);
    v28 = *(float *)&v6[1].mNode.mChild[1];
    v29 = *((float *)&v6[1].mNode.mChild[1] + 1);
    rootXform.v3.x = *(float *)v6[1].mNode.mChild;
    rootXform.v3.y = v27;
    rootXform.v3.z = v28;
    rootXform.v3.w = v29;
    v30 = UFG::PhysicsMoverInterface::GetWheelRadius((UFG::PhysicsMoverInterface *)v5->mMoverComponent.m_pSimComponent);
    v31 = (UFG::SimObjectCVBase *)v5->m_pSimObject;
    if ( v31 )
    {
      v33 = v31->m_Flags;
      if ( (v33 >> 14) & 1 )
      {
        v32 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v31);
      }
      else if ( (v33 & 0x8000u) == 0 )
      {
        if ( (v33 >> 13) & 1 )
        {
          v32 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v31);
        }
        else if ( (v33 >> 12) & 1 )
        {
          v32 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                      (UFG::SimObjectGame *)&v31->vfptr,
                                                      UFG::CharacterAnimationComponent::_TypeUID);
        }
        else
        {
          v32 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                      (UFG::SimObject *)&v31->vfptr,
                                                      UFG::CharacterAnimationComponent::_TypeUID);
        }
      }
      else
      {
        v32 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v31);
      }
    }
    else
    {
      v32 = 0i64;
    }
    v34 = v32->mCreature;
    if ( v34 )
    {
      v35 = 0i64;
      if ( v5->mNumWheels )
      {
        v36 = &v5->mTransformNodes.array[4];
        while ( 1 )
        {
          Creature::GetTransform(v34, v5->mWheelBoneId.p[v35], &transform);
          UFG::TransformNodeComponent::SetLocalTransform(*(v36 - 4), &transform);
          v37 = *v36;
          if ( *v36 )
          {
            rootXform.v3.z = v15;
            rootXform.v3.w = v16;
            result.x = v17;
            result.z = v19;
            v91 = v20;
            v92 = v21;
            v94 = v23;
            v95 = v24;
            v96 = v25;
            v98 = transform.v3.x - (float)(v23 * v30);
            v99 = transform.v3.y - (float)(v24 * v30);
            v100 = transform.v3.z - (float)(v25 * v30);
            result.y = 0.0;
            v93 = 0;
            v97 = 0;
            v101 = 1065353216;
            UFG::TransformNodeComponent::SetLocalTransform(v37, (UFG::qMatrix44 *)((char *)&rootXform + 56));
          }
          UFG::VehicleEffectsComponent::UpdateDirectionalTransform(v5, v35, &transform, &rootXform, v30);
          UFG::VehicleEffectsComponent::UpdateBumperTransform(v5, v35, v34);
          v35 = (unsigned int)(v35 + 1);
          ++v36;
          if ( (unsigned int)v35 >= v5->mNumWheels )
            break;
          v25 = rootXform.v2.z;
          v24 = rootXform.v2.y;
          v23 = rootXform.v2.x;
          v21 = rootXform.v1.z;
          v20 = rootXform.v1.y;
          v19 = rootXform.v1.x;
          v17 = rootXform.v0.z;
          v16 = rootXform.v0.y;
          v15 = rootXform.v0.x;
        }
      }
    }
    v38 = v5->mNumWheels;
    v39 = (v38 == 4) + 1;
    LODWORD(v107) = (v38 == 4) + 1;
    v40 = 1;
    if ( v38 == 4 )
      v40 = 3;
    v41 = (v38 == 4) + 1;
    v42 = v39;
    v43 = v40;
    *(_QWORD *)&rootXform.v2.z = v40;
    if ( v39 <= (signed __int64)v40 )
    {
      v44 = &v5->mSkidEmitters.array[v39];
      v45 = v40 - (signed __int64)v39 + 1;
      while ( 1 )
      {
        v46 = v5->mMoverComponent.m_pSimComponent;
        if ( *(float *)((char *)v44 + (_QWORD)((char *)v46 - 1248i64 - (_QWORD)v5)) >= 1.0 )
          goto LABEL_168;
        v47 = v46[10].m_SafePointerList.mNode.mPrev;
        if ( !v47 )
          goto LABEL_169;
        v48 = 0i64;
        if ( BYTE4(v47[37].mNext) & 7 )
          v48 = (UFG::PhysicsWheeledVehicle *)v47;
        if ( v48 && UFG::PhysicsWheeledVehicle::IsWheelOnGround(v48, v41) != 1 )
        {
LABEL_168:
          v49 = 0.0;
        }
        else
        {
LABEL_169:
          v49 = 0.0;
          v50 = v5->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
          if ( v50 )
          {
            v51 = 0i64;
            if ( BYTE4(v50[37].mNext) & 7 )
              v51 = v5->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
            if ( v51 )
              v49 = *(float *)((char *)v44 + (_QWORD)((char *)v51 - 592i64 - (_QWORD)v5));
          }
        }
        v52 = *v44;
        if ( *v44 )
          goto LABEL_78;
        if ( v49 > 0.02 )
          break;
LABEL_79:
        ++v41;
        ++v44;
        if ( !--v45 )
        {
          v39 = (signed int)v107;
          v43 = *(_QWORD *)&rootXform.v2.z;
          goto LABEL_81;
        }
      }
      v53 = UFG::VehicleEffectsComponent::ObtainTransform(v5, v41 + 4);
      v52 = Render::FXManager::CreateEffect(&Render::gFXManager, 0xAEF3C51E, v53, 0xFFFFFFFF, 0i64);
      *v44 = v52;
LABEL_78:
      Render::FXManager::SetTrackStrength(&Render::gFXManager, v52, v49 * 0.40000001);
      goto LABEL_79;
    }
LABEL_81:
    v54 = v5->mMoverComponent.m_pSimComponent;
    v55 = v54[10].m_SafePointerList.mNode.mPrev;
    if ( v55 )
    {
      v56 = 0i64;
      if ( BYTE4(v55[37].mNext) & 7 )
        v56 = (UFG::PhysicsWheeledVehicle *)v54[10].m_SafePointerList.mNode.mPrev;
      if ( v56 )
        UFG::PhysicsWheeledVehicle::GetRPM(v56);
    }
    v57 = v5->mMoverComponent.m_pSimComponent;
    v58 = (UFG::PhysicsVehicle *)v57[10].m_SafePointerList.mNode.mPrev;
    if ( !v58 || (unsigned __int8)UFG::PhysicsVehicle::IsSuspended(v58) )
    {
      v61 = UFG::qVector3::msZero.x;
      result = UFG::qVector3::msZero;
      v60 = (__m128)LODWORD(UFG::qVector3::msZero.y);
      v59 = UFG::qVector3::msZero.z;
    }
    else
    {
      UFG::PhysicsVehicle::GetVelocity((UFG::PhysicsVehicle *)v57[10].m_SafePointerList.mNode.mPrev, &result);
      v59 = result.z;
      v60 = (__m128)LODWORD(result.y);
      v61 = result.x;
    }
    v60.m128_f32[0] = (float)((float)(v60.m128_f32[0] * v60.m128_f32[0]) + (float)(v61 * v61)) + (float)(v59 * v59);
    LODWORD(v62) = (unsigned __int128)_mm_sqrt_ps(v60);
    v63 = LODWORD(UFG::TimeOfDayManager::GetInstance()->m_WeatherSurfaceWetness);
    LOBYTE(v107) = *(float *)&v63 > 0.85000002;
    v64 = v5->mSpeedLevel > 1 && *(float *)&v63 > 0.85000002;
    UFG::VehicleEffectsComponent::DoWetSurfaceEffects(v5, v64);
    if ( v42 > v43 )
    {
LABEL_163:
      v14 = 24;
      if ( BYTE4(v5->mMoverComponent.m_pSimComponent[14].vfptr) & 2 )
      {
        UFG::VehicleEffectsComponent::TurnOnEffect_New(v5, FX_ROOFSLIDING);
        return;
      }
      goto LABEL_165;
    }
    v65 = &v5->mLastPhysicsSurfacProperty.array[v42];
    v66 = &v5->mSkidEffect.array[v42];
    v67 = -752i64 - (_QWORD)v5;
    v104 = -752i64 - (_QWORD)v5;
    v68 = -736i64 - (_QWORD)v5;
    v102 = -736i64 - (_QWORD)v5;
    v103 = -1424i64 - (_QWORD)v5;
    v69 = v43 - v42 + 1;
    while ( 1 )
    {
      v70 = v5->mMoverComponent.m_pSimComponent;
      v71 = 0.0;
      v72 = v70[10].m_SafePointerList.mNode.mPrev;
      if ( v72 )
      {
        v73 = 0i64;
        if ( BYTE4(v72[37].mNext) & 7 )
          v73 = v70[10].m_SafePointerList.mNode.mPrev;
        if ( v73 )
          v71 = *(float *)((char *)v66 + (_QWORD)v73 + v67);
      }
      v74 = 0.0;
      if ( v72 )
      {
        v75 = 0i64;
        if ( BYTE4(v72[37].mNext) & 7 )
          v75 = v70[10].m_SafePointerList.mNode.mPrev;
        if ( v75 )
          v74 = *(float *)((char *)v66 + (_QWORD)v75 + v68);
      }
      if ( !v72 )
        goto LABEL_170;
      v76 = (BYTE4(v72[37].mNext) & 7) == 0;
      v77 = 0i64;
      if ( !v76 )
        v77 = (UFG::PhysicsWheeledVehicle *)v70[10].m_SafePointerList.mNode.mPrev;
      if ( v77 )
        v78 = UFG::PhysicsWheeledVehicle::GetSurfacePropertyHandleUidUnderWheel(v77, v39);
      else
LABEL_170:
        v78 = 0i64;
      UFG::qReflectHandleBase::qReflectHandleBase((UFG::qReflectHandleBase *)&rootXform);
      v80 = UFG::qReflectObjectType<UFG::PhysicsSurfaceProperties,UFG::qReflectObject>::GetTypeName(v79);
      *(_QWORD *)&rootXform.v1.x = UFG::qStringHash64(v80, 0xFFFFFFFFFFFFFFFFui64);
      if ( (_BYTE)v107 )
      {
        UFG::PhysicsPropertyManager::GetSurfaceProperties(
          (UFG::qReflectHandle<UFG::PhysicsSurfaceProperties> *)&rootXform,
          0xFF38D0C4,
          1);
      }
      else
      {
        UFG::qReflectHandleBase::Init((UFG::qReflectHandleBase *)&rootXform, *(unsigned __int64 *)&rootXform.v1.x, v78);
        if ( !*(_QWORD *)&rootXform.v2.x )
          UFG::PhysicsPropertyManager::GetDefaultSurfaceProperties((UFG::qReflectHandle<UFG::PhysicsSurfaceProperties> *)&rootXform);
      }
      if ( *(UFG::PhysicsSurfaceProperties **)&rootXform.v2.x != *v65 && *((_BYTE *)v5 + 1884) < 0 )
      {
        if ( *v66 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, *v66, 0);
          *v66 = -1;
        }
        v81 = *(v66 - 44);
        if ( v81 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, v81, 0);
          *(v66 - 44) = 0;
        }
      }
      if ( v71 != 1.0 )
        goto LABEL_171;
      if ( v74 != 1.0 )
        goto LABEL_171;
      v82 = v5->mMoverComponent.m_pSimComponent;
      if ( *(float *)((char *)v66 + (_QWORD)v82 + v103) >= 1.0 )
        goto LABEL_171;
      v83 = v82[10].m_SafePointerList.mNode.mPrev;
      if ( !v83 )
        goto LABEL_172;
      v84 = 0i64;
      if ( BYTE4(v83[37].mNext) & 7 )
        v84 = (UFG::PhysicsWheeledVehicle *)v83;
      if ( v84 && !UFG::PhysicsWheeledVehicle::IsWheelOnGround(v84, v39) )
      {
LABEL_171:
        if ( v71 <= 0.25 && v74 <= 0.25 )
        {
          if ( *((_BYTE *)v5 + 1884) < 0 )
          {
            if ( *v66 != -1 )
            {
              Render::FXManager::KillEffect(&Render::gFXManager, *v66, 0);
              *v66 = -1;
            }
            v85 = *(v66 - 44);
            if ( v85 )
            {
              Render::FXManager::KillEffect(&Render::gFXManager, v85, 0);
              *(v66 - 44) = 0;
            }
          }
          goto LABEL_162;
        }
        v86 = *(UFG::PhysicsSurfaceProperties **)&rootXform.v2.x;
        if ( v62 >= 2.5 )
        {
          if ( v74 <= v71 )
          {
            if ( *((_BYTE *)v5 + 1884) >= 0 || v5->mLevelOfDetail != 3 || *v66 != -1 )
              goto LABEL_162;
            if ( v5->mVehicleDriverComponent.m_pSimComponent
              && ((unsigned __int8 (*)(void))v5->mVehicleDriverComponent.m_pSimComponent->vfptr[15].__vecDelDtor)() )
            {
              v87 = v86->mDriftEffectUID.mUID;
            }
            else
            {
              v87 = v86->mAIDriftEffectUID.mUID;
            }
          }
          else
          {
            if ( *((_BYTE *)v5 + 1884) >= 0 || v5->mLevelOfDetail != 3 || *v66 != -1 )
              goto LABEL_162;
            if ( v5->mVehicleDriverComponent.m_pSimComponent
              && ((unsigned __int8 (*)(void))v5->mVehicleDriverComponent.m_pSimComponent->vfptr[15].__vecDelDtor)() )
            {
              v87 = v86->mSkidEffectUID.mUID;
            }
            else
            {
              v87 = v86->mAISkidEffectUID.mUID;
            }
          }
        }
        else
        {
          if ( *((_BYTE *)v5 + 1884) >= 0 || v5->mLevelOfDetail != 3 || *v66 != -1 )
            goto LABEL_162;
          if ( v5->mVehicleDriverComponent.m_pSimComponent
            && ((unsigned __int8 (*)(void))v5->mVehicleDriverComponent.m_pSimComponent->vfptr[15].__vecDelDtor)() )
          {
            v87 = v86->mSlipEffectUID.mUID;
          }
          else
          {
            v87 = v86->mAISlipEffectUID.mUID;
          }
        }
        v88 = UFG::VehicleEffectsComponent::ObtainTransform(v5, v39 + 8);
        *v66 = Render::FXManager::CreateEffect(&Render::gFXManager, v87, v88, 0xFFFFFFFF, 0i64);
        *v65 = v86;
      }
      else
      {
LABEL_172:
        UFG::VehicleEffectsComponent::TurnOnSkidSmoke(
          v5,
          v39,
          *(UFG::PhysicsSurfaceProperties **)&rootXform.v2.x,
          TireSmoke_Burnout);
      }
LABEL_162:
      UFG::qReflectHandleBase::~qReflectHandleBase((UFG::qReflectHandleBase *)&rootXform);
      ++v39;
      ++v66;
      ++v65;
      --v69;
      v67 = v104;
      v68 = v102;
      if ( !v69 )
        goto LABEL_163;
    }
  }
}

// File Line: 2044
// RVA: 0x697EF0
void __fastcall UFG::VehicleEffectsComponent::UpdateMedDetailEffects(UFG::VehicleEffectsComponent *this, float deltaTime, bool isMoving)
{
  UFG::VehicleEffectsComponent *v3; // rbx
  bool v4; // r13
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v5; // rcx
  float v6; // xmm0_4
  UFG::SimObject *v7; // rsi
  unsigned int v8; // edi
  UFG::TransformNodeComponent *v9; // rsi
  float v10; // xmm1_4
  float v11; // xmm10_4
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v12; // rcx
  float v13; // xmm11_4
  float v14; // xmm12_4
  float v15; // xmm13_4
  float v16; // xmm14_4
  float v17; // xmm15_4
  float v18; // xmm7_4
  float v19; // xmm8_4
  float v20; // xmm9_4
  float v21; // xmm0_4
  float v22; // xmm1_4
  float v23; // xmm0_4
  float v24; // xmm0_4
  float v25; // xmm0_4
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v26; // rax
  float wheelRad; // xmm6_4
  UFG::SimObjectCVBase *v28; // rcx
  UFG::CharacterAnimationComponent *v29; // rax
  unsigned __int16 v30; // dx
  Creature *v31; // r12
  __int64 v32; // rsi
  int *v33; // r15
  UFG::TransformNodeComponent **v34; // r14
  UFG::TransformNodeComponent *v35; // rcx
  UFG::qMatrix44 rootXform; // [rsp+30h] [rbp-D0h]
  UFG::qMatrix44 m; // [rsp+70h] [rbp-90h]
  UFG::qVector3 result; // [rsp+B0h] [rbp-50h]
  UFG::qMatrix44 transform; // [rsp+C0h] [rbp-40h]
  float v40; // [rsp+1D8h] [rbp+D8h]

  v40 = deltaTime;
  v3 = this;
  v4 = isMoving;
  v5 = this->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
  v6 = deltaTime;
  if ( !v5 || BYTE4(v5[37].mNext) & 7 )
  {
    UFG::VehicleEffectsComponent::DoRimAndBumperSparks(v3, isMoving);
    v7 = v3->m_pSimObject;
    v8 = 0;
    if ( v7 )
      v9 = v7->m_pTransformNodeComponent;
    else
      v9 = 0i64;
    UFG::TransformNodeComponent::UpdateWorldTransform(v9);
    v10 = v9->mWorldTransform.v3.x;
    v11 = v9->mWorldTransform.v0.x;
    v12 = v3->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
    v13 = v9->mWorldTransform.v0.y;
    v14 = v9->mWorldTransform.v0.z;
    v15 = v9->mWorldTransform.v1.x;
    v16 = v9->mWorldTransform.v1.y;
    v17 = v9->mWorldTransform.v1.z;
    v18 = v9->mWorldTransform.v2.x;
    v19 = v9->mWorldTransform.v2.y;
    v20 = v9->mWorldTransform.v2.z;
    rootXform.v0.w = v9->mWorldTransform.v0.w;
    v21 = v9->mWorldTransform.v1.w;
    rootXform.v3.x = v10;
    v22 = v9->mWorldTransform.v3.z;
    rootXform.v1.w = v21;
    v23 = v9->mWorldTransform.v2.w;
    rootXform.v0.x = v11;
    rootXform.v2.w = v23;
    v24 = v9->mWorldTransform.v3.y;
    rootXform.v0.y = v13;
    rootXform.v3.y = v24;
    v25 = v9->mWorldTransform.v3.w;
    rootXform.v0.z = v14;
    rootXform.v3.w = v25;
    rootXform.v1.x = v15;
    rootXform.v1.y = v16;
    rootXform.v1.z = v17;
    rootXform.v2.x = v18;
    rootXform.v2.y = v19;
    rootXform.v2.z = v20;
    rootXform.v3.z = v22;
    if ( !v12 )
      goto LABEL_37;
    v26 = 0i64;
    if ( BYTE4(v12[37].mNext) & 7 )
      v26 = v12;
    if ( v26 )
      wheelRad = *((float *)&v26[62].mPrev + 1);
    else
LABEL_37:
      wheelRad = FLOAT_0_27000001;
    v28 = (UFG::SimObjectCVBase *)v3->m_pSimObject;
    if ( v28 )
    {
      v30 = v28->m_Flags;
      if ( (v30 >> 14) & 1 )
      {
        v29 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v28);
      }
      else if ( (v30 & 0x8000u) == 0 )
      {
        if ( (v30 >> 13) & 1 )
        {
          v29 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v28);
        }
        else if ( (v30 >> 12) & 1 )
        {
          v29 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                      (UFG::SimObjectGame *)&v28->vfptr,
                                                      UFG::CharacterAnimationComponent::_TypeUID);
        }
        else
        {
          v29 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                      (UFG::SimObject *)&v28->vfptr,
                                                      UFG::CharacterAnimationComponent::_TypeUID);
        }
      }
      else
      {
        v29 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v28);
      }
    }
    else
    {
      v29 = 0i64;
    }
    v31 = v29->mCreature;
    if ( v31 )
    {
      v32 = 0i64;
      if ( v3->mNumWheels > 0 )
      {
        v33 = (int *)&v3->mBumperBoneId;
        v34 = &v3->mTransformNodes.array[4];
        while ( 1 )
        {
          Creature::GetTransform(v31, v3->mWheelBoneId.p[v8], &transform);
          UFG::TransformNodeComponent::SetLocalTransform(*(v34 - 4), &transform);
          v35 = *v34;
          if ( *v34 )
          {
            m.v0.w = 0.0;
            m.v1.w = 0.0;
            m.v2.w = 0.0;
            m.v3.w = 1.0;
            m.v2.x = v18;
            m.v2.y = v19;
            m.v2.z = v20;
            m.v3.x = transform.v3.x - (float)(v18 * wheelRad);
            m.v3.y = transform.v3.y - (float)(v19 * wheelRad);
            m.v3.z = transform.v3.z - (float)(v20 * wheelRad);
            m.v0.x = v11;
            m.v0.y = v13;
            m.v0.z = v14;
            m.v1.x = v15;
            m.v1.y = v16;
            m.v1.z = v17;
            UFG::TransformNodeComponent::SetLocalTransform(v35, &m);
          }
          UFG::VehicleEffectsComponent::UpdateDirectionalTransform(v3, v8, &transform, &rootXform, wheelRad);
          if ( *v33 != -1 && v3->mTransformNodes.array[v32 + 12] )
          {
            Creature::GetTranslation(v31, &result, *v33);
            UFG::TransformNodeComponent::SetLocalTranslation(v3->mTransformNodes.array[v32 + 12], &result);
          }
          ++v8;
          ++v32;
          ++v34;
          ++v33;
          if ( v8 >= v3->mNumWheels )
            break;
          v20 = rootXform.v2.z;
          v19 = rootXform.v2.y;
          v18 = rootXform.v2.x;
          v17 = rootXform.v1.z;
          v16 = rootXform.v1.y;
          v15 = rootXform.v1.x;
          v14 = rootXform.v0.z;
          v13 = rootXform.v0.y;
          v11 = rootXform.v0.x;
        }
      }
    }
    v6 = v40;
  }
  UFG::VehicleEffectsComponent::UpdateLowDetailEffects(v3, v6, v4);
}

// File Line: 2087
// RVA: 0x697D10
void __fastcall UFG::VehicleEffectsComponent::UpdateLowDetailEffects(UFG::VehicleEffectsComponent *this, float deltaTime, bool isMoving)
{
  UFG::VehicleEffectsComponent *v3; // rsi
  bool v4; // bp
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v5; // rcx
  UFG::VehicleEffect *v6; // rax
  unsigned int v7; // ebx
  unsigned int v8; // edx
  UFG::VehicleEffect *v9; // rax
  UFG::VehicleEffect *v10; // r14
  Render::FXOverride *v11; // rax
  Render::FXOverride *v12; // rdi
  UFG::VehicleEffect *v13; // rax
  unsigned int v14; // edx
  UFG::VehicleEffect *v15; // rax
  UFG::VehicleEffect *v16; // r14
  Render::FXOverride *v17; // rax
  Render::FXOverride *v18; // rdi
  unsigned int *v19; // rdi

  v3 = this;
  v4 = isMoving;
  v5 = this->mMoverComponent.m_pSimComponent[10].m_SafePointerList.mNode.mPrev;
  if ( v5 && !(BYTE4(v5[37].mNext) & 7) )
  {
    v6 = v3->mSprayEffects[0].mEffectState;
    v7 = 0;
    if ( v6 )
    {
      v8 = v6->mEffectRef;
      if ( v8 != -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v8, 0);
        Render::FXManager::KillEffect(&Render::gFXManager, v3->mSprayEffects[0].mDropletEffectRef, 0);
        v9 = v3->mSprayEffects[0].mEffectState;
        v3->mSprayEffects[0].mDropletEffectRef = -1;
        v9->mEffectRef = -1;
        v10 = v3->mSprayEffects[0].mEffectState;
        v11 = v10->mEffectOverride.m_pPointer;
        if ( v11 )
        {
          --v11->mReferenceCount;
          v12 = v10->mEffectOverride.m_pPointer;
          if ( v12->mReferenceCount <= 0 )
          {
            if ( v12 )
            {
              Render::FXOverride::~FXOverride(v10->mEffectOverride.m_pPointer);
              operator delete[](v12);
            }
            v10->mEffectOverride.m_pPointer = 0i64;
          }
          v10->mEffectOverride.m_pPointer = 0i64;
        }
        v3->mSprayEffects[0].mEffectState = 0i64;
      }
    }
    v13 = v3->mSprayEffects[1].mEffectState;
    if ( v13 )
    {
      v14 = v13->mEffectRef;
      if ( v14 != -1 )
      {
        Render::FXManager::KillEffect(&Render::gFXManager, v14, 0);
        Render::FXManager::KillEffect(&Render::gFXManager, v3->mSprayEffects[1].mDropletEffectRef, 0);
        v15 = v3->mSprayEffects[1].mEffectState;
        v3->mSprayEffects[1].mDropletEffectRef = -1;
        v15->mEffectRef = -1;
        v16 = v3->mSprayEffects[1].mEffectState;
        v17 = v16->mEffectOverride.m_pPointer;
        if ( v17 )
        {
          --v17->mReferenceCount;
          v18 = v16->mEffectOverride.m_pPointer;
          if ( v18->mReferenceCount <= 0 )
          {
            if ( v18 )
            {
              Render::FXOverride::~FXOverride(v16->mEffectOverride.m_pPointer);
              operator delete[](v18);
            }
            v16->mEffectOverride.m_pPointer = 0i64;
          }
          v16->mEffectOverride.m_pPointer = 0i64;
        }
        v3->mSprayEffects[1].mEffectState = 0i64;
      }
    }
    if ( v4 )
      UFG::VehicleEffectsComponent::TurnOnEffect_New(v3, FX_AILOWLODEXHAUST);
    else
      UFG::VehicleEffectsComponent::TurnOffEffect_New(v3, FX_AILOWLODEXHAUST);
    if ( v3->mNumWheels > 0 )
    {
      v19 = v3->mWetSurfaceEffect.array;
      do
      {
        if ( *v19 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, *v19, 0);
          *v19 = -1;
        }
        ++v7;
        ++v19;
      }
      while ( v7 < v3->mNumWheels );
    }
  }
}

// File Line: 2137
// RVA: 0x676BE0
void __fastcall UFG::VehicleEffectsComponent::DoRimAndBumperSparks(UFG::VehicleEffectsComponent *this, bool isMoving)
{
  bool v2; // bp
  UFG::VehicleEffectsComponent *v3; // rsi
  unsigned int v4; // edi
  unsigned int *v5; // rbx
  signed __int64 v6; // r14
  UFG::SimComponent *v7; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v8; // rax
  UFG::PhysicsWheeledVehicle *v9; // rcx
  char v10; // r8
  UFG::TransformNodeComponent *v11; // rax
  UFG::TransformNodeComponent *v12; // rax
  unsigned int v13; // edx

  v2 = isMoving;
  v3 = this;
  v4 = 0;
  if ( this->mNumWheels )
  {
    v5 = this->mRimSparksEffect.array;
    v6 = -1440i64 - (_QWORD)this;
    do
    {
      if ( !v2 )
        goto LABEL_25;
      v7 = v3->mMoverComponent.m_pSimComponent;
      if ( *(float *)((char *)&v7->vfptr + (_QWORD)v5 + v6) < 1.0 )
        goto LABEL_25;
      v8 = v7[10].m_SafePointerList.mNode.mPrev;
      if ( !v8 )
        goto LABEL_26;
      v9 = 0i64;
      if ( BYTE4(v8[37].mNext) & 7 )
        v9 = (UFG::PhysicsWheeledVehicle *)v8;
      if ( v9 && !UFG::PhysicsWheeledVehicle::IsWheelOnGround(v9, v4) )
LABEL_25:
        v10 = 0;
      else
LABEL_26:
        v10 = 1;
      v3->mDamageRig->mWheelModelBindingState[v4].mBlown = 1.0 <= *(float *)((char *)v5
                                                                           + v6
                                                                           + (unsigned __int64)v3->mMoverComponent.m_pSimComponent);
      if ( v10 )
      {
        if ( *v5 == -1 )
        {
          v11 = UFG::VehicleEffectsComponent::ObtainTransform(v3, v4 + 8);
          *v5 = Render::FXManager::CreateEffect(&Render::gFXManager, 0xB3802F87, v11, 0xFFFFFFFF, 0i64);
        }
        if ( v5[4] == -1 && *(v5 - 8) != -1 )
        {
          v12 = UFG::VehicleEffectsComponent::ObtainTransform(v3, v4 + 12);
          v5[4] = Render::FXManager::CreateEffect(&Render::gFXManager, 0x6E5A366Fu, v12, 0xFFFFFFFF, 0i64);
        }
      }
      else
      {
        if ( *v5 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, *v5, 0);
          *v5 = -1;
        }
        v13 = v5[4];
        if ( v13 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, v13, 0);
          v5[4] = -1;
        }
      }
      ++v4;
      ++v5;
    }
    while ( v4 < v3->mNumWheels );
  }
}

// File Line: 2170
// RVA: 0x677250
void __fastcall UFG::VehicleEffectsComponent::DoWetSurfaceEffects(UFG::VehicleEffectsComponent *this, bool playFXs)
{
  bool v2; // bp
  UFG::VehicleEffectsComponent *v3; // rsi
  unsigned int v4; // edi
  unsigned int *v5; // rbx
  signed __int64 v6; // r14
  UFG::SimComponent *v7; // rcx
  UFG::qNode<UFG::qSafePointerBase<UFG::SimComponent>,UFG::qSafePointerNodeList> *v8; // rax
  UFG::PhysicsWheeledVehicle *v9; // rcx
  UFG::TransformNodeComponent *v10; // rax

  v2 = playFXs;
  v3 = this;
  v4 = 0;
  if ( this->mNumWheels )
  {
    v5 = this->mWetSurfaceEffect.array;
    v6 = -1472i64 - (_QWORD)this;
    do
    {
      if ( v2 != 1 )
        goto LABEL_17;
      v7 = v3->mMoverComponent.m_pSimComponent;
      if ( *(float *)((char *)&v7->vfptr + (_QWORD)v5 + v6) >= 1.0 )
        goto LABEL_17;
      v8 = v7[10].m_SafePointerList.mNode.mPrev;
      if ( !v8 )
        goto LABEL_18;
      v9 = 0i64;
      if ( BYTE4(v8[37].mNext) & 7 )
        v9 = (UFG::PhysicsWheeledVehicle *)v8;
      if ( v9 && UFG::PhysicsWheeledVehicle::IsWheelOnGround(v9, v4) != 1 )
      {
LABEL_17:
        if ( *v5 != -1 )
        {
          Render::FXManager::KillEffect(&Render::gFXManager, *v5, 0);
          *v5 = -1;
        }
      }
      else
      {
LABEL_18:
        if ( *v5 == -1 )
        {
          v10 = UFG::VehicleEffectsComponent::ObtainTransform(v3, v4 + 8);
          *v5 = Render::FXManager::CreateEffect(&Render::gFXManager, 0x3245CF8Fu, v10, 0xFFFFFFFF, 0i64);
        }
      }
      ++v4;
      ++v5;
    }
    while ( v4 < v3->mNumWheels );
  }
}

// File Line: 2196
// RVA: 0x688440
void __fastcall UFG::VehicleEffectsComponent::QueueHeadlightFlashes(UFG::VehicleEffectsComponent *this, unsigned int numFlashes, float flashLength)
{
  this->mHeadlightFlashesLength = flashLength;
  this->mHeadlightFlashesTimer = 0.0;
  this->mNumQueuedHeadlightChanges = 2 * numFlashes;
}

// File Line: 2268
// RVA: 0x68C2D0
void __fastcall UFG::VehicleEffectsComponent::StartEffect(UFG::VehicleEffectsComponent *this, unsigned int *effect, unsigned int effect_id, unsigned int bone_id, UFG::qMatrix44 *offsetMatrix)
{
  Render::FXSimComponent *v5; // rcx

  v5 = (Render::FXSimComponent *)this->mFXComponent.m_pSimComponent;
  if ( v5 && bone_id != -1 && *effect == -1 )
  {
    if ( effect_id )
      *effect = Render::FXSimComponent::AttachEffect(v5, effect_id, bone_id, offsetMatrix);
  }
}

// File Line: 2289
// RVA: 0x686D80
void __fastcall UFG::VehicleEffectsComponent::PlayCollisionFX(UFG::VehicleEffectsComponent *this, UFG::Event *thisEvent, float magnitude)
{
  float v3; // xmm6_4
  UFG::Event *v4; // rdi
  UFG::VehicleEffectsComponent *v5; // rsi
  UFG::SimObjectGame *v6; // rbx
  float v7; // xmm8_4
  DamageRig *v8; // rcx
  unsigned __int16 v9; // cx
  UFG::SimComponent *v10; // r14
  UFG::SimComponent *v11; // rax
  UFG::PhysicsVehicle *v12; // rcx
  float v13; // xmm1_4
  __m128 v14; // xmm0
  float v15; // xmm2_4
  UFG::EventVtbl *v16; // rax
  __int64 v17; // rcx
  UFG::qReflectObjectType<UFG::PhysicsSurfaceProperties,UFG::qReflectObject> *v18; // rcx
  const char *v19; // rax
  unsigned __int64 v20; // r8
  UFG::qReflectObjectType<UFG::PhysicsObjectProperties,UFG::qReflectObject> *v21; // rcx
  const char *v22; // rax
  unsigned __int64 v23; // r8
  UFG::qReflectObject *v24; // rdx
  UFG::qReflectObjectType<UFG::PhysicsObjectProperties,UFG::qReflectObject> *v25; // rcx
  const char *v26; // rax
  unsigned __int64 v27; // r8
  unsigned int v28; // er10
  UFG::SimComponent *v29; // rax
  UFG::TransformNodeComponent *v30; // rbx
  UFG::qVector4 v31; // xmm3
  UFG::qVector4 v32; // xmm2
  __int128 v33; // xmm1
  float v34; // xmm0_4
  float v35; // xmm5_4
  float v36; // xmm2_4
  float v37; // xmm6_4
  UFG::qVector3 result; // [rsp+50h] [rbp-A8h]
  UFG::qReflectHandleBase v39; // [rsp+60h] [rbp-98h]
  float v40; // [rsp+88h] [rbp-70h]
  float v41; // [rsp+8Ch] [rbp-6Ch]
  float v42; // [rsp+90h] [rbp-68h]
  UFG::qReflectHandleBase v43; // [rsp+98h] [rbp-60h]
  __int128 v44; // [rsp+C8h] [rbp-30h]
  __int64 v45; // [rsp+D8h] [rbp-20h]

  v45 = -2i64;
  v3 = magnitude;
  v4 = thisEvent;
  v5 = this;
  if ( this->mLevelOfDetail != 3 || *(UFG::EventVtbl **)&thisEvent[2].m_EventUID == thisEvent[2].vfptr )
    return;
  v6 = (UFG::SimObjectGame *)this->m_pSimObject;
  v7 = *(float *)&FLOAT_1_0;
  if ( !(*((_BYTE *)this + 1884) & 2)
    && (unsigned int)UFG::VehicleUtility::GetVehicleOrientation((UFG::SimObjectVehicle *)this->m_pSimObject, 0, 0i64) == 5 )
  {
    v8 = v5->mDamageRig;
    if ( v8 )
    {
      DamageRig::SetAllDamageMarkers(v8, v5, 1.0, 1, 0);
      *((_DWORD *)v5 + 471) |= 2u;
    }
  }
  if ( v6 )
  {
    v9 = v6->m_Flags;
    if ( !((v9 >> 14) & 1) )
    {
      if ( (v9 & 0x8000u) == 0 )
      {
        if ( (v9 >> 13) & 1 )
          goto LABEL_26;
        if ( (v9 >> 12) & 1 )
          v11 = UFG::SimObjectGame::GetComponentOfTypeHK(v6, UFG::PhysicsMoverInterface::_TypeUID);
        else
          v11 = UFG::SimObject::GetComponentOfType((UFG::SimObject *)&v6->vfptr, UFG::PhysicsMoverInterface::_TypeUID);
        v10 = v11;
      }
      else
      {
        v10 = v6->m_Components.p[34].m_pComponent;
      }
      if ( v10 )
      {
        v12 = (UFG::PhysicsVehicle *)v10[10].m_SafePointerList.mNode.mPrev;
        if ( !v12 || (unsigned __int8)UFG::PhysicsVehicle::IsSuspended(v12) )
        {
          v15 = UFG::qVector3::msZero.x;
          v14 = (__m128)LODWORD(UFG::qVector3::msZero.y);
          v13 = UFG::qVector3::msZero.z;
        }
        else
        {
          UFG::PhysicsVehicle::GetVelocity((UFG::PhysicsVehicle *)v10[10].m_SafePointerList.mNode.mPrev, &result);
          v13 = result.z;
          v14 = (__m128)LODWORD(result.y);
          v15 = result.x;
        }
        v14.m128_f32[0] = (float)((float)(v14.m128_f32[0] * v14.m128_f32[0]) + (float)(v15 * v15)) + (float)(v13 * v13);
        if ( COERCE_FLOAT(_mm_sqrt_ps(v14)) < 0.5 )
        {
          v16 = v4[2].vfptr;
          v17 = *(_QWORD *)&v4[2].m_EventUID;
          if ( v16 )
          {
            if ( (WORD2(v16[9].__vecDelDtor) >> 14) & 1 )
              return;
          }
          if ( v17 && (*(_WORD *)(v17 + 76) >> 14) & 1 )
            return;
        }
      }
    }
  }
LABEL_26:
  if ( v3 > 5.0 )
  {
    UFG::qReflectHandleBase::qReflectHandleBase(&v43);
    v19 = UFG::qReflectObjectType<UFG::PhysicsSurfaceProperties,UFG::qReflectObject>::GetTypeName(v18);
    v43.mTypeUID = UFG::qStringHash64(v19, 0xFFFFFFFFFFFFFFFFui64);
    if ( (UFG::SimObjectGame *)v4[2].vfptr == v6 )
    {
      v20 = v4[3].mUserData1;
      if ( !v20 )
      {
        UFG::qReflectHandleBase::qReflectHandleBase(&v39);
        v26 = UFG::qReflectObjectType<UFG::PhysicsObjectProperties,UFG::qReflectObject>::GetTypeName(v25);
        v39.mTypeUID = UFG::qStringHash64(v26, 0xFFFFFFFFFFFFFFFFui64);
        UFG::qReflectHandleBase::Init(&v39, v39.mTypeUID, (unsigned __int64)v4[3].m_NamePTR);
        v27 = v39.mNameUID;
        if ( !v39.mNameUID )
        {
          UFG::PhysicsPropertyManager::GetDefaultObjectProperties((UFG::qReflectHandle<UFG::PhysicsObjectProperties> *)&v39);
          v27 = v39.mNameUID;
        }
        UFG::qReflectHandleBase::Init(&v43, v43.mTypeUID, *(_QWORD *)(v27 + 320));
        if ( !v43.mData )
          UFG::PhysicsPropertyManager::GetDefaultSurfaceProperties((UFG::qReflectHandle<UFG::PhysicsSurfaceProperties> *)&v43);
        goto LABEL_41;
      }
    }
    else
    {
      v20 = v4[3].mUserData0;
      if ( !v20 )
      {
        UFG::qReflectHandleBase::qReflectHandleBase(&v39);
        v22 = UFG::qReflectObjectType<UFG::PhysicsObjectProperties,UFG::qReflectObject>::GetTypeName(v21);
        v39.mTypeUID = UFG::qStringHash64(v22, 0xFFFFFFFFFFFFFFFFui64);
        UFG::qReflectHandleBase::Init(&v39, v39.mTypeUID, *(_QWORD *)&v4[3].m_EventUID);
        v23 = v39.mNameUID;
        if ( !v39.mNameUID )
        {
          UFG::PhysicsPropertyManager::GetDefaultObjectProperties((UFG::qReflectHandle<UFG::PhysicsObjectProperties> *)&v39);
          v23 = v39.mNameUID;
        }
        UFG::qReflectHandleBase::Init(&v43, v43.mTypeUID, *(_QWORD *)(v23 + 320));
        if ( !v43.mData )
          UFG::PhysicsPropertyManager::GetDefaultSurfaceProperties((UFG::qReflectHandle<UFG::PhysicsSurfaceProperties> *)&v43);
LABEL_41:
        UFG::qReflectHandleBase::~qReflectHandleBase(&v39);
        goto LABEL_42;
      }
    }
    UFG::qReflectHandleBase::Init(&v43, v43.mTypeUID, v20);
    v24 = v43.mData;
    if ( v43.mData )
      goto LABEL_43;
    UFG::PhysicsPropertyManager::GetDefaultSurfaceProperties((UFG::qReflectHandle<UFG::PhysicsSurfaceProperties> *)&v43);
LABEL_42:
    v24 = v43.mData;
    if ( !v43.mData )
    {
LABEL_47:
      UFG::qReflectHandleBase::~qReflectHandleBase(&v43);
      goto LABEL_48;
    }
LABEL_43:
    v28 = -1721903414;
    v29 = v5->mMoverComponent.m_pSimComponent;
    if ( v29 && BYTE4(v29[14].vfptr) & 8 )
      v28 = -875922004;
    Render::ImpactManager::HandleImpactEvent(
      &Render::gImpactManager,
      v28,
      HIDWORD(v24[1].mBaseNode.mChildren[0]),
      (UFG::qVector3 *)((char *)&v4[1].vfptr + 4),
      (UFG::qVector3 *)&v4[1].mNext,
      (UFG::qVector3 *)&v4[1].mNext,
      (Render::FXSimComponent *)v5->mFXComponent.m_pSimComponent,
      0,
      0i64);
    goto LABEL_47;
  }
LABEL_48:
  if ( COERCE_FLOAT(*(&v4[1].m_EventUID + 1) & _xmm) > 10.0 && v5->mDamageRig )
  {
    v30 = v5->m_pSimObject->m_pTransformNodeComponent;
    UFG::TransformNodeComponent::UpdateWorldTransform(v30);
    v31 = v30->mWorldTransform.v1;
    v32 = v30->mWorldTransform.v2;
    v33 = (__int128)v30->mWorldTransform.v3;
    v43.0 = (UFG::qNode<UFG::qReflectHandleBase,UFG::qReflectHandleBase>)v30->mWorldTransform.v0;
    *(UFG::qVector4 *)&v43.mTypeUID = v31;
    *(UFG::qVector4 *)&v43.mData = v32;
    v44 = v33;
    UFG::qInverseAffine((UFG::qMatrix44 *)&v39, (UFG::qMatrix44 *)&v43);
    v34 = COERCE_FLOAT(*(&v4[1].m_EventUID + 1) & _xmm) * 0.25;
    if ( v34 <= 0.0 )
    {
      v34 = 0.0;
    }
    else if ( v34 >= 1.0 )
    {
LABEL_55:
      v35 = *((float *)&v4[1].vfptr + 1);
      v36 = *(float *)&v4[1].mPrev;
      v37 = *((float *)&v4[1].mPrev + 1);
      result.x = (float)((float)((float)(*(float *)&v39.mTypeUID * v36) + (float)(*(float *)&v39.mPrev * v35))
                       + (float)(*(float *)&v39.mNameUID * v37))
               + v40;
      result.y = (float)((float)((float)(*((float *)&v39.mTypeUID + 1) * v36) + (float)(*((float *)&v39.mPrev + 1) * v35))
                       + (float)(*((float *)&v39.mNameUID + 1) * v37))
               + v41;
      result.z = (float)((float)((float)(*(float *)&v39.mNameUID * v36) + (float)(*(float *)&v39.mNext * v35))
                       + (float)(*(float *)&v39.mData * v37))
               + v42;
      if ( v7 > 0.0 )
        DamageRig::ApplyDamageForce(v5->mDamageRig, &result, v7, *(const float *)&v4[1].m_NamePTR, v5);
      return;
    }
    v7 = v34;
    goto LABEL_55;
  }
}

// File Line: 2433
// RVA: 0x681B80
void __fastcall UFG::VehicleEffectsComponent::MeleeBasedDamage(UFG::VehicleEffectsComponent *this, UFG::qVector3 *position, float speed, float magnitude)
{
  UFG::qVector3 *v4; // rsi
  float v5; // xmm8_4
  UFG::VehicleEffectsComponent *vehicle; // rdi
  UFG::TransformNodeComponent *v7; // rbx
  UFG::qVector4 v8; // xmm2
  UFG::qVector4 v9; // xmm1
  UFG::qVector4 v10; // xmm0
  float v11; // xmm8_4
  float v12; // xmm4_4
  float v13; // xmm5_4
  float v14; // xmm3_4
  float v15; // xmm2_4
  UFG::qVector3 force_position; // [rsp+30h] [rbp-B8h]
  UFG::qMatrix44 d; // [rsp+40h] [rbp-A8h]
  UFG::qMatrix44 m; // [rsp+80h] [rbp-68h]

  v4 = position;
  v5 = speed;
  vehicle = this;
  if ( this->mLevelOfDetail == 3 && this->mDamageRig )
  {
    v7 = this->m_pSimObject->m_pTransformNodeComponent;
    UFG::TransformNodeComponent::UpdateWorldTransform(v7);
    v8 = v7->mWorldTransform.v2;
    v9 = v7->mWorldTransform.v3;
    v10 = v7->mWorldTransform.v0;
    m.v1 = v7->mWorldTransform.v1;
    m.v2 = v8;
    m.v0 = v10;
    m.v3 = v9;
    UFG::qInverseAffine(&d, &m);
    v11 = COERCE_FLOAT(LODWORD(v5) & _xmm) * 0.25;
    v12 = v4->x;
    v13 = v4->y;
    v9.x = d.v2.z * v4->z;
    v14 = (float)((float)((float)(d.v0.y * v4->x) + (float)(d.v1.y * v13)) + (float)(d.v2.y * v4->z)) + d.v3.y;
    force_position.x = (float)((float)((float)(d.v0.x * v4->x) + (float)(d.v1.x * v13)) + (float)(d.v2.x * v4->z))
                     + d.v3.x;
    force_position.y = v14;
    force_position.z = (float)((float)((float)(d.v0.z * v12) + (float)(d.v1.z * v13)) + v9.x) + d.v3.z;
    if ( v11 <= 0.0 )
    {
      v11 = 0.0;
    }
    else
    {
      v15 = *(float *)&FLOAT_1_0;
      if ( v11 >= 1.0 )
      {
LABEL_8:
        DamageRig::ApplyDamageForce(vehicle->mDamageRig, &force_position, v15, 5.0, vehicle);
        ++vehicle->mVandalizedDamage;
        return;
      }
    }
    v15 = v11;
    if ( v11 <= 0.0 )
      return;
    goto LABEL_8;
  }
}

// File Line: 2463
// RVA: 0x67EF90
bool __fastcall UFG::VehicleEffectsComponent::IsGlassBroken(UFG::VehicleEffectsComponent *this, UFG::eVehicleWindowTypeEnum eWindow)
{
  unsigned int v2; // edx
  DamageRig *v3; // rcx
  float health_output; // [rsp+30h] [rbp+8h]

  if ( this->mLevelOfDetail != 3 )
    return 0;
  switch ( eWindow )
  {
    case 1:
      v2 = 0xE922CA23;
      break;
    case 2:
      v2 = -1352122595;
      break;
    case 3:
      v2 = -1714731334;
      break;
    case 4:
      v2 = 133101843;
      break;
    case 5:
      v2 = 275955273;
      break;
    default:
      v2 = -98124545;
      break;
  }
  v3 = this->mDamageRig;
  if ( !v3 )
    return 0;
  health_output = 0.0;
  DamageRig::GetTriggerMarkerHealth(v3, v2, &health_output);
  return health_output >= 0.66000003;
}

// File Line: 2523
// RVA: 0x67EDB0
bool __fastcall UFG::VehicleEffectsComponent::IsGlassBroken(UFG::VehicleEffectsComponent *this, UFG::qVector3 *position)
{
  bool v2; // zf
  UFG::qVector3 *v3; // rsi
  UFG::VehicleEffectsComponent *v4; // rdi
  UFG::SimObjectCVBase *v5; // rcx
  unsigned __int16 v6; // r8
  UFG::CharacterAnimationComponent *v7; // rax
  UFG::TransformNodeComponent *v8; // rbx
  UFG::qVector4 v9; // xmm2
  UFG::qVector4 v10; // xmm1
  UFG::qVector4 v11; // xmm0
  DamageRig *v12; // rcx
  float v13; // xmm4_4
  float v14; // xmm5_4
  float v15; // xmm3_4
  UFG::qVector3 positiona; // [rsp+20h] [rbp-49h]
  UFG::qMatrix44 d; // [rsp+30h] [rbp-39h]
  UFG::qMatrix44 m; // [rsp+70h] [rbp+7h]
  float health_output; // [rsp+D0h] [rbp+67h]

  v2 = this->mLevelOfDetail == 3;
  v3 = position;
  v4 = this;
  health_output = 0.0;
  if ( v2 )
  {
    v5 = (UFG::SimObjectCVBase *)this->m_pSimObject;
    if ( v5 )
    {
      v6 = v5->m_Flags;
      if ( (v6 >> 14) & 1 )
      {
        v7 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v5);
      }
      else if ( (v6 & 0x8000u) == 0 )
      {
        if ( (v6 >> 13) & 1 )
        {
          v7 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v5);
        }
        else if ( (v6 >> 12) & 1 )
        {
          v7 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                     (UFG::SimObjectGame *)&v5->vfptr,
                                                     UFG::CharacterAnimationComponent::_TypeUID);
        }
        else
        {
          v7 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                     (UFG::SimObject *)&v5->vfptr,
                                                     UFG::CharacterAnimationComponent::_TypeUID);
        }
      }
      else
      {
        v7 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v5);
      }
      if ( v7 )
      {
        v8 = v4->m_pSimObject->m_pTransformNodeComponent;
        UFG::TransformNodeComponent::UpdateWorldTransform(v8);
        v9 = v8->mWorldTransform.v2;
        v10 = v8->mWorldTransform.v3;
        v11 = v8->mWorldTransform.v0;
        m.v1 = v8->mWorldTransform.v1;
        m.v2 = v9;
        m.v0 = v11;
        m.v3 = v10;
        UFG::qInverseAffine(&d, &m);
        v12 = v4->mDamageRig;
        v13 = v3->x;
        v14 = v3->y;
        v10.x = d.v2.z * v3->z;
        v15 = (float)((float)((float)(d.v0.y * v3->x) + (float)(d.v1.y * v14)) + (float)(d.v2.y * v3->z)) + d.v3.y;
        positiona.x = (float)((float)((float)(d.v0.x * v3->x) + (float)(d.v1.x * v14)) + (float)(d.v2.x * v3->z))
                    + d.v3.x;
        positiona.y = v15;
        positiona.z = (float)((float)((float)(d.v0.z * v13) + (float)(d.v1.z * v14)) + v10.x) + d.v3.z;
        if ( v12 )
          DamageRig::GetTriggerMarkerHealth(v12, &positiona, &health_output);
      }
    }
  }
  return health_output >= 0.66000003;
}

// File Line: 2550
// RVA: 0x673AE0
void __fastcall UFG::VehicleEffectsComponent::BreakGlass(UFG::VehicleEffectsComponent *this, UFG::eVehicleWindowTypeEnum eWindow)
{
  unsigned int v2; // edx

  switch ( eWindow )
  {
    case 1:
      v2 = -383595997;
      break;
    case 2:
      v2 = -1352122595;
      break;
    case 3:
      v2 = -1714731334;
      break;
    case 4:
      v2 = 133101843;
      break;
    case 5:
      v2 = 275955273;
      break;
    default:
      v2 = -98124545;
      break;
  }
  if ( this->mDamageRig )
    DamageRig::ActivateTriggerMarker(this->mDamageRig, v2, this, this->mLevelOfDetail == 3);
}

// File Line: 2604
// RVA: 0x673900
void __fastcall UFG::VehicleEffectsComponent::BreakGlass(UFG::VehicleEffectsComponent *this, UFG::qVector3 *position)
{
  UFG::VehicleEffectsComponent *v2; // rdi
  UFG::SimObjectCVBase *v3; // rcx
  UFG::qVector3 *v4; // rsi
  unsigned __int16 v5; // r8
  UFG::CharacterAnimationComponent *v6; // rax
  UFG::TransformNodeComponent *v7; // rbx
  UFG::qVector4 v8; // xmm2
  UFG::qVector4 v9; // xmm1
  UFG::qVector4 v10; // xmm0
  DamageRig *v11; // rcx
  float v12; // xmm4_4
  float v13; // xmm5_4
  float v14; // xmm3_4
  UFG::qVector3 positiona; // [rsp+20h] [rbp-A8h]
  UFG::qMatrix44 d; // [rsp+30h] [rbp-98h]
  UFG::qMatrix44 m; // [rsp+70h] [rbp-58h]

  v2 = this;
  v3 = (UFG::SimObjectCVBase *)this->m_pSimObject;
  v4 = position;
  if ( v3 )
  {
    v5 = v3->m_Flags;
    if ( (v5 >> 14) & 1 )
    {
      v6 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v3);
    }
    else if ( (v5 & 0x8000u) == 0 )
    {
      if ( (v5 >> 13) & 1 )
      {
        v6 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v3);
      }
      else if ( (v5 >> 12) & 1 )
      {
        v6 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                   (UFG::SimObjectGame *)&v3->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
      else
      {
        v6 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                   (UFG::SimObject *)&v3->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
    }
    else
    {
      v6 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v3);
    }
    if ( v6 )
    {
      v7 = v2->m_pSimObject->m_pTransformNodeComponent;
      UFG::TransformNodeComponent::UpdateWorldTransform(v7);
      v8 = v7->mWorldTransform.v2;
      v9 = v7->mWorldTransform.v3;
      v10 = v7->mWorldTransform.v0;
      m.v1 = v7->mWorldTransform.v1;
      m.v2 = v8;
      m.v0 = v10;
      m.v3 = v9;
      UFG::qInverseAffine(&d, &m);
      v11 = v2->mDamageRig;
      v12 = v4->x;
      v13 = v4->y;
      v9.x = d.v2.z * v4->z;
      v14 = (float)((float)((float)(d.v0.y * v4->x) + (float)(d.v1.y * v13)) + (float)(d.v2.y * v4->z)) + d.v3.y;
      positiona.x = (float)((float)((float)(d.v0.x * v4->x) + (float)(d.v1.x * v13)) + (float)(d.v2.x * v4->z)) + d.v3.x;
      positiona.y = v14;
      positiona.z = (float)((float)((float)(d.v0.z * v12) + (float)(d.v1.z * v13)) + v9.x) + d.v3.z;
      if ( v11 )
        DamageRig::ActivateTriggerMarker(v11, &positiona, v2, v2->mLevelOfDetail == 3);
    }
  }
}

// File Line: 2627
// RVA: 0x675F30
void __fastcall UFG::VehicleEffectsComponent::DamageGlass(UFG::VehicleEffectsComponent *this, UFG::qVector3 *position)
{
  UFG::VehicleEffectsComponent *v2; // rbx
  UFG::SimObjectCVBase *v3; // rcx
  UFG::qVector3 *v4; // rdi
  unsigned __int16 v5; // r8
  UFG::CharacterAnimationComponent *v6; // rax
  UFG::TransformNodeComponent *v7; // rcx
  UFG::qVector4 v8; // xmm2
  UFG::qVector4 v9; // xmm1
  UFG::qVector4 v10; // xmm0
  DamageRig *v11; // rcx
  float v12; // xmm4_4
  float v13; // xmm5_4
  float v14; // xmm3_4
  UFG::qVector3 positiona; // [rsp+30h] [rbp-49h]
  UFG::qMatrix44 d; // [rsp+40h] [rbp-39h]
  UFG::qMatrix44 m; // [rsp+80h] [rbp+7h]
  unsigned int index; // [rsp+E0h] [rbp+67h]

  v2 = this;
  v3 = (UFG::SimObjectCVBase *)this->m_pSimObject;
  v4 = position;
  if ( v3 )
  {
    v5 = v3->m_Flags;
    if ( (v5 >> 14) & 1 )
    {
      v6 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v3);
    }
    else if ( (v5 & 0x8000u) == 0 )
    {
      if ( (v5 >> 13) & 1 )
      {
        v6 = UFG::SimObjectProp::GetComponent<UFG::CharacterAnimationComponent>((UFG::SimObjectProp *)v3);
      }
      else if ( (v5 >> 12) & 1 )
      {
        v6 = (UFG::CharacterAnimationComponent *)UFG::SimObjectGame::GetComponentOfTypeHK(
                                                   (UFG::SimObjectGame *)&v3->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
      else
      {
        v6 = (UFG::CharacterAnimationComponent *)UFG::SimObject::GetComponentOfType(
                                                   (UFG::SimObject *)&v3->vfptr,
                                                   UFG::CharacterAnimationComponent::_TypeUID);
      }
    }
    else
    {
      v6 = UFG::SimObjectCVBase::GetComponent<UFG::CharacterAnimationComponent>(v3);
    }
    if ( v6 )
    {
      v7 = v2->m_pSimObject->m_pTransformNodeComponent;
      v8 = v7->mLocalTransform.v2;
      v9 = v7->mLocalTransform.v3;
      v10 = v7->mLocalTransform.v0;
      m.v1 = v7->mLocalTransform.v1;
      m.v2 = v8;
      m.v0 = v10;
      m.v3 = v9;
      UFG::qInverseAffine(&d, &m);
      v11 = v2->mDamageRig;
      v12 = v4->x;
      v13 = v4->y;
      v9.x = d.v2.z * v4->z;
      v14 = (float)((float)((float)(d.v0.y * v4->x) + (float)(d.v1.y * v13)) + (float)(d.v2.y * v4->z)) + d.v3.y;
      positiona.x = (float)((float)((float)(d.v0.x * v4->x) + (float)(d.v1.x * v13)) + (float)(d.v2.x * v4->z)) + d.v3.x;
      positiona.y = v14;
      positiona.z = (float)((float)((float)(d.v0.z * v12) + (float)(d.v1.z * v13)) + v9.x) + d.v3.z;
      if ( v11 )
      {
        if ( DamageRig::GetTriggerMarkerIndex(v11, &positiona, &index) == 1 )
          DamageRig::ApplyTriggerMarkerDamageByIndex(v2->mDamageRig, index, 0.34999999, v2, v2->mLevelOfDetail == 3);
      }
    }
  }
}

// File Line: 2660
// RVA: 0x673B60
void __fastcall UFG::VehicleEffectsComponent::BreakGlassFX(UFG::VehicleEffectsComponent *this, const unsigned int damageBoneID, const float magnitude)
{
  unsigned int v3; // er8
  UFG::VehicleEffectId v4; // edx

  v3 = damageBoneID;
  if ( magnitude >= 0.2 )
  {
    v4 = 31;
    if ( magnitude >= 0.30000001 )
      v4 = 32;
    UFG::VehicleEffectsComponent::TurnOnGenericEffectByDamageBoneID(this, v4, v3);
  }
  else
  {
    UFG::VehicleEffectsComponent::TurnOnGenericEffectByDamageBoneID(this, FX_WINDOWBREAKSM, damageBoneID);
  }
}

// File Line: 2678
// RVA: 0x68BC90
void __fastcall UFG::VehicleEffectsComponent::ShatterGlassFX(UFG::VehicleEffectsComponent *this, const unsigned int damageBoneID)
{
  UFG::VehicleEffectsComponent::TurnOnGenericEffectByDamageBoneID(this, FX_WINDOWSHATTER, damageBoneID);
}

// File Line: 2683
// RVA: 0x68E590
void __fastcall UFG::VehicleEffectsComponent::TurnOnFire(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rdi
  UFG::SimObjectGame *v2; // rcx
  unsigned __int16 v3; // dx
  UFG::SimComponent *v4; // rax
  UFG::WaterFloatingTrackerComponent *v5; // rbx
  UFG::VehicleEffectId *v6; // rbx
  signed __int64 v7; // rsi

  v1 = this;
  v2 = (UFG::SimObjectGame *)this->m_pSimObject;
  if ( !v2 )
    goto LABEL_15;
  v3 = v2->m_Flags;
  if ( (v3 >> 14) & 1 )
  {
    v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
LABEL_11:
    v5 = (UFG::WaterFloatingTrackerComponent *)v4;
    goto LABEL_12;
  }
  if ( (v3 & 0x8000u) == 0 )
  {
    if ( (v3 >> 13) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else if ( (v3 >> 12) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else
    {
      v4 = UFG::SimObject::GetComponentOfType(
             (UFG::SimObject *)&v2->vfptr,
             UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    goto LABEL_11;
  }
  v5 = (UFG::WaterFloatingTrackerComponent *)v2->m_Components.p[35].m_pComponent;
LABEL_12:
  if ( !v5
    || !UFG::WaterFloatingTrackerComponent::IsInWater(v5)
    || !UFG::WaterFloatingTrackerComponent::IsSubmerged(v5, 0.25) )
  {
LABEL_15:
    v6 = sDestructStates;
    v7 = 3i64;
    do
    {
      UFG::VehicleEffectsComponent::TurnOnEffect_New(v1, *v6);
      ++v6;
      --v7;
    }
    while ( v7 );
    *((_DWORD *)v1 + 471) |= 1u;
    v1->mExtinguishFireCountdown = 10.0;
  }
}

// File Line: 2698
// RVA: 0x68DB50
void __fastcall UFG::VehicleEffectsComponent::TurnOffFire(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rsi
  UFG::VehicleEffectId *v2; // r14
  signed __int64 v3; // r12
  __int64 v4; // rdx
  signed __int64 v5; // rbp
  signed __int64 v6; // r15
  UFG::qBaseTreeRB *i; // rbx
  Render::FXSimComponent *v8; // rcx
  unsigned int v9; // edx
  UFG::qBaseNodeRB *v10; // rax
  UFG::qBaseNodeRB *v11; // rdi
  UFG::SimComponent *v12; // rax
  UFG::PhysicsVehicle *v13; // rcx

  v1 = this;
  v2 = sDestructStates;
  v3 = 3i64;
  do
  {
    v4 = *(signed int *)v2;
    v5 = (signed __int64)v1 + 24 * v4;
    if ( *(_DWORD *)(v5 + 184) == 3 )
    {
      *(_DWORD *)(v5 + 184) = 4;
      v6 = (signed __int64)v1 + 24 * (v4 + 8);
      for ( i = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&(&v1->vfptr)[3 * (v4 + 8)][5]);
            i;
            i = UFG::qBaseTreeRB::GetNext((UFG::qBaseTreeRB *)(*(_QWORD *)v6 + 40i64), &i->mRoot) )
      {
        v8 = (Render::FXSimComponent *)v1->mFXComponent.m_pSimComponent;
        if ( v8 )
        {
          v9 = i[1].mRoot.mUID;
          if ( v9 != -1 )
          {
            Render::FXSimComponent::DetachEffect(v8, v9, 0);
            i[1].mRoot.mUID = -1;
          }
        }
        i[1].mRoot.mUID = -1;
        v10 = i[1].mNULL.mParent;
        if ( v10 )
        {
          --LODWORD(v10->mParent);
          v11 = i[1].mNULL.mParent;
          if ( SLODWORD(v11->mParent) <= 0 )
          {
            if ( v11 )
            {
              Render::FXOverride::~FXOverride((Render::FXOverride *)i[1].mNULL.mParent);
              operator delete[](v11);
            }
            i[1].mNULL.mParent = 0i64;
          }
          i[1].mNULL.mParent = 0i64;
        }
      }
    }
    if ( *(_DWORD *)(v5 + 184) == 1 )
      *(_DWORD *)(v5 + 184) = 0;
    *(_DWORD *)(v5 + 200) &= 0xFFFFFFFE;
    ++v2;
    --v3;
  }
  while ( v3 );
  v12 = v1->mMoverComponent.m_pSimComponent;
  if ( v12 )
  {
    v13 = (UFG::PhysicsVehicle *)v12[10].m_SafePointerList.mNode.mPrev;
    if ( v13 )
      UFG::PhysicsVehicle::DeactivateVolume(v13);
  }
  *((_DWORD *)v1 + 471) &= 0xFFFFFFFE;
}

// File Line: 2720
// RVA: 0x68E0B0
void __fastcall UFG::VehicleEffectsComponent::TurnOnDestroyedEffect(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rdi
  UFG::SimObjectGame *v2; // rcx
  unsigned __int16 v3; // dx
  UFG::SimComponent *v4; // rax
  UFG::WaterFloatingTrackerComponent *v5; // rbx
  DamageRig *v6; // rax

  v1 = this;
  v2 = (UFG::SimObjectGame *)this->m_pSimObject;
  if ( !v2 )
    goto LABEL_15;
  v3 = v2->m_Flags;
  if ( (v3 >> 14) & 1 )
  {
    v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
LABEL_11:
    v5 = (UFG::WaterFloatingTrackerComponent *)v4;
    goto LABEL_12;
  }
  if ( (v3 & 0x8000u) == 0 )
  {
    if ( (v3 >> 13) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else if ( (v3 >> 12) & 1 )
    {
      v4 = UFG::SimObjectGame::GetComponentOfTypeHK(v2, UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    else
    {
      v4 = UFG::SimObject::GetComponentOfType(
             (UFG::SimObject *)&v2->vfptr,
             UFG::WaterFloatingTrackerComponent::_TypeUID);
    }
    goto LABEL_11;
  }
  v5 = (UFG::WaterFloatingTrackerComponent *)v2->m_Components.p[35].m_pComponent;
LABEL_12:
  if ( !v5
    || !UFG::WaterFloatingTrackerComponent::IsInWater(v5)
    || !UFG::WaterFloatingTrackerComponent::IsSubmerged(v5, 0.64999998) )
  {
LABEL_15:
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_PLAYERHEADLIGHTS);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_TRAFFICHEADLIGHTS);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, 0);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_BRAKELIGHTS);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_REVERSE);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_LEFTTURN);
    UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_RIGHTTURN);
    UFG::VehicleEffectsComponent::TurnOffEffects(v1, 1);
    UFG::VehicleEffectsComponent::TurnOnEffect_New(v1, FX_DESTROYEDVEHICLE);
    UFG::VehicleEffectsComponent::TurnOnFire(v1);
    v6 = v1->mDamageRig;
    if ( v6 )
    {
      v6->mBurnedOut = 1;
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0xECBE6F49, v1, 1);
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0x1533EA92u, v1, 1);
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0x2AFADC8u, v1, 1);
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0xE1FD4990, v1, 1);
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0x1870CC4Bu, v1, 1);
      DamageRig::ActivateTriggerMarker(v1->mDamageRig, 0xFEC8B11u, v1, 1);
    }
  }
}

// File Line: 2770
// RVA: 0x68EB30
void __fastcall UFG::VehicleEffectsComponent::TurnOnScriptedLights(UFG::VehicleEffectsComponent *this)
{
  *((_DWORD *)this + 0x1D7) |= 0x10u;
}

// File Line: 2777
// RVA: 0x68DFF0
void __fastcall UFG::VehicleEffectsComponent::TurnOffScriptedLights(UFG::VehicleEffectsComponent *this)
{
  *((_DWORD *)this + 471) &= 0xFFFFFFEF;
}

// File Line: 2784
// RVA: 0x68EC60
void __fastcall UFG::VehicleEffectsComponent::TurnOnTaxiLight(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOnEffect_New(this, FX_TAXILIGHTS);
}

// File Line: 2791
// RVA: 0x68E000
void __fastcall UFG::VehicleEffectsComponent::TurnOffTaxiLight(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_TAXILIGHTS);
}

// File Line: 2798
// RVA: 0x68E840
void __fastcall UFG::VehicleEffectsComponent::TurnOnInteriorLight(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOnEffect_New(this, FX_INTERIORLIGHTS);
}

// File Line: 2805
// RVA: 0x68DD10
void __fastcall UFG::VehicleEffectsComponent::TurnOffInteriorLight(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_INTERIORLIGHTS);
}

// File Line: 2812
// RVA: 0x68E770
void __fastcall UFG::VehicleEffectsComponent::TurnOnHeadlights(UFG::VehicleEffectsComponent *this, bool isNightTime)
{
  bool v2; // di
  UFG::VehicleEffectsComponent *v3; // rbx
  UFG::SimComponent *v4; // rcx

  v2 = isNightTime;
  v3 = this;
  UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_DAYTIME);
  v4 = v3->mVehicleDriverComponent.m_pSimComponent;
  if ( v4 && ((unsigned __int8 (*)(void))v4->vfptr[15].__vecDelDtor)() )
  {
    if ( v2 )
    {
      UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, FX_PLAYERHEADLIGHTS);
      UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, 0);
    }
    else
    {
      UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, FX_PLAYERHEADLIGHTS);
      UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, 0);
    }
    UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, FX_PLAYERHEADLIGHTFLARES);
  }
  else
  {
    if ( v2 )
    {
      UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, FX_TRAFFICHEADLIGHTS);
      UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, 0);
    }
    else
    {
      UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, FX_TRAFFICHEADLIGHTS);
      UFG::VehicleEffectsComponent::TurnOffLightEffects(v3, 0);
    }
    UFG::VehicleEffectsComponent::TurnOnLightEffects(v3, FX_TRAFFICHEADLIGHTFLARES);
  }
}

// File Line: 2840
// RVA: 0x68DCA0
void __fastcall UFG::VehicleEffectsComponent::TurnOffHeadlights(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx

  v1 = this;
  UFG::VehicleEffectsComponent::TurnOffLightEffects(this, FX_PLAYERHEADLIGHTS);
  UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_PLAYERHEADLIGHTFLARES);
  UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_TRAFFICHEADLIGHTS);
  UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, FX_TRAFFICHEADLIGHTFLARES);
  UFG::VehicleEffectsComponent::TurnOffLightEffects(v1, 0);
  if ( v1->mVehicleDriverComponent.m_pSimComponent )
    UFG::VehicleEffectsComponent::TurnOnEffect_New(v1, FX_DAYTIME);
}

// File Line: 2871
// RVA: 0x68E010
void __fastcall UFG::VehicleEffectsComponent::TurnOnBrakelights(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOnLightEffects(this, FX_BRAKELIGHTS);
}

// File Line: 2878
// RVA: 0x68D7E0
void __fastcall UFG::VehicleEffectsComponent::TurnOffBrakelights(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent::TurnOffLightEffects(this, FX_BRAKELIGHTS);
}

// File Line: 2900
// RVA: 0x670870
bool __fastcall UFG::VehicleEffectsComponent::AreCopLightsOn(UFG::VehicleEffectsComponent *this)
{
  return this->mEffectStatusTable[7].mState == 3;
}

// File Line: 2907
// RVA: 0x68E020
void __fastcall UFG::VehicleEffectsComponent::TurnOnCopLights(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx
  UFG::SimObject *v2; // r9
  UFG::StimulusParameters stimulus_parameters; // [rsp+20h] [rbp-28h]

  v1 = this;
  if ( this->mEffectStatusTable[FX_COPHEADLIGHTS].mState != 3 )
  {
    UFG::VehicleEffectsComponent::TurnOnEffect_New(this, FX_COPHEADLIGHTS);
    v2 = v1->m_pSimObject;
    stimulus_parameters.m_StimulusProducerOffset = UFG::qVector3::msZero;
    stimulus_parameters.m_MaxStimulusDuration = -1.0;
    stimulus_parameters.m_EmitUntilSpeedLessThan = -1.0;
    stimulus_parameters.m_StimulusEmissionType = 1;
    UFG::StimulusManager::BeginStimulus(
      UFG::StimulusManager::s_pInstance,
      eSTIMULUS_POLICE_PURSUIT_VEHICLE,
      &stimulus_parameters,
      v2);
    UFG::VehicleEffectsComponent::TurnOffHeadlights(v1);
  }
}

// File Line: 2925
// RVA: 0x68D7F0
void __fastcall UFG::VehicleEffectsComponent::TurnOffCopLights(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx

  v1 = this;
  if ( this->mEffectStatusTable[7].mState == 3 )
  {
    UFG::VehicleEffectsComponent::TurnOffHeadlights(this);
    UFG::VehicleEffectsComponent::TurnOffEffect_New(v1, FX_COPHEADLIGHTS);
    UFG::StimulusManager::EndStimulus(
      UFG::StimulusManager::s_pInstance,
      eSTIMULUS_POLICE_PURSUIT_VEHICLE,
      v1->m_pSimObject);
  }
}

// File Line: 2939
// RVA: 0x68E500
void __fastcall UFG::VehicleEffectsComponent::TurnOnExhaust(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx
  UFG::SimComponent *v2; // rcx
  bool v3; // cl
  UFG::VehicleEffectId v4; // edx
  UFG::VehicleEffectId v5; // edx

  v1 = this;
  if ( this->mLevelOfDetail == 3 )
  {
    v2 = this->mVehicleDriverComponent.m_pSimComponent;
    v3 = v2 && ((unsigned __int8 (*)(void))v2->vfptr[15].__vecDelDtor)();
    if ( *(float *)&v1->mMoverComponent.m_pSimComponent[2].m_BoundComponentHandles.mNode.mPrev <= 0.5 )
    {
      v5 = 10;
      if ( v3 )
        v5 = 8;
      UFG::VehicleEffectsComponent::TurnOnEffect_New(v1, v5);
    }
    else
    {
      v4 = 11;
      if ( v3 )
        v4 = 9;
      UFG::VehicleEffectsComponent::TurnOnEffect_New(v1, v4);
    }
  }
}

// File Line: 2957
// RVA: 0x68DB10
void __fastcall UFG::VehicleEffectsComponent::TurnOffExhaust(UFG::VehicleEffectsComponent *this)
{
  UFG::VehicleEffectsComponent *v1; // rbx

  v1 = this;
  UFG::VehicleEffectsComponent::TurnOffEffect_New(this, FX_AIEXHAUST_CLEAN);
  UFG::VehicleEffectsComponent::TurnOffEffect_New(v1, FX_AIEXHAUST_DIRTY);
  UFG::VehicleEffectsComponent::TurnOffEffect_New(v1, FX_EXHAUST_CLEAN);
  UFG::VehicleEffectsComponent::TurnOffEffect_New(v1, FX_EXHAUST_DIRTY);
}

// File Line: 2967
// RVA: 0x68EB40
void __fastcall UFG::VehicleEffectsComponent::TurnOnSkidSmoke(UFG::VehicleEffectsComponent *this, unsigned int wheelId, UFG::PhysicsSurfaceProperties *properties, UFG::VehicleEffectsComponent::TireSmokeEffect tireSmokeFX)
{
  UFG::VehicleEffectsComponent::TireSmokeEffect v4; // ebx
  UFG::PhysicsSurfaceProperties *v5; // rdi
  __int64 v6; // r14
  UFG::VehicleEffectsComponent *v7; // rsi
  UFG::SimComponent *v8; // rcx
  bool v9; // cl
  int v10; // ebx
  int v11; // ebx
  int v12; // ebx
  unsigned int v13; // ebx
  UFG::TransformNodeComponent *v14; // rax

  v4 = tireSmokeFX;
  v5 = properties;
  v6 = (signed int)wheelId;
  v7 = this;
  if ( *((_BYTE *)this + 1884) < 0 && this->mLevelOfDetail == 3 && this->mSkidEffect.array[wheelId] == -1 )
  {
    v8 = this->mVehicleDriverComponent.m_pSimComponent;
    v9 = v8 && ((unsigned __int8 (*)(void))v8->vfptr[15].__vecDelDtor)();
    v10 = v4 - 1;
    if ( v10 )
    {
      v11 = v10 - 1;
      if ( v11 )
      {
        v12 = v11 - 2;
        if ( v12 && v12 == 4 )
        {
          if ( v9 )
            v13 = v5->mDriftEffectUID.mUID;
          else
            v13 = v5->mAIDriftEffectUID.mUID;
        }
        else if ( v9 )
        {
          v13 = v5->mSkidEffectUID.mUID;
        }
        else
        {
          v13 = v5->mAISkidEffectUID.mUID;
        }
      }
      else if ( v9 )
      {
        v13 = v5->mSlipEffectUID.mUID;
      }
      else
      {
        v13 = v5->mAISlipEffectUID.mUID;
      }
    }
    else if ( v9 )
    {
      v13 = v5->mBurnoutEffectUID.mUID;
    }
    else
    {
      v13 = v5->mAIBurnoutEffectUID.mUID;
    }
    v14 = UFG::VehicleEffectsComponent::ObtainTransform(v7, (signed int)v6 + 8);
    v7->mSkidEffect.array[v6] = Render::FXManager::CreateEffect(&Render::gFXManager, v13, v14, 0xFFFFFFFF, 0i64);
    v7->mLastPhysicsSurfacProperty.array[v6] = v5;
  }
}

// File Line: 3028
// RVA: 0x673860
void __fastcall UFG::VehicleEffectsComponent::BlowTire(UFG::VehicleEffectsComponent *this, int tireIndex)
{
  UFG::VehicleEffectsComponent *v2; // rbx
  __int64 v3; // rdi

  v2 = this;
  if ( this->mLevelOfDetail == 3 )
  {
    v3 = tireIndex;
    Render::FXManager::CreateEffect(
      &Render::gFXManager,
      0x1D655155u,
      this->mTransformNodes.array[tireIndex],
      0xFFFFFFFF,
      0i64);
    if ( (float)(*((float *)&v2->mMoverComponent.m_pSimComponent[10].m_BoundComponentHandles.mNode.mPrev + 1) * 3.5999999) > 5.0 )
      Render::FXManager::CreateEffect(&Render::gFXManager, 0xDE5F3838, v2->mTransformNodes.array[v3], 0xFFFFFFFF, 0i64);
  }
}

// File Line: 3053
// RVA: 0x696A70
void __fastcall UFG::VehicleEffectsComponent::UpdateEffectSpeed(UFG::VehicleEffectsComponent *this, UFG::VehicleEffect *pEffect)
{
  unsigned int v2; // eax
  UFG::VehicleEffect *v3; // rdi
  __int64 v4; // rbx
  unsigned int *i; // r8
  unsigned int v6; // edx
  Render::FXSimComponent *v7; // rcx
  Render::FXOverride *v8; // rax
  Render::FXOverride *v9; // rsi

  v2 = this->mSpeedLevel;
  v3 = pEffect;
  if ( pEffect->mRequestedSpeed != v2 )
  {
    pEffect->mRequestedSpeed = v2;
    v4 = this->mSpeedLevel;
    for ( i = &pEffect->mBoundEffect[v4]; *i == -1; --i )
      LODWORD(v4) = v4 - 1;
    if ( (_DWORD)v4 != pEffect->mSpeed )
    {
      v6 = pEffect->mEffectRef;
      if ( v6 != -1 )
      {
        v7 = (Render::FXSimComponent *)this->mFXComponent.m_pSimComponent;
        if ( v7 )
        {
          Render::FXSimComponent::DetachEffect(v7, v6, 0);
          v3->mEffectRef = -1;
        }
        v8 = v3->mEffectOverride.m_pPointer;
        if ( v8 )
        {
          --v8->mReferenceCount;
          v9 = v3->mEffectOverride.m_pPointer;
          if ( v9->mReferenceCount <= 0 )
          {
            if ( v9 )
            {
              Render::FXOverride::~FXOverride(v3->mEffectOverride.m_pPointer);
              operator delete[](v9);
            }
            v3->mEffectOverride.m_pPointer = 0i64;
          }
          v3->mEffectOverride.m_pPointer = 0i64;
        }
      }
      v3->mSpeed = v4;
    }
  }
}

// File Line: 3085
// RVA: 0x68E690
void __fastcall UFG::VehicleEffectsComponent::TurnOnGenericEffectByDamageBoneID(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id, unsigned int damageboneID)
{
  signed int v3; // esi
  unsigned int v4; // er14
  UFG::VehicleEffectsComponent *v5; // rdi
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl **v6; // rbx
  UFG::qSafePointerNode<UFG::SimComponent>Vtbl *v7; // rax
  UFG::qBaseTreeRB *v8; // rbp
  UFG::VehicleEffect *i; // rbx
  Render::FXSimComponent *v10; // rcx
  unsigned int v11; // edx
  int v12; // er8

  v3 = -1;
  v4 = damageboneID;
  v5 = this;
  v6 = &(&this->vfptr)[3 * id];
  if ( !*((_DWORD *)v6 + 46) )
    UFG::VehicleEffectsComponent::InitializeEffect_New(this, id);
  v7 = v6[24];
  if ( v7 )
  {
    v8 = (UFG::qBaseTreeRB *)&v7[5];
    for ( i = (UFG::VehicleEffect *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&v7[5]);
          i;
          i = (UFG::VehicleEffect *)UFG::qBaseTreeRB::GetNext(v8, &i->mNode) )
    {
      if ( i->mDamageBone == v4 )
      {
        UFG::VehicleEffectsComponent::UpdateEffectSpeed(v5, i);
        v10 = (Render::FXSimComponent *)v5->mFXComponent.m_pSimComponent;
        v11 = i->mBoundEffect[i->mSpeed];
        v12 = i->mDamageBone;
        if ( v10 )
        {
          if ( v12 != -1 && v3 == -1 )
          {
            if ( v11 )
              v3 = Render::FXSimComponent::AttachEffect(v10, v11, v12, 0i64);
          }
        }
      }
    }
  }
}

// File Line: 3107
// RVA: 0x68E850
void __fastcall UFG::VehicleEffectsComponent::TurnOnLightEffects(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id)
{
  UFG::VehicleEffectId v2; // esi
  UFG::VehicleEffectsComponent *v3; // rdi
  signed __int64 v4; // rbx
  __int64 v5; // r14
  UFG::EffectStatus::State v6; // eax
  bool v7; // si
  UFG::VehicleEffect *i; // rbx
  DamageRig *v9; // rcx
  unsigned int v10; // edx
  Render::FXSimComponent *v11; // rcx
  unsigned int v12; // edx
  int v13; // er8
  float health_output; // [rsp+58h] [rbp+10h]

  v2 = id;
  v3 = this;
  v4 = id;
  v5 = id;
  if ( this->mEffectStatusTable[id].mState == UNINITIALIZED )
    UFG::VehicleEffectsComponent::InitializeEffect_New(this, id);
  v6 = v3->mEffectStatusTable[v4].mState;
  if ( v6 == 4 )
  {
    v3->mEffectStatusTable[v4].mState = 3;
    v7 = (unsigned int)(v2 - 2) <= 3 || v2 == FX_NIGHTTIME;
    for ( i = (UFG::VehicleEffect *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&v3->mEffectStatusTable[v5].mInternalState->mEffects);
          i;
          i = (UFG::VehicleEffect *)UFG::qBaseTreeRB::GetNext(
                                      &v3->mEffectStatusTable[v5].mInternalState->mEffects.mTree,
                                      &i->mNode) )
    {
      v9 = v3->mDamageRig;
      if ( v9 && !v9->mBurnedOut )
      {
        v10 = i->mDamageAffectorHash.mUID;
        health_output = 0.0;
        DamageRig::GetTriggerMarkerHealth(v9, v10, &health_output);
        if ( v7 == 1 )
          DamageRig::SetSignal(v3->mDamageRig, i->mDamageAffectorHash.mUID, 2.0);
        if ( health_output <= 0.33000001 )
        {
          UFG::VehicleEffectsComponent::UpdateEffectSpeed(v3, i);
          v11 = (Render::FXSimComponent *)v3->mFXComponent.m_pSimComponent;
          v12 = i->mBoundEffect[i->mSpeed];
          v13 = i->mMarker;
          if ( v11 )
          {
            if ( v13 != -1 && i->mEffectRef == -1 )
            {
              if ( v12 )
                i->mEffectRef = Render::FXSimComponent::AttachEffect(v11, v12, v13, 0i64);
            }
          }
        }
      }
    }
  }
  else if ( v6 == 1 )
  {
    *((_DWORD *)&v3->mEffectStatusTable[v4] + 4) |= 1u;
  }
}

// File Line: 3145
// RVA: 0x68DD20
void __fastcall UFG::VehicleEffectsComponent::TurnOffLightEffects(UFG::VehicleEffectsComponent *this, UFG::VehicleEffectId id)
{
  UFG::VehicleEffectsComponent *v2; // rdi
  signed __int64 v3; // rbp
  bool v4; // r14
  signed __int64 v5; // r15
  UFG::qBaseTreeRB *i; // rbx
  Render::FXSimComponent *v7; // rcx
  unsigned int v8; // edx
  UFG::qBaseNodeRB *v9; // rax
  UFG::qBaseNodeRB *v10; // rsi
  DamageRig *v11; // rcx

  v2 = this;
  v3 = id;
  if ( this->mEffectStatusTable[id].mState == 3 )
  {
    this->mEffectStatusTable[id].mState = 4;
    v4 = !(id & 0xFFFFFFFA) && id != 1;
    v5 = id;
    for ( i = (UFG::qBaseTreeRB *)UFG::qTreeRB64<UFG::tOffset,UFG::tOffset,1>::GetHead((UFG::qTreeRB64<Render::SkinningCacheNode,Render::SkinningCacheNode,1> *)&this->mEffectStatusTable[id].mInternalState->mEffects);
          i;
          i = UFG::qBaseTreeRB::GetNext(&v2->mEffectStatusTable[v5].mInternalState->mEffects.mTree, &i->mRoot) )
    {
      v7 = (Render::FXSimComponent *)v2->mFXComponent.m_pSimComponent;
      if ( v7 )
      {
        v8 = i[1].mRoot.mUID;
        if ( v8 != -1 )
        {
          Render::FXSimComponent::DetachEffect(v7, v8, 0);
          i[1].mRoot.mUID = -1;
        }
      }
      i[1].mRoot.mUID = -1;
      v9 = i[1].mNULL.mParent;
      if ( v9 )
      {
        --LODWORD(v9->mParent);
        v10 = i[1].mNULL.mParent;
        if ( SLODWORD(v10->mParent) <= 0 )
        {
          if ( v10 )
          {
            Render::FXOverride::~FXOverride((Render::FXOverride *)i[1].mNULL.mParent);
            operator delete[](v10);
          }
          i[1].mNULL.mParent = 0i64;
        }
        i[1].mNULL.mParent = 0i64;
      }
      v11 = v2->mDamageRig;
      if ( v11 && v4 == 1 )
        DamageRig::RemoveSignal(v11, HIDWORD(i[1].mRoot.mChild[0]), 2.0);
    }
  }
  *((_DWORD *)&v2->mEffectStatusTable[v3] + 4) &= 0xFFFFFFFE;
  if ( v2->mEffectStatusTable[v3].mState == 1 )
    v2->mEffectStatusTable[v3].mState = 0;
}

// File Line: 3192
// RVA: 0x66C7F0
void __fastcall UFG::EffectStatus::~EffectStatus(UFG::EffectStatus *this)
{
  UFG::VehicleEffectState *v1; // rdi

  v1 = this->mInternalState;
  if ( v1 )
  {
    UFG::qTreeRB<UFG::VehicleEffect,UFG::VehicleEffect,1>::DeleteAll(&v1->mEffects);
    UFG::qBaseTreeRB::~qBaseTreeRB((Render::Skinning *)&v1->mEffects);
    operator delete[](v1);
  }
}

